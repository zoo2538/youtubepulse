<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>IndexedDB 10월 12일 데이터 확인</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-bottom: 20px;
    }
    button:hover {
      background: #45a049;
    }
    pre {
      background: #f4f4f4;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 14px;
      line-height: 1.5;
    }
    .error {
      color: red;
    }
    .success {
      color: green;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>📊 IndexedDB 10월 12일 데이터 확인</h1>
    <button onclick="checkData()">IndexedDB 확인하기</button>
    <div id="result"></div>
  </div>

  <script>
    async function checkData() {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p>확인 중...</p>';
      
      try {
        // IndexedDB 열기
        const dbRequest = indexedDB.open('YoutubePulseDB', 1);
        
        dbRequest.onerror = () => {
          resultDiv.innerHTML = '<p class="error">❌ IndexedDB를 열 수 없습니다.</p>';
        };
        
        dbRequest.onsuccess = (event) => {
          const db = event.target.result;
          
          if (!db.objectStoreNames.contains('unclassified')) {
            resultDiv.innerHTML = '<p class="error">❌ unclassified 스토어가 없습니다.</p>';
            return;
          }
          
          const transaction = db.transaction(['unclassified'], 'readonly');
          const store = transaction.objectStore('unclassified');
          const getAllRequest = store.getAll();
          
          getAllRequest.onsuccess = () => {
            const allData = getAllRequest.result || [];
            
            // 10월 12일 데이터 필터링
            const oct12Data = allData.filter(item => {
              const dayKey = item.dayKeyLocal || item.collectionDate || item.uploadDate;
              return dayKey && dayKey.startsWith('2025-10-12');
            });
            
            let html = `<h2>📊 IndexedDB 데이터</h2>`;
            html += `<p>전체 데이터: ${allData.length}개</p>`;
            html += `<p>10월 12일 데이터: ${oct12Data.length}개</p>`;
            
            if (oct12Data.length > 0) {
              // collection_type별 분포
              const typeCount = {};
              oct12Data.forEach(item => {
                const type = item.collectionType || 'unknown';
                typeCount[type] = (typeCount[type] || 0) + 1;
              });
              
              html += `<h3>수집 타입별 분포:</h3><ul>`;
              Object.entries(typeCount).forEach(([type, count]) => {
                html += `<li>${type}: ${count}개</li>`;
              });
              html += `</ul>`;
              
              // 수동수집 데이터
              const manualData = oct12Data.filter(item => item.collectionType === 'manual');
              html += `<h3>✋ 수동수집: ${manualData.length}개</h3>`;
              
              if (manualData.length > 0) {
                // 키워드별 분포
                const keywordCount = {};
                manualData.forEach(item => {
                  const keyword = item.keyword || item.searchKeyword || '(트렌드)';
                  keywordCount[keyword] = (keywordCount[keyword] || 0) + 1;
                });
                
                html += `<h4>키워드별 분포:</h4><ul>`;
                const sortedKeywords = Object.entries(keywordCount)
                  .sort((a, b) => b[1] - a[1])
                  .slice(0, 10);
                sortedKeywords.forEach(([keyword, count]) => {
                  html += `<li>${keyword}: ${count}개</li>`;
                });
                html += `</ul>`;
                
                // 샘플 데이터
                html += `<h4>샘플 데이터 (조회수 높은 순 5개):</h4>`;
                const sortedByViews = [...manualData]
                  .sort((a, b) => (b.viewCount || 0) - (a.viewCount || 0))
                  .slice(0, 5);
                
                html += `<ol>`;
                sortedByViews.forEach(item => {
                  const title = item.title || '(제목 없음)';
                  html += `<li>`;
                  html += `<strong>${title.substring(0, 80)}</strong><br>`;
                  html += `비디오ID: ${item.videoId}<br>`;
                  html += `조회수: ${(item.viewCount || 0).toLocaleString()}<br>`;
                  html += `키워드: ${item.keyword || item.searchKeyword || '(트렌드)'}`;
                  html += `</li>`;
                });
                html += `</ol>`;
              }
              
              // 자동수집 데이터
              const autoData = oct12Data.filter(item => item.collectionType === 'auto');
              html += `<h3>🤖 자동수집: ${autoData.length}개</h3>`;
              
            } else {
              html += `<p class="error">⚠️ 10월 12일 데이터가 없습니다!</p>`;
            }
            
            // 날짜별 분포 확인
            const dateCount = {};
            allData.forEach(item => {
              const dayKey = item.dayKeyLocal || item.collectionDate || item.uploadDate;
              if (dayKey) {
                const date = dayKey.split('T')[0];
                dateCount[date] = (dateCount[date] || 0) + 1;
              }
            });
            
            html += `<h3>📅 전체 날짜별 데이터 분포:</h3><ul>`;
            const sortedDates = Object.entries(dateCount).sort((a, b) => b[0].localeCompare(a[0]));
            sortedDates.forEach(([date, count]) => {
              html += `<li>${date}: ${count}개</li>`;
            });
            html += `</ul>`;
            
            resultDiv.innerHTML = html;
          };
          
          getAllRequest.onerror = () => {
            resultDiv.innerHTML = '<p class="error">❌ 데이터를 가져올 수 없습니다.</p>';
          };
        };
        
      } catch (error) {
        resultDiv.innerHTML = `<p class="error">❌ 에러: ${error.message}</p>`;
      }
    }
  </script>
</body>
</html>

