<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>IndexedDB 10ì›” 12ì¼ ë°ì´í„° í™•ì¸</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-bottom: 20px;
    }
    button:hover {
      background: #45a049;
    }
    pre {
      background: #f4f4f4;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 14px;
      line-height: 1.5;
    }
    .error {
      color: red;
    }
    .success {
      color: green;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“Š IndexedDB 10ì›” 12ì¼ ë°ì´í„° í™•ì¸</h1>
    <button onclick="checkData()">IndexedDB í™•ì¸í•˜ê¸°</button>
    <div id="result"></div>
  </div>

  <script>
    async function checkData() {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p>í™•ì¸ ì¤‘...</p>';
      
      try {
        // IndexedDB ì—´ê¸°
        const dbRequest = indexedDB.open('YoutubePulseDB', 1);
        
        dbRequest.onerror = () => {
          resultDiv.innerHTML = '<p class="error">âŒ IndexedDBë¥¼ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        };
        
        dbRequest.onsuccess = (event) => {
          const db = event.target.result;
          
          if (!db.objectStoreNames.contains('unclassified')) {
            resultDiv.innerHTML = '<p class="error">âŒ unclassified ìŠ¤í† ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
          }
          
          const transaction = db.transaction(['unclassified'], 'readonly');
          const store = transaction.objectStore('unclassified');
          const getAllRequest = store.getAll();
          
          getAllRequest.onsuccess = () => {
            const allData = getAllRequest.result || [];
            
            // 10ì›” 12ì¼ ë°ì´í„° í•„í„°ë§
            const oct12Data = allData.filter(item => {
              const dayKey = item.dayKeyLocal || item.collectionDate || item.uploadDate;
              return dayKey && dayKey.startsWith('2025-10-12');
            });
            
            let html = `<h2>ğŸ“Š IndexedDB ë°ì´í„°</h2>`;
            html += `<p>ì „ì²´ ë°ì´í„°: ${allData.length}ê°œ</p>`;
            html += `<p>10ì›” 12ì¼ ë°ì´í„°: ${oct12Data.length}ê°œ</p>`;
            
            if (oct12Data.length > 0) {
              // collection_typeë³„ ë¶„í¬
              const typeCount = {};
              oct12Data.forEach(item => {
                const type = item.collectionType || 'unknown';
                typeCount[type] = (typeCount[type] || 0) + 1;
              });
              
              html += `<h3>ìˆ˜ì§‘ íƒ€ì…ë³„ ë¶„í¬:</h3><ul>`;
              Object.entries(typeCount).forEach(([type, count]) => {
                html += `<li>${type}: ${count}ê°œ</li>`;
              });
              html += `</ul>`;
              
              // ìˆ˜ë™ìˆ˜ì§‘ ë°ì´í„°
              const manualData = oct12Data.filter(item => item.collectionType === 'manual');
              html += `<h3>âœ‹ ìˆ˜ë™ìˆ˜ì§‘: ${manualData.length}ê°œ</h3>`;
              
              if (manualData.length > 0) {
                // í‚¤ì›Œë“œë³„ ë¶„í¬
                const keywordCount = {};
                manualData.forEach(item => {
                  const keyword = item.keyword || item.searchKeyword || '(íŠ¸ë Œë“œ)';
                  keywordCount[keyword] = (keywordCount[keyword] || 0) + 1;
                });
                
                html += `<h4>í‚¤ì›Œë“œë³„ ë¶„í¬:</h4><ul>`;
                const sortedKeywords = Object.entries(keywordCount)
                  .sort((a, b) => b[1] - a[1])
                  .slice(0, 10);
                sortedKeywords.forEach(([keyword, count]) => {
                  html += `<li>${keyword}: ${count}ê°œ</li>`;
                });
                html += `</ul>`;
                
                // ìƒ˜í”Œ ë°ì´í„°
                html += `<h4>ìƒ˜í”Œ ë°ì´í„° (ì¡°íšŒìˆ˜ ë†’ì€ ìˆœ 5ê°œ):</h4>`;
                const sortedByViews = [...manualData]
                  .sort((a, b) => (b.viewCount || 0) - (a.viewCount || 0))
                  .slice(0, 5);
                
                html += `<ol>`;
                sortedByViews.forEach(item => {
                  const title = item.title || '(ì œëª© ì—†ìŒ)';
                  html += `<li>`;
                  html += `<strong>${title.substring(0, 80)}</strong><br>`;
                  html += `ë¹„ë””ì˜¤ID: ${item.videoId}<br>`;
                  html += `ì¡°íšŒìˆ˜: ${(item.viewCount || 0).toLocaleString()}<br>`;
                  html += `í‚¤ì›Œë“œ: ${item.keyword || item.searchKeyword || '(íŠ¸ë Œë“œ)'}`;
                  html += `</li>`;
                });
                html += `</ol>`;
              }
              
              // ìë™ìˆ˜ì§‘ ë°ì´í„°
              const autoData = oct12Data.filter(item => item.collectionType === 'auto');
              html += `<h3>ğŸ¤– ìë™ìˆ˜ì§‘: ${autoData.length}ê°œ</h3>`;
              
            } else {
              html += `<p class="error">âš ï¸ 10ì›” 12ì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!</p>`;
            }
            
            // ë‚ ì§œë³„ ë¶„í¬ í™•ì¸
            const dateCount = {};
            allData.forEach(item => {
              const dayKey = item.dayKeyLocal || item.collectionDate || item.uploadDate;
              if (dayKey) {
                const date = dayKey.split('T')[0];
                dateCount[date] = (dateCount[date] || 0) + 1;
              }
            });
            
            html += `<h3>ğŸ“… ì „ì²´ ë‚ ì§œë³„ ë°ì´í„° ë¶„í¬:</h3><ul>`;
            const sortedDates = Object.entries(dateCount).sort((a, b) => b[0].localeCompare(a[0]));
            sortedDates.forEach(([date, count]) => {
              html += `<li>${date}: ${count}ê°œ</li>`;
            });
            html += `</ul>`;
            
            resultDiv.innerHTML = html;
          };
          
          getAllRequest.onerror = () => {
            resultDiv.innerHTML = '<p class="error">âŒ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
          };
        };
        
      } catch (error) {
        resultDiv.innerHTML = `<p class="error">âŒ ì—ëŸ¬: ${error.message}</p>`;
      }
    }
  </script>
</body>
</html>

