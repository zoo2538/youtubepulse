var q=Object.defineProperty;var B=($,e,t)=>e in $?q($,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):$[e]=t;var I=($,e,t)=>B($,typeof e!="symbol"?e+"":e,t);class E{constructor(){I(this,"dbName","YouTubePulseDB");I(this,"version",2);I(this,"db",null)}async restartConnection(){console.log("ğŸ”„ IndexedDB ì—°ê²° ì¬ì‹œì‘ ì¤‘..."),this.db&&(this.db.close(),this.db=null),await new Promise(e=>setTimeout(e,500)),await this.init(),console.log("âœ… IndexedDB ì—°ê²° ì¬ì‹œì‘ ì™„ë£Œ")}async init(){return this.db&&(this.db.close(),this.db=null),await new Promise(e=>setTimeout(e,200)),new Promise((e,t)=>{const o=indexedDB.open(this.dbName,this.version);o.onerror=()=>{console.error("IndexedDB ì´ˆê¸°í™” ì‹¤íŒ¨:",o.error),t(o.error)},o.onsuccess=()=>{this.db=o.result,console.log("âœ… IndexedDB ì´ˆê¸°í™” ì„±ê³µ:",this.dbName),e()},o.onupgradeneeded=i=>{const a=i.target.result;if(a.objectStoreNames.contains("unclassifiedData")){const s=a.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData");s.indexNames.contains("videoDay")||s.createIndex("videoDay",["videoId","dayKeyLocal"],{unique:!0}),s.indexNames.contains("dayKeyLocal")||s.createIndex("dayKeyLocal","dayKeyLocal",{unique:!1})}else{const r=a.createObjectStore("unclassifiedData",{keyPath:"id"});r.createIndex("channelName","channelName",{unique:!1}),r.createIndex("status","status",{unique:!1}),r.createIndex("category","category",{unique:!1}),r.createIndex("videoDay",["videoId","dayKeyLocal"],{unique:!0}),r.createIndex("dayKeyLocal","dayKeyLocal",{unique:!1})}if(!a.objectStoreNames.contains("classifiedData")){const r=a.createObjectStore("classifiedData",{keyPath:"id"});r.createIndex("channelName","channelName",{unique:!1}),r.createIndex("category","category",{unique:!1})}if(a.objectStoreNames.contains("channels")||a.createObjectStore("channels",{keyPath:"id"}).createIndex("name","name",{unique:!1}),!a.objectStoreNames.contains("videos")){const r=a.createObjectStore("videos",{keyPath:"id"});r.createIndex("channelId","channelId",{unique:!1}),r.createIndex("uploadDate","uploadDate",{unique:!1})}a.objectStoreNames.contains("categories")?(a.deleteObjectStore("categories"),a.createObjectStore("categories",{autoIncrement:!0})):a.createObjectStore("categories",{autoIncrement:!0}),a.objectStoreNames.contains("subCategories")||a.createObjectStore("subCategories",{keyPath:"id",autoIncrement:!0}).createIndex("category","category",{unique:!1}),a.objectStoreNames.contains("systemConfig")||a.createObjectStore("systemConfig",{keyPath:"key"}),a.objectStoreNames.contains("dailySummary")||a.createObjectStore("dailySummary",{keyPath:"date"}).createIndex("date","date",{unique:!0}),a.objectStoreNames.contains("dailyProgress")||a.createObjectStore("dailyProgress",{autoIncrement:!0}),a.objectStoreNames.contains("classifiedByDate")||a.createObjectStore("classifiedByDate",{keyPath:"date"}).createIndex("date","date",{unique:!0})}})}async replaceAllUnclassifiedData(e){return this.db||await this.init(),new Promise((t,o)=>{const a=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=a.clear();r.onsuccess=()=>{let s=0;const c=e.length;if(c===0){t();return}e.forEach(n=>{const u=a.put(n);u.onsuccess=()=>{s++,s===c&&t()},u.onerror=()=>o(u.error)})},r.onerror=()=>o(r.error)})}async saveUnclassifiedData(e){if(this.db||await this.init(),e.length===0)return Promise.resolve();console.log(`ğŸ”„ ë°±ì—… ë³µì› ì‹œì‘: ${e.length}ê°œ í•­ëª©`);const t=e.filter(a=>a.videoId?!0:(console.warn("âŒ videoIdê°€ ì—†ëŠ” í•­ëª© ì œì™¸:",a),!1)).map(a=>{const r=this.normalizeDayKey(a.dayKeyLocal||a.collectionDate||a.uploadDate);return{...a,dayKeyLocal:r,id:a.id||`${Date.now()}_${Math.random().toString(36).substr(2,9)}_${Math.random().toString(36).substr(2,9)}`}});console.log(`âœ… ë‚ ì§œ í‚¤ ë‹¨ì¼í™” ì™„ë£Œ: ${t.length}ê°œ í•­ëª©`);const o=new Map;t.forEach(a=>{if(!a.videoId||!a.dayKeyLocal){console.warn("âŒ í•„ìˆ˜ í•„ë“œê°€ ì—†ëŠ” í•­ëª© ì œì™¸:",{videoId:a.videoId,dayKeyLocal:a.dayKeyLocal});return}const r=`${a.videoId}|${a.dayKeyLocal}`;if(o.has(r)){const s=o.get(r),c={...s,...a,viewCount:Math.max(s.viewCount||0,a.viewCount||0),likeCount:Math.max(s.likeCount||0,a.likeCount||0),status:a.status==="classified"?"classified":s.status,category:a.category||s.category,subCategory:a.subCategory||s.subCategory};o.set(r,c),console.log(`ğŸ”„ ì¤‘ë³µ í•­ëª© ë³‘í•©: ${r} (ì¡°íšŒìˆ˜: ${s.viewCount} â†’ ${c.viewCount})`)}else o.set(r,a)});const i=Array.from(o.values());return console.log(`ğŸ”„ ì¤‘ë³µ ì œê±° ì™„ë£Œ: ${t.length}ê°œ â†’ ${i.length}ê°œ`),new Promise((a,r)=>{const s=this.db.transaction(["unclassifiedData"],"readwrite"),c=s.objectStore("unclassifiedData"),n=c.clear();n.onsuccess=()=>{console.log("ğŸ—‘ï¸ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì™„ë£Œ");let u=0,l=0;const d=i.length;console.log(`ğŸ”„ ìƒˆ ë°ì´í„° ì €ì¥ ì‹œì‘: ${d}ê°œ í•­ëª©`),i.forEach((g,h)=>{const y=c.put(g);y.onsuccess=()=>{u++,u+l===d&&(console.log(`âœ… ë°±ì—… ë³µì› ì™„ë£Œ: ${u}ê°œ ì„±ê³µ, ${l}ê°œ ì‹¤íŒ¨`),a())},y.onerror=()=>{console.warn(`í•­ëª© ${h} ì €ì¥ ì‹¤íŒ¨:`,y.error),l++,u+l===d&&(console.log(`âœ… ë°±ì—… ë³µì› ì™„ë£Œ: ${u}ê°œ ì„±ê³µ, ${l}ê°œ ì‹¤íŒ¨`),a())}})},n.onerror=()=>{console.error("âŒ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",n.error),r(n.error)},s.oncomplete=()=>{console.log("ğŸ‰ ë°±ì—… ë³µì› íŠ¸ëœì­ì…˜ ì™„ë£Œ")},s.onerror=()=>{console.error("âŒ ë°±ì—… ë³µì› íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",s.error),r(s.error)}})}normalizeDayKey(e){if(!e)return new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"});try{const t=new Date(e);return isNaN(t.getTime())?new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"}):t.toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"})}catch(t){return console.warn("ë‚ ì§œ í‚¤ ë³€í™˜ ì‹¤íŒ¨:",e,t),new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"})}}async loadUnclassifiedData(){return this.db||await this.init(),new Promise((e,t)=>{try{const a=this.db.transaction(["unclassifiedData"],"readonly").objectStore("unclassifiedData").getAll();a.onsuccess=()=>{console.log("âœ… IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ:",a.result.length,"ê°œ"),e(a.result)},a.onerror=()=>{console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",a.error),t(a.error)}}catch(o){console.error("âŒ IndexedDB íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",o),t(o)}})}async loadUnclassifiedDataByDate(e){return this.db||await this.init(),new Promise((t,o)=>{const r=this.db.transaction(["unclassifiedData"],"readonly").objectStore("unclassifiedData").getAll();r.onsuccess=()=>{const s=r.result.filter(c=>(c.collectionDate||c.uploadDate)===e);t(s)},r.onerror=()=>o(r.error)})}async getAvailableDates(){return this.db||await this.init(),new Promise((e,t)=>{try{const o=new Set;let i=0;const a=3,r=()=>{if(i++,i===a){const f=new Date,D=new Date(f.getTime()+9*60*60*1e3),v=D.toISOString().split("T")[0];for(let S=0;S<7;S++){const x=new Date(D.getTime()-S*24*60*60*1e3).toISOString().split("T")[0];o.add(x)}const b=Array.from(o).sort((S,p)=>p.localeCompare(S));console.log(`ğŸ“… ì‚¬ìš© ê°€ëŠ¥í•œ ë‚ ì§œë“¤ (7ì¼ ë²”ìœ„ ìë™ ìƒì„±): ${b.length}ê°œ`,b),e(b)}},n=this.db.transaction(["unclassifiedData"],"readonly").objectStore("unclassifiedData").getAll();n.onsuccess=()=>{n.result.forEach(f=>{const D=f.collectionDate||f.uploadDate;D&&o.add(D)}),console.log(`ğŸ“Š unclassifiedDataì—ì„œ ${n.result.length}ê°œ í•­ëª© ì¡°íšŒ`),r()},n.onerror=()=>{console.error("âŒ unclassifiedData ì¡°íšŒ ì‹¤íŒ¨:",n.error),r()};const d=this.db.transaction(["classifiedData"],"readonly").objectStore("classifiedData").getAll();d.onsuccess=()=>{d.result.forEach(f=>{const D=f.collectionDate||f.uploadDate;D&&o.add(D)}),console.log(`ğŸ“Š classifiedDataì—ì„œ ${d.result.length}ê°œ í•­ëª© ì¡°íšŒ`),r()},d.onerror=()=>{console.error("classifiedData ì¡°íšŒ ì‹¤íŒ¨:",d.error),r()};const y=this.db.transaction(["dailyProgress"],"readonly").objectStore("dailyProgress").getAll();y.onsuccess=()=>{y.result.forEach(f=>{f.date&&o.add(f.date)}),console.log(`ğŸ“Š dailyProgressì—ì„œ ${y.result.length}ê°œ í•­ëª© ì¡°íšŒ`),r()},y.onerror=()=>{console.error("âŒ dailyProgress ì¡°íšŒ ì‹¤íŒ¨:",y.error),r()}}catch(o){console.error("âŒ getAvailableDates íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",o),this.restartConnection().then(()=>{console.log("ğŸ”„ ì—°ê²° ì¬ì‹œì‘ í›„ ë‹¤ì‹œ ì‹œë„"),e([])}).catch(()=>{t(o)})}})}async clearUnclassifiedData(){return this.db||await this.init(),new Promise((e,t)=>{try{const a=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData").clear();a.onsuccess=()=>{console.log("âœ… unclassifiedData ì „ì²´ ì‚­ì œ ì™„ë£Œ"),e()},a.onerror=()=>{console.error("âŒ unclassifiedData ì‚­ì œ ì‹¤íŒ¨:",a.error),t(a.error)}}catch(o){console.error("âŒ clearUnclassifiedData íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",o),t(o)}})}async saveClassifiedData(e){if(this.db||await this.init(),!Array.isArray(e))return console.error("âŒ saveClassifiedData: dataê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:",typeof e,e),Promise.reject(new Error("Data must be an array"));const t=e.filter(o=>o.id?!0:(console.warn("âŒ IDê°€ ì—†ëŠ” ë¶„ë¥˜ ë°ì´í„° ì œì™¸:",o),!1));return console.log(`ğŸ“Š ë¶„ë¥˜ ë°ì´í„° ì €ì¥: ${e.length}ê°œ â†’ ${t.length}ê°œ (ìœ íš¨í•œ ë°ì´í„°)`),new Promise((o,i)=>{const r=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData"),s=r.clear();s.onsuccess=()=>{let c=0;const n=t.length;if(n===0){o();return}t.forEach(u=>{const l=r.put(u);l.onsuccess=()=>{c++,c===n&&o()},l.onerror=()=>i(l.error)})},s.onerror=()=>i(s.error)})}async loadClassifiedData(){return this.db||await this.init(),new Promise((e,t)=>{const a=this.db.transaction(["classifiedData"],"readonly").objectStore("classifiedData").getAll();a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})}async updateClassifiedDataByDate(e,t){return this.db||await this.init(),console.log(`ğŸ’¾ IndexedDB ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ - ${t}:`,e.length,"ê°œ"),new Promise((o,i)=>{const r=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData"),s=r.getAll();s.onsuccess=()=>{const c=s.result;console.log(`ğŸ“Š IndexedDB ì „ì²´ ë¶„ë¥˜ ë°ì´í„°: ${c.length}ê°œ`);const n=c.filter(d=>(d.dayKeyLocal||d.collectionDate||d.uploadDate||"").split("T")[0]!==t);console.log(`ğŸ“Š ë‹¤ë¥¸ ë‚ ì§œ ë¶„ë¥˜ ë°ì´í„°: ${n.length}ê°œ`);const u=[...n,...e];console.log(`ğŸ“Š ë³‘í•© ë¶„ë¥˜ ë°ì´í„°: ${u.length}ê°œ (ë‹¤ë¥¸ ë‚ ì§œ: ${n.length} + ìƒˆ ë‚ ì§œ: ${e.length})`);const l=r.clear();l.onsuccess=()=>{console.log("ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ ì™„ë£Œ, ë³‘í•© ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹œì‘");let d=0;const g=u.length;if(g===0){console.log(`âœ… ${t} ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ë°ì´í„° ì—†ìŒ`),o();return}u.forEach((h,y)=>{h.id||(h.id=Date.now()+y);const f=r.put(h);f.onsuccess=()=>{d++,d===g&&(console.log(`âœ… ${t} ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${e.length}ê°œ ì¶”ê°€/ìˆ˜ì •, ì „ì²´ ${u.length}ê°œ ìœ ì§€`),o())},f.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",f.error),i(f.error)}})},l.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",l.error),i(l.error)}},s.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",s.error),i(s.error)}})}async updateUnclassifiedData(e){return this.db||await this.init(),console.log("ğŸ’¾ IndexedDB ì—…ë°ì´íŠ¸ - unclassifiedData:",e.length,"ê°œ"),console.log("ğŸ’¾ ë°ì´í„° ìƒ˜í”Œ (ì¹´í…Œê³ ë¦¬/ì„¸ë¶€ì¹´í…Œê³ ë¦¬):",e.slice(0,3).map(t=>({category:t.category,subCategory:t.subCategory,channelName:t.channelName}))),new Promise((t,o)=>{const a=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData");let r=0;const s=e.length;if(s===0){t();return}e.forEach((c,n)=>{c.id||(c.id=Date.now()+n);const u=a.put(c);u.onsuccess=()=>{r++,r===s&&t()},u.onerror=()=>o(u.error)})})}async updateUnclassifiedDataByDate(e,t){return this.db||await this.init(),console.log(`ğŸ’¾ IndexedDB ë‚ ì§œë³„ ì—…ë°ì´íŠ¸ - ${t}:`,e.length,"ê°œ"),console.log("ğŸ’¾ ë°ì´í„° ìƒ˜í”Œ (ì¹´í…Œê³ ë¦¬/ì„¸ë¶€ì¹´í…Œê³ ë¦¬):",e.slice(0,3).map(o=>({category:o.category,subCategory:o.subCategory,channelName:o.channelName}))),new Promise((o,i)=>{const r=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),s=r.getAll();s.onsuccess=()=>{const c=s.result;console.log(`ğŸ“Š IndexedDB ì „ì²´ ë°ì´í„°: ${c.length}ê°œ`);const n=c.filter(d=>(d.dayKeyLocal||d.collectionDate||d.uploadDate||"").split("T")[0]!==t);console.log(`ğŸ“Š ë‹¤ë¥¸ ë‚ ì§œ ë°ì´í„°: ${n.length}ê°œ`);const u=[...n,...e];console.log(`ğŸ“Š ë³‘í•© ë°ì´í„°: ${u.length}ê°œ (ë‹¤ë¥¸ ë‚ ì§œ: ${n.length} + ìƒˆ ë‚ ì§œ: ${e.length})`);const l=r.clear();l.onsuccess=()=>{console.log("ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ ì™„ë£Œ, ë³‘í•© ë°ì´í„° ì €ì¥ ì‹œì‘");let d=0;const g=u.length;if(g===0){console.log(`âœ… ${t} ë‚ ì§œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ë°ì´í„° ì—†ìŒ`),o();return}u.forEach((h,y)=>{h.id||(h.id=Date.now()+y);const f=r.put(h);f.onsuccess=()=>{d++,d===g&&(console.log(`âœ… ${t} ë‚ ì§œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${e.length}ê°œ ì¶”ê°€/ìˆ˜ì •, ì „ì²´ ${u.length}ê°œ ìœ ì§€`),o())},f.onerror=()=>{console.error("âŒ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",f.error),i(f.error)}})},l.onerror=()=>{console.error("âŒ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",l.error),i(l.error)}},s.onerror=()=>{console.error("âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",s.error),i(s.error)}})}async updateClassifiedData(e){return this.db||await this.init(),new Promise((t,o)=>{const a=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData");let r=0;const s=e.length;if(s===0){t();return}e.forEach((c,n)=>{c.id||(c.id=Date.now()+n);const u=a.put(c);u.onsuccess=()=>{r++,r===s&&t()},u.onerror=()=>o(u.error)})})}async saveChannels(e){return this.db||await this.init(),new Promise((t,o)=>{const a=this.db.transaction(["channels"],"readwrite").objectStore("channels"),r=a.clear();r.onsuccess=()=>{const s=Object.entries(e);let c=0;const n=s.length;if(n===0){t();return}s.forEach(([u,l])=>{const d=a.put({id:u,...l});d.onsuccess=()=>{c++,c===n&&t()},d.onerror=()=>o(d.error)})},r.onerror=()=>o(r.error)})}async saveVideos(e){return this.db||await this.init(),new Promise((t,o)=>{const a=this.db.transaction(["videos"],"readwrite").objectStore("videos"),r=a.clear();r.onsuccess=()=>{const s=Object.entries(e);let c=0;const n=s.length;if(n===0){t();return}s.forEach(([u,l])=>{Array.isArray(l)&&l.forEach(d=>{const g=a.put({...d,channelId:u});g.onsuccess=()=>{c++,c===n&&t()},g.onerror=()=>o(g.error)})})},r.onerror=()=>o(r.error)})}async saveCategories(e){return this.db||await this.init(),new Promise((t,o)=>{const a=this.db.transaction(["subCategories"],"readwrite").objectStore("subCategories"),r=a.clear();r.onsuccess=()=>{const s=a.put({id:1,type:"categories",data:e,timestamp:new Date().toISOString()});s.onsuccess=()=>{console.log("âœ… ì¹´í…Œê³ ë¦¬ ì €ì¥ ì™„ë£Œ:",e),t()},s.onerror=c=>{console.error("âŒ ì¹´í…Œê³ ë¦¬ ì €ì¥ ì‹¤íŒ¨:",c),o(s.error)}},r.onerror=s=>{console.error("âŒ ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨:",s),o(r.error)}})}async loadCategories(){return this.db||await this.init(),new Promise((e,t)=>{const a=this.db.transaction(["subCategories"],"readonly").objectStore("subCategories").getAll();a.onsuccess=()=>{const s=a.result.filter(c=>c.type==="categories").sort((c,n)=>new Date(n.timestamp).getTime()-new Date(c.timestamp).getTime())[0];e((s==null?void 0:s.data)||null)},a.onerror=()=>t(a.error)})}async saveDailyProgress(e){this.db||await this.init(),console.log("ğŸ” saveDailyProgress í˜¸ì¶œë¨ - ë§¤ê°œë³€ìˆ˜:",typeof e,e);let t=[];if(Array.isArray(e))t=e.filter(o=>o&&typeof o=="object"),console.log("ğŸ” ë°°ì—´ë¡œ ì²˜ë¦¬ë¨:",t.length,"ê°œ í•­ëª©");else if(e&&typeof e=="object")t=[e],console.log("ğŸ” ê°ì²´ë¡œ ì²˜ë¦¬ë¨:",t[0]);else return console.error("âŒ saveDailyProgress: ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„° íƒ€ì…:",typeof e,e),Promise.resolve();return new Promise((o,i)=>{const r=this.db.transaction(["dailyProgress"],"readwrite").objectStore("dailyProgress"),s=r.clear();s.onsuccess=()=>{let c=0;const n=t.length;if(n===0){o();return}t.forEach((u,l)=>{const d={...u};d.id||(d.id=Date.now()+l);const g=r.put(d);g.onsuccess=()=>{c++,c===n&&o()},g.onerror=()=>i(g.error)})},s.onerror=()=>i(s.error)})}async saveSubCategories(e){return this.db||await this.init(),new Promise((t,o)=>{const a=this.db.transaction(["subCategories"],"readwrite").objectStore("subCategories"),r=a.clear();r.onsuccess=()=>{const s=Object.entries(e);let c=0;const n=s.length;if(n===0){t();return}s.forEach(([u,l])=>{Array.isArray(l)&&l.forEach(d=>{const g=a.put({category:u,subCategory:d});g.onsuccess=()=>{c++,c===n&&t()},g.onerror=()=>o(g.error)})})},r.onerror=()=>o(r.error)})}async loadSubCategories(){return this.db||await this.init(),new Promise((e,t)=>{const o={},r=this.db.transaction(["subCategories"],"readonly").objectStore("subCategories").getAll();r.onsuccess=()=>{(r.result||[]).forEach(c=>{const n=c.category,u=c.subCategory;!n||!u||(o[n]||(o[n]=[]),o[n].includes(u)||o[n].push(u))}),e(o)},r.onerror=()=>t(r.error)})}async saveSystemConfig(e,t){return this.db||await this.init(),new Promise((o,i)=>{const s=this.db.transaction(["systemConfig"],"readwrite").objectStore("systemConfig").put({key:e,value:t});s.onsuccess=()=>o(),s.onerror=()=>i(s.error)})}async loadSystemConfig(e){return this.db||await this.init(),new Promise((t,o)=>{const r=this.db.transaction(["systemConfig"],"readonly").objectStore("systemConfig").get(e);r.onsuccess=()=>{var s;return t((s=r.result)==null?void 0:s.value)},r.onerror=()=>o(r.error)})}async clearDatabase(){return new Promise((e,t)=>{const o=indexedDB.deleteDatabase(this.dbName);o.onsuccess=()=>{this.db=null,e()},o.onerror=()=>t(o.error)})}async saveDailySummary(e,t){return this.db||await this.init(),new Promise((o,i)=>{const r=this.db.transaction(["dailySummary"],"readwrite").objectStore("dailySummary"),s={date:e};t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).forEach(n=>{n!=="date"&&(s[n]=t[n])}),console.log("ğŸ’¾ saveDailySummary í˜¸ì¶œ:",{date:e,summaryKeys:t?Object.keys(t):[],dataToSaveKeys:Object.keys(s)});const c=r.put(s);c.onsuccess=()=>{console.log("âœ… dailySummary ì €ì¥ ì„±ê³µ:",e),o()},c.onerror=()=>{console.error("âŒ dailySummary ì €ì¥ ì‹¤íŒ¨:",c.error,{date:e,dataToSave:s}),i(c.error)}})}async loadDailySummary(e){return this.db||await this.init(),new Promise((t,o)=>{const r=this.db.transaction(["dailySummary"],"readonly").objectStore("dailySummary").get(e);r.onsuccess=()=>t(r.result||null),r.onerror=()=>o(r.error)})}async saveClassifiedByDate(e,t){return this.db||await this.init(),new Promise((o,i)=>{const s=this.db.transaction(["classifiedByDate"],"readwrite").objectStore("classifiedByDate").put({date:e,items:t});s.onsuccess=()=>o(),s.onerror=()=>i(s.error)})}async loadClassifiedByDate(e){return this.db||await this.init(),new Promise((t,o)=>{const r=this.db.transaction(["classifiedByDate"],"readonly").objectStore("classifiedByDate").get(e);r.onsuccess=()=>{const s=r.result;t((s==null?void 0:s.items)||null)},r.onerror=()=>o(r.error)})}async updateAllCollectionDates(e){return this.db||await this.init(),new Promise((t,o)=>{const a=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=a.getAll();r.onsuccess=()=>{const s=r.result;console.log(`ğŸ“Š ì „ì²´ ë°ì´í„°: ${s.length}ê°œ`);const c=s.map(l=>({...l,collectionDate:e}));let n=0,u=0;c.forEach((l,d)=>{const g=a.put(l);g.onsuccess=()=>{n++,n%100===0&&console.log(`âœ… ${n}/${s.length} ì—…ë°ì´íŠ¸ ì™„ë£Œ`),n+u===s.length&&(console.log(`ğŸ‰ ì—…ë°ì´íŠ¸ ì™„ë£Œ! ì´ ${n}ê°œ ë°ì´í„°ë¥¼ ${e}ë¡œ ë³€ê²½`),t(n))},g.onerror=()=>{u++,console.error(`âŒ ${d+1}ë²ˆì§¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`,g.error),n+u===s.length&&(console.log(`âš ï¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${n}ê°œ ì„±ê³µ, ${u}ê°œ ì‹¤íŒ¨`),t(n))}})},r.onerror=()=>{o(r.error)}})}async listClassifiedDates(){return this.db||await this.init(),new Promise((e,t)=>{const a=this.db.transaction(["classifiedByDate"],"readonly").objectStore("classifiedByDate").getAllKeys();a.onsuccess=()=>{const r=a.result||[];e(r)},a.onerror=()=>t(a.error)})}async cleanupOldData(e=14){this.db||await this.init();const t=new Date;t.setDate(t.getDate()-e);const o=t.toISOString().split("T")[0];let i=0;const r=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),s=r.getAll();await new Promise(D=>{s.onsuccess=()=>{s.result.filter(b=>new Date(b.uploadDate)<t).forEach(b=>{r.delete(b.id),i++}),D()}});const n=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData"),u=n.getAll();await new Promise(D=>{u.onsuccess=()=>{u.result.filter(b=>new Date(b.uploadDate)<t).forEach(b=>{n.delete(b.id),i++}),D()}});const d=this.db.transaction(["videos"],"readwrite").objectStore("videos"),g=d.getAll();await new Promise(D=>{g.onsuccess=()=>{g.result.filter(b=>new Date(b.uploadDate)<t).forEach(b=>{d.delete(b.id),i++}),D()}});const y=this.db.transaction(["dailySummary"],"readwrite").objectStore("dailySummary"),f=y.getAll();return await new Promise(D=>{f.onsuccess=()=>{(f.result||[]).forEach(b=>{const S=((b==null?void 0:b.date)||"").toString();S&&S<o&&(y.delete(b.date),i++)}),D()}}),console.log(`ğŸ§¹ 7ì¼ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ: ${i}ê°œ ë°ì´í„° ì‚­ì œ`),i}async getDatabaseInfo(){this.db||await this.init();const e={name:this.dbName,version:this.version,objectStores:Array.from(this.db.objectStoreNames),size:0,retentionDays:7,lastCleanup:null};for(const t of e.objectStores){const a=this.db.transaction([t],"readonly").objectStore(t).count();await new Promise(r=>{a.onsuccess=()=>{e.size+=a.result,r()}})}try{const t=await this.loadSystemConfig("retentionDays");typeof t=="number"&&t>0&&(e.retentionDays=t)}catch{}return e}async deleteUnclassifiedDataByIds(e){return this.db||await this.init(),new Promise((t,o)=>{const a=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData");let r=0;const s=e.length;if(s===0){t();return}e.forEach(c=>{const n=a.delete(c);n.onsuccess=()=>{r++,r===s&&(console.log(`âœ… IndexedDBì—ì„œ ${s}ê°œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ`),t())},n.onerror=()=>{console.error(`âŒ ID ${c} ì‚­ì œ ì‹¤íŒ¨:`,n.error),o(n.error)}})})}async deleteDataByDate(e){return this.db||await this.init(),console.log(`ğŸ—‘ï¸ ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì‹œì‘...`),new Promise((t,o)=>{const i=this.db.transaction(["unclassifiedData","classifiedData"],"readwrite"),a=i.objectStore("unclassifiedData"),r=i.objectStore("classifiedData");let s=!1,c=!1,n=0;const u=()=>{s&&c&&(console.log(`âœ… ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ: ${n}ê°œ ì‚­ì œ`),t())},l=a.getAll();l.onsuccess=()=>{const h=l.result.filter(y=>{const f=y.collectionDate||y.uploadDate;return f&&f.split("T")[0]===e});if(console.log(`ğŸ“Š unclassifiedDataì—ì„œ ì‚­ì œí•  ë°ì´í„°: ${h.length}ê°œ`),h.length===0)s=!0,u();else{let y=0;h.forEach(f=>{const D=a.delete(f.id);D.onsuccess=()=>{y++,n++,y===h.length&&(s=!0,u())},D.onerror=()=>o(D.error)})}};const d=r.getAll();d.onsuccess=()=>{const h=d.result.filter(y=>{const f=y.collectionDate||y.uploadDate;return f&&f.split("T")[0]===e});if(console.log(`ğŸ“Š classifiedDataì—ì„œ ì‚­ì œí•  ë°ì´í„°: ${h.length}ê°œ`),h.length===0)c=!0,u();else{let y=0;h.forEach(f=>{const D=r.delete(f.id);D.onsuccess=()=>{y++,n++,y===h.length&&(c=!0,u())},D.onerror=()=>o(D.error)})}},l.onerror=()=>o(l.error),d.onerror=()=>o(d.error)})}async idempotentUpsertUnclassifiedData(e){if(!this.db)throw new Error("Database not initialized");return new Promise((t,o)=>{const a=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=a.index("videoDay");let s=0,c=0,n=0;const u=e.length;if(u===0){t();return}console.log(`ğŸ”„ IndexedDB ë©±ë“± ë³µì› ì‹œì‘: ${u}ê°œ ë ˆì½”ë“œ`),e.forEach(l=>{if(!l.dayKeyLocal&&l.collectionDate){const h=new Date(l.collectionDate);l.dayKeyLocal=h.toISOString().split("T")[0]}const d=[l.videoId,l.dayKeyLocal],g=r.get(d);g.onsuccess=()=>{if(g.result){const h=g.result,y={...h,viewCount:Math.max(h.viewCount||0,l.viewCount||0),likeCount:Math.max(h.likeCount||0,l.likeCount||0),channelName:l.channelName||h.channelName,videoTitle:l.videoTitle||h.videoTitle,videoDescription:l.videoDescription||h.videoDescription,thumbnailUrl:l.thumbnailUrl||h.thumbnailUrl,category:l.category||h.category,subCategory:l.subCategory||h.subCategory,status:l.status||h.status,updatedAt:new Date().toISOString()},f=a.put(y);f.onsuccess=()=>{c++,s++,s===u&&(console.log(`âœ… IndexedDB ë©±ë“± ë³µì› ì™„ë£Œ: ë³‘í•© ${c}ê°œ, ì‹ ê·œ ${n}ê°œ`),t())},f.onerror=()=>{console.error("IndexedDB ë³‘í•© ì‹¤íŒ¨:",f.error),s++,s===u&&t()}}else{const h={...l,id:l.id||Date.now().toString()+Math.random().toString(36).substr(2,9),createdAt:l.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()},y=a.put(h);y.onsuccess=()=>{n++,s++,s===u&&(console.log(`âœ… IndexedDB ë©±ë“± ë³µì› ì™„ë£Œ: ë³‘í•© ${c}ê°œ, ì‹ ê·œ ${n}ê°œ`),t())},y.onerror=()=>{console.error("IndexedDB ì¶”ê°€ ì‹¤íŒ¨:",y.error),s++,s===u&&t()}}},g.onerror=()=>{console.error("IndexedDB ì¡°íšŒ ì‹¤íŒ¨:",g.error),s++,s===u&&t()}})})}async upsertUnclassifiedDataWithMaxValues(e){if(!this.db)throw new Error("Database not initialized");return new Promise((t,o)=>{const a=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=a.index("videoDay");let s=0;const c=e.length;if(c===0){t();return}e.forEach(n=>{if(!n.dayKeyLocal&&n.collectionDate){const d=new Date(n.collectionDate);n.dayKeyLocal=d.toISOString().split("T")[0]}const u=[n.videoId,n.dayKeyLocal],l=r.get(u);l.onsuccess=()=>{if(l.result){const d=l.result,g={...d,viewCount:Math.max(d.viewCount||0,n.viewCount||0),likeCount:Math.max(d.likeCount||0,n.likeCount||0),channelName:n.channelName||d.channelName,videoTitle:n.videoTitle||d.videoTitle,videoDescription:n.videoDescription||d.videoDescription,thumbnailUrl:n.thumbnailUrl||d.thumbnailUrl,category:n.category||d.category,subCategory:n.subCategory||d.subCategory,status:n.status||d.status,updatedAt:new Date().toISOString()},h=a.put(g);h.onsuccess=()=>{s++,s===c&&t()},h.onerror=()=>o(h.error)}else{n.id||(n.id=`${Date.now()}_${Math.random().toString(36).substr(2,9)}`);const d=a.put(n);d.onsuccess=()=>{s++,s===c&&t()},d.onerror=()=>o(d.error)}},l.onerror=()=>o(l.error)})})}}const w=new E,U=Object.freeze(Object.defineProperty({__proto__:null,indexedDBService:w},Symbol.toStringTag,{value:"Module"})),R="https://api.youthbepulse.com";class j{constructor(){I(this,"baseURL");this.baseURL=R}async request(e,t={}){var o;try{const i=`${this.baseURL}${e}`,a=new AbortController,r=setTimeout(()=>a.abort(),6e4),s=await fetch(i,{headers:{"Content-Type":"application/json",...t.headers},signal:a.signal,...t});if(clearTimeout(r),!s.ok){let n="";try{const u=await s.json();n=JSON.stringify(u,null,2)}catch{n=`Status: ${s.status}, StatusText: ${s.statusText}`}throw console.error("ğŸš¨ ì„œë²„ ì—ëŸ¬ ìƒì„¸:",{status:s.status,statusText:s.statusText,url:i,details:n,headers:Object.fromEntries(s.headers.entries())}),new Error(`HTTP error! status: ${s.status} - ${n}`)}const c=await s.json();return c&&typeof c=="object"&&"success"in c&&"data"in c?(console.log("ğŸ“¦ ì„œë²„ ì‘ë‹µì´ ì´ë¯¸ í‘œì¤€ í˜•ì‹:",{success:c.success,dataLength:(o=c.data)==null?void 0:o.length}),c):{success:!0,data:c}}catch(i){return console.error("API ìš”ì²­ ì‹¤íŒ¨:",i),i instanceof Error&&i.name==="AbortError"?{success:!1,error:"Request timeout (60s)"}:{success:!1,error:i instanceof Error?i.message:"Unknown error"}}}async saveChannels(e){return this.request("/api/channels",{method:"POST",body:JSON.stringify({channels:e})})}async getChannels(){return this.request("/api/channels")}async saveVideos(e){return this.request("/api/videos",{method:"POST",body:JSON.stringify({videos:e})})}async getVideos(){return this.request("/api/videos")}async saveClassifiedData(e){return this.request("/api/classified",{method:"POST",body:JSON.stringify(e)})}async getClassifiedData(){return this.request("/api/classified")}async saveUnclassifiedData(e){return this.request("/api/unclassified",{method:"POST",body:JSON.stringify(e)})}async getUnclassifiedData(){return this.request("/api/unclassified")}async getDataIds(){return this.request("/api/data/ids")}async saveSystemConfig(e,t){return this.request("/api/system/config",{method:"POST",body:JSON.stringify({key:e,value:t})})}async getSystemConfig(e){return this.request(`/api/system/config/${e}`)}async saveDailyStats(e,t){return this.request("/api/daily-stats",{method:"POST",body:JSON.stringify({date:e,stats:t})})}async getDailyStats(e){const t=e?`/api/daily-stats/${e}`:"/api/daily-stats";return this.request(t)}async testConnection(){return this.request("/api/health")}async updateVideo(e,t){return this.request(`/api/videos/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async deleteVideo(e){return this.request(`/api/videos/${e}`,{method:"DELETE"})}async deleteVideosBatch(e){return this.request("/api/videos/batch",{method:"DELETE",body:JSON.stringify({ids:e})})}}const m=new j;class N{constructor(e={}){I(this,"dbName","YouTubePulseOutbox");I(this,"dbVersion",1);I(this,"storeName","outbox");I(this,"config");this.config={maxRetries:3,retryDelay:5e3,batchSize:10,...e}}async initDB(){return new Promise((e,t)=>{const o=indexedDB.open(this.dbName,this.dbVersion);o.onerror=()=>t(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=i=>{const a=i.target.result;if(!a.objectStoreNames.contains(this.storeName)){const r=a.createObjectStore(this.storeName,{keyPath:"id"});r.createIndex("timestamp","timestamp"),r.createIndex("status","status"),r.createIndex("type","type")}}})}async addToOutbox(e,t,o){const i=`outbox_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={id:i,type:e,endpoint:t,payload:o,timestamp:Date.now(),retries:0,maxRetries:this.config.maxRetries,status:"pending"};try{const c=(await this.initDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName);return await new Promise((n,u)=>{const l=c.add(a);l.onsuccess=()=>n(),l.onerror=()=>u(l.error)}),console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€: ${e} ${t}`,a),i}catch(r){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",r),r}}async getPendingItems(){try{const i=(await this.initDB()).transaction([this.storeName],"readonly").objectStore(this.storeName).index("status");return new Promise((a,r)=>{const s=i.getAll("pending");s.onsuccess=()=>a(s.result),s.onerror=()=>r(s.error)})}catch(e){return console.error("âŒ ëŒ€ê¸° ì‘ì—… ì¡°íšŒ ì‹¤íŒ¨:",e),[]}}async updateItemStatus(e,t,o){try{const r=(await this.initDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName),s=r.get(e);await new Promise((c,n)=>{s.onsuccess=()=>{const u=s.result;if(u){u.status=t,u.error=o,t==="failed"&&(u.retries+=1);const l=r.put(u);l.onsuccess=()=>c(),l.onerror=()=>n(l.error)}else n(new Error("Item not found"))},s.onerror=()=>n(s.error)}),console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸: ${e} â†’ ${t}`)}catch(i){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",i),i}}async removeCompletedItems(){try{const o=(await this.initDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName),i=o.index("status");await new Promise((a,r)=>{const s=i.getAllKeys("completed");s.onsuccess=()=>{const c=s.result;if(c.length===0){a();return}let n=0;c.forEach(u=>{const l=o.delete(u);l.onsuccess=()=>{n++,n===c.length&&a()},l.onerror=()=>r(l.error)})},s.onerror=()=>r(s.error)}),console.log("ğŸ—‘ï¸ ì™„ë£Œëœ ì•„ì›ƒë°•ìŠ¤ ì‘ì—… ì œê±° ì™„ë£Œ")}catch(e){console.error("âŒ ì™„ë£Œëœ ì‘ì—… ì œê±° ì‹¤íŒ¨:",e)}}async processOutbox(){const e=await this.getPendingItems();if(e.length===0)return{success:0,failed:0};console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì²˜ë¦¬ ì‹œì‘: ${e.length}ê°œ ì‘ì—…`);let t=0,o=0;for(let i=0;i<e.length;i+=this.config.batchSize){const a=e.slice(i,i+this.config.batchSize);await Promise.allSettled(a.map(async r=>{try{if(r.retries>=r.maxRetries){await this.updateItemStatus(r.id,"failed","Max retries exceeded"),o++;return}const s=await fetch(r.endpoint,{method:r.type==="update"?"PATCH":r.type==="delete"?"DELETE":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.payload)});if(s.ok)await this.updateItemStatus(r.id,"completed"),t++,console.log(`âœ… ì•„ì›ƒë°•ìŠ¤ ì‘ì—… ì„±ê³µ: ${r.type} ${r.endpoint}`);else throw new Error(`HTTP ${s.status}: ${s.statusText}`)}catch(s){console.error(`âŒ ì•„ì›ƒë°•ìŠ¤ ì‘ì—… ì‹¤íŒ¨: ${r.type} ${r.endpoint}`,s),await this.updateItemStatus(r.id,"failed",s instanceof Error?s.message:"Unknown error"),o++}})),i+this.config.batchSize<e.length&&await new Promise(r=>setTimeout(r,1e3))}return await this.removeCompletedItems(),console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì²˜ë¦¬ ì™„ë£Œ: ì„±ê³µ ${t}ê°œ, ì‹¤íŒ¨ ${o}ê°œ`),{success:t,failed:o}}startAutoProcess(){navigator.onLine&&setTimeout(()=>this.processOutbox(),2e3),window.addEventListener("online",()=>{console.log("ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœ ê°ì§€ - ì•„ì›ƒë°•ìŠ¤ ì²˜ë¦¬ ì‹œì‘"),setTimeout(()=>this.processOutbox(),1e3)}),setInterval(()=>{navigator.onLine&&this.processOutbox()},5*60*1e3)}async getStats(){try{const o=(await this.initDB()).transaction([this.storeName],"readonly").objectStore(this.storeName),i=await new Promise((a,r)=>{const s=o.getAll();s.onsuccess=()=>a(s.result),s.onerror=()=>r(s.error)});return{pending:i.filter(a=>a.status==="pending").length,failed:i.filter(a=>a.status==="failed").length,completed:i.filter(a=>a.status==="completed").length}}catch(e){return console.error("âŒ ì•„ì›ƒë°•ìŠ¤ í†µê³„ ì¡°íšŒ ì‹¤íŒ¨:",e),{pending:0,failed:0,completed:0}}}}const P=new N;class O{constructor(){I(this,"config");const e=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";this.config={useApiServer:!0,fallbackToLocal:!0},console.log(e?"ğŸ”§ ê°œë°œ í™˜ê²½: IndexedDB + PostgreSQL (í•˜ì´ë¸Œë¦¬ë“œ)":"ğŸŒ í”„ë¡œë•ì…˜ í™˜ê²½: IndexedDB + PostgreSQL (í•˜ì´ë¸Œë¦¬ë“œ)")}updateConfig(e){this.config={...this.config,...e}}async bootstrapSync(){try{console.log("ğŸ”„ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë™ê¸°í™” ì‹œì‘ - ì°¨ë¶„ ì—…ë¡œë“œ ë°©ì‹...");const[e,t]=await Promise.all([w.loadUnclassifiedData(),w.loadClassifiedData()]),o=((e==null?void 0:e.length)||0)+((t==null?void 0:t.length)||0);if(console.log(`ğŸ“Š ë¡œì»¬ ë°ì´í„°: ë¯¸ë¶„ë¥˜ ${(e==null?void 0:e.length)||0}ê°œ, ë¶„ë¥˜ ${(t==null?void 0:t.length)||0}ê°œ, ì´ ${o}ê°œ`),o===0)return{success:!0,uploaded:0,message:"ì—…ë¡œë“œí•  ë¡œì»¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."};console.log("ğŸ” ì„œë²„ ë°ì´í„° ID ëª©ë¡ ì¡°íšŒ ì¤‘...");const i=await m.getDataIds();let a=new Set,r=new Set;i.success&&i.data?(a=new Set(i.data.unclassifiedIds),r=new Set(i.data.classifiedIds),console.log(`ğŸ“Š ì„œë²„ ê¸°ì¡´ ë°ì´í„°: ë¯¸ë¶„ë¥˜ ${a.size}ê°œ, ë¶„ë¥˜ ${r.size}ê°œ`)):console.log("âš ï¸ ì„œë²„ ë°ì´í„° ID ì¡°íšŒ ì‹¤íŒ¨, ì „ì²´ ì—…ë¡œë“œ ì§„í–‰");const s=(e==null?void 0:e.filter(d=>!a.has(String(d.id))))||[],c=(t==null?void 0:t.filter(d=>!r.has(String(d.id))))||[],n=s.length+c.length;if(console.log(`ğŸ“Š ì°¨ë¶„ ê³„ì‚° ê²°ê³¼: ìƒˆë¡œìš´ ë°ì´í„° ${n}ê°œ (ë¯¸ë¶„ë¥˜: ${s.length}ê°œ, ë¶„ë¥˜: ${c.length}ê°œ)`),console.log(`ğŸ“Š ì¤‘ë³µ ì œì™¸: ë¯¸ë¶„ë¥˜ ${((e==null?void 0:e.length)||0)-s.length}ê°œ, ë¶„ë¥˜ ${((t==null?void 0:t.length)||0)-c.length}ê°œ`),n===0)return{success:!0,uploaded:0,message:"ì„œë²„ì— ì´ë¯¸ ëª¨ë“  ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ì—…ë¡œë“œí•  ìƒˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."};let u=0;const l=500;if(s&&s.length>0){console.log(`ğŸ“¤ ìƒˆë¡œìš´ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—…ë¡œë“œ ì‹œì‘: ${s.length}ê°œ`);for(let d=0;d<s.length;d+=l){const g=s.slice(d,d+l),h=Math.floor(d/l)+1,y=Math.ceil(s.length/l);console.log(`ğŸ“¦ ë¯¸ë¶„ë¥˜ ì²­í¬ ${h}/${y} ì—…ë¡œë“œ ì¤‘... (${g.length}ê°œ)`);try{const f=await m.saveUnclassifiedData(g);f.success?(u+=g.length,console.log(`âœ… ë¯¸ë¶„ë¥˜ ì²­í¬ ${h}/${y} ì—…ë¡œë“œ ì™„ë£Œ`)):console.error(`âŒ ë¯¸ë¶„ë¥˜ ì²­í¬ ${h} ì—…ë¡œë“œ ì‹¤íŒ¨:`,f.error),d+l<e.length&&await new Promise(D=>setTimeout(D,300))}catch(f){console.error(`âŒ ë¯¸ë¶„ë¥˜ ì²­í¬ ${h} ì—…ë¡œë“œ ì˜¤ë¥˜:`,f),console.log(`ğŸ”„ ì²­í¬ ${h} ì¬ì‹œë„ ì¤‘...`);try{(await m.saveUnclassifiedData(g)).success&&(u+=g.length,console.log(`âœ… ë¯¸ë¶„ë¥˜ ì²­í¬ ${h} ì¬ì‹œë„ ì„±ê³µ`))}catch{console.error(`âŒ ì²­í¬ ${h} ì¬ì‹œë„ ì‹¤íŒ¨, ê±´ë„ˆëœ€`)}}}console.log(`âœ… ë¯¸ë¶„ë¥˜ ë°ì´í„° ì „ì²´ ì—…ë¡œë“œ ì™„ë£Œ: ${u}ê°œ`)}if(c&&c.length>0){console.log(`ğŸ“¤ ìƒˆë¡œìš´ ë¶„ë¥˜ ë°ì´í„° ì—…ë¡œë“œ ì‹œì‘: ${c.length}ê°œ`);for(let d=0;d<c.length;d+=l){const g=c.slice(d,d+l),h=Math.floor(d/l)+1,y=Math.ceil(c.length/l);console.log(`ğŸ“¦ ë¶„ë¥˜ ì²­í¬ ${h}/${y} ì—…ë¡œë“œ ì¤‘... (${g.length}ê°œ)`);try{const f=await m.saveClassifiedData(g);f.success?(u+=g.length,console.log(`âœ… ë¶„ë¥˜ ì²­í¬ ${h}/${y} ì—…ë¡œë“œ ì™„ë£Œ`)):console.error(`âŒ ë¶„ë¥˜ ì²­í¬ ${h} ì—…ë¡œë“œ ì‹¤íŒ¨:`,f.error),d+l<t.length&&await new Promise(D=>setTimeout(D,300))}catch(f){console.error(`âŒ ë¶„ë¥˜ ì²­í¬ ${h} ì—…ë¡œë“œ ì˜¤ë¥˜:`,f),console.log(`ğŸ”„ ì²­í¬ ${h} ì¬ì‹œë„ ì¤‘...`);try{(await m.saveClassifiedData(g)).success&&(u+=g.length,console.log(`âœ… ë¶„ë¥˜ ì²­í¬ ${h} ì¬ì‹œë„ ì„±ê³µ`))}catch{console.error(`âŒ ì²­í¬ ${h} ì¬ì‹œë„ ì‹¤íŒ¨, ê±´ë„ˆëœ€`)}}}console.log("âœ… ë¶„ë¥˜ ë°ì´í„° ì „ì²´ ì—…ë¡œë“œ ì™„ë£Œ")}console.log("ğŸ”„ ì„œë²„ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ë¡œì»¬ ìºì‹œ ê°±ì‹  ì¤‘...");try{const[d,g]=await Promise.all([this.loadUnclassifiedData(),this.getClassifiedData()]);console.log(`âœ… ì„œë²„ ìŠ¤ëƒ…ìƒ· ì¬ì ì¬ ì™„ë£Œ: ë¯¸ë¶„ë¥˜ ${(d==null?void 0:d.length)||0}ê°œ, ë¶„ë¥˜ ${(g==null?void 0:g.length)||0}ê°œ`)}catch(d){console.warn("âš ï¸ ìºì‹œ ê°±ì‹  ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì—…ë¡œë“œë¨):",d)}return console.log("âœ… ë¶€íŠ¸ìŠ¤íŠ¸ë© ë™ê¸°í™” ì™„ë£Œ!"),{success:!0,uploaded:u,message:`${u.toLocaleString()}ê°œì˜ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì—…ë¡œë“œí–ˆìŠµë‹ˆë‹¤.

ì¤‘ë³µ ì œì™¸: ${o-n}ê°œ`}}catch(e){return console.error("âŒ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë™ê¸°í™” ì‹¤íŒ¨:",e),{success:!1,uploaded:0,message:`ë™ê¸°í™” ì‹¤íŒ¨: ${e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`}}}async saveChannels(e){try{if(this.config.useApiServer){const t=await m.saveChannels(e);if(t.success)console.log("âœ… API ì„œë²„ì— ì±„ë„ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await w.saveChannels(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ì±„ë„ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ì±„ë„ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await w.saveChannels(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getChannels(){try{if(this.config.useApiServer){const e=await m.getChannels();if(e.success&&e.data)return console.log("âœ… API ì„œë²„ì—ì„œ ì±„ë„ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ"),e.data}if(this.config.fallbackToLocal){const e=await w.getChannels();return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ì±„ë„ ë°ì´í„° ì¡°íšŒ"),e}return{}}catch(e){return console.error("âŒ ì±„ë„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal?await w.getChannels():{}}}async saveVideos(e){try{if(this.config.useApiServer){const t=await m.saveVideos(e);if(t.success)console.log("âœ… API ì„œë²„ì— ë¹„ë””ì˜¤ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await w.saveVideos(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ë¹„ë””ì˜¤ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ë¹„ë””ì˜¤ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await w.saveVideos(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getVideos(){try{if(this.config.useApiServer){const e=await m.getVideos();if(e.success&&e.data)return console.log("âœ… API ì„œë²„ì—ì„œ ë¹„ë””ì˜¤ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ"),e.data}if(this.config.fallbackToLocal){const e=await w.getVideos();return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ë¹„ë””ì˜¤ ë°ì´í„° ì¡°íšŒ"),e}return{}}catch(e){return console.error("âŒ ë¹„ë””ì˜¤ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal?await w.getVideos():{}}}async adaptiveBatchUpload(e,t,o){var l,d,g,h;let s=500,c=0,n=0;const u=[];console.log(`ğŸ“¦ ì–´ëŒ‘í‹°ë¸Œ ë°°ì¹˜ ì—…ë¡œë“œ ì‹œì‘: ${e.length}ê°œ (${o})`);for(let y=0;y<e.length;y+=s){const f=e.slice(y,y+s),D=Math.floor(y/s)+1,v=Math.ceil(e.length/s);console.log(`ğŸ“¦ ë°°ì¹˜ ${D}/${v} ì „ì†¡ ì¤‘... (${f.length}ê°œ, í¬ê¸°: ${s})`);let b=!1,S=0;for(;S<3&&!b;)try{const p=JSON.stringify(f).length,x=((l=f[0])==null?void 0:l.id)||"unknown",A=((d=f[f.length-1])==null?void 0:d.id)||"unknown";console.log("ğŸ“Š ë°°ì¹˜ ìš”ì²­ ì •ë³´:",{batchNum:D,size:f.length,payloadBytes:p,firstId:x,lastId:A,retryAttempt:S+1});const C=await t(f);if(C.success)console.log(`âœ… ë°°ì¹˜ ${D} ì „ì†¡ ì™„ë£Œ (ì‹œë„ ${S+1})`),b=!0,c+=f.length,s<1e3&&S===0&&(s=Math.min(s+50,1e3));else throw new Error(C.error||"API ì‘ë‹µ ì‹¤íŒ¨")}catch(p){S++;const x=((g=p.message)==null?void 0:g.includes("status: 500"))||((h=p.message)==null?void 0:h.includes("status: 413"));if(console.error(`âŒ ë°°ì¹˜ ${D} ì „ì†¡ ì‹¤íŒ¨ (ì‹œë„ ${S}/3):`,{error:p.message,isServerError:x,currentBatchSize:s}),x&&S<3){s=Math.max(Math.floor(s/2),50),console.log(`ğŸ”„ ë°°ì¹˜ í¬ê¸° ì¶•ì†Œ: ${s}`);const A=Math.pow(2,S-1)*1e3;console.log(`â³ ë°±ì˜¤í”„ ëŒ€ê¸°: ${A}ms`),await new Promise(T=>setTimeout(T,A));const C=f.slice(0,s);C.length<f.length&&e.splice(y+C.length,0,...f.slice(C.length)),f.length=C.length,Object.assign(f,C)}else S>=3&&(console.error(`ğŸ’€ ë°°ì¹˜ ${D} ë°ë“œë ˆí„° íë¡œ ì´ë™:`,f.map(A=>A.id)),u.push(...f),n+=f.length,b=!0)}y+s<e.length&&await new Promise(p=>setTimeout(p,1e3))}return console.log("ğŸ“Š ì–´ëŒ‘í‹°ë¸Œ ë°°ì¹˜ ì—…ë¡œë“œ ì™„ë£Œ:",{success:c,failed:n,deadLetter:u.length,finalBatchSize:s}),{success:c,failed:n,deadLetterItems:u}}async saveClassifiedData(e){try{if(this.config.useApiServer)if(Array.isArray(e)&&e.length>500){const t=await this.adaptiveBatchUpload(e,o=>m.saveClassifiedData(o),"ë¶„ë¥˜ ë°ì´í„°");t.deadLetterItems.length>0&&console.warn(`âš ï¸ ${t.deadLetterItems.length}ê°œ í•­ëª©ì´ ë°ë“œë ˆí„° íë¡œ ì´ë™ë¨`)}else{const t=await m.saveClassifiedData(e);if(t.success)console.log("âœ… API ì„œë²„ì— ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await w.saveClassifiedData(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await w.saveClassifiedData(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getClassifiedData(){try{if(this.config.useApiServer){const e=await m.getClassifiedData(),t=Array.isArray(e)?e:e.success&&e.data&&Array.isArray(e.data)?e.data:[];if(t.length>0){console.log("âœ… API ì„œë²„ì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ:",t.length,"ê°œ");try{await w.saveClassifiedData(t),console.log("âœ… IndexedDB ìºì‹œ ê°±ì‹  ì™„ë£Œ")}catch(o){console.warn("âš ï¸ IndexedDB ìºì‹œ ê°±ì‹  ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì •ìƒ ë°˜í™˜):",o)}return t}}if(this.config.fallbackToLocal){const e=await w.loadClassifiedData();return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ (ì„œë²„ ì—°ê²° ì‹¤íŒ¨)"),e}return[]}catch(e){if(console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal){const t=await w.loadClassifiedData();return console.log("âš ï¸ ì˜¤ë¥˜ ë°œìƒ, ë¡œì»¬ IndexedDB í´ë°±"),t}return[]}}async saveUnclassifiedData(e){try{if(this.config.useApiServer)if(Array.isArray(e)&&e.length>500){const t=await this.adaptiveBatchUpload(e,o=>m.saveUnclassifiedData(o),"ë¯¸ë¶„ë¥˜ ë°ì´í„°");t.deadLetterItems.length>0&&console.warn(`âš ï¸ ${t.deadLetterItems.length}ê°œ í•­ëª©ì´ ë°ë“œë ˆí„° íë¡œ ì´ë™ë¨`)}else{const t=await m.saveUnclassifiedData(e);if(t.success)console.log("âœ… API ì„œë²„ì— ë¯¸ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await w.saveUnclassifiedData(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ë¯¸ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await w.saveUnclassifiedData(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getUnclassifiedData(){try{if(this.config.useApiServer){const e=await m.getUnclassifiedData(),t=Array.isArray(e)?e:e.success&&e.data&&Array.isArray(e.data)?e.data:[];if(t.length>0)return console.log("âœ… API ì„œë²„ì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ:",t.length,"ê°œ"),t}if(this.config.fallbackToLocal){const e=await w.loadUnclassifiedData();return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ"),e}return[]}catch(e){if(console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),console.error("âŒ ì—ëŸ¬ ìƒì„¸:",{message:e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜",stack:e instanceof Error?e.stack:void 0,error:e}),this.config.fallbackToLocal){console.log("ğŸ”„ ë¡œì»¬ IndexedDBë¡œ í´ë°± ì‹œë„...");try{return await w.loadUnclassifiedData()}catch(t){return console.error("âŒ ë¡œì»¬ IndexedDB ì¡°íšŒë„ ì‹¤íŒ¨:",t),[]}}return[]}}async loadUnclassifiedData(){try{const e=await w.loadUnclassifiedData();return console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ"),e}catch(e){return console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",e),[]}}async loadUnclassifiedDataByDate(e){try{const t=await w.loadUnclassifiedDataByDate(e);return console.log(`âœ… í•˜ì´ë¸Œë¦¬ë“œ: ${e} ë‚ ì§œ ë°ì´í„° ë¡œë“œ`),t}catch(t){return console.error("âŒ ë‚ ì§œë³„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",t),[]}}async updateUnclassifiedData(e){try{await this.saveUnclassifiedData(e),console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ")}catch(t){throw console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",t),t}}async loadClassifiedData(){try{const e=await w.loadClassifiedData();return console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: IndexedDBì—ì„œ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ"),e}catch(e){return console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",e),[]}}async loadClassifiedByDate(e){try{const t=await w.loadClassifiedByDate(e);return console.log(`âœ… í•˜ì´ë¸Œë¦¬ë“œ: ${e} ë‚ ì§œ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ`),t||[]}catch(t){return console.error("âŒ ë‚ ì§œë³„ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",t),[]}}async saveDailyProgress(e){try{await w.saveDailyProgress(e),console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ì¼ë³„ ì§„í–‰ë¥  ì €ì¥ ì™„ë£Œ")}catch(t){throw console.error("âŒ ì¼ë³„ ì§„í–‰ë¥  ì €ì¥ ì‹¤íŒ¨:",t),t}}async getAvailableDates(){try{const e=await w.getAvailableDates();return console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ì‚¬ìš© ê°€ëŠ¥í•œ ë‚ ì§œ ì¡°íšŒ"),e}catch(e){return console.error("âŒ ë‚ ì§œ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:",e),[]}}async saveSystemConfig(e,t){try{if(this.config.useApiServer){const o=await m.saveSystemConfig(e,t);if(o.success)console.log("âœ… API ì„œë²„ì— ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì™„ë£Œ");else throw new Error(o.error||"API ì €ì¥ ì‹¤íŒ¨")}await w.saveSystemConfig(e,t),console.log("âœ… ë¡œì»¬ IndexedDBì— ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì™„ë£Œ")}catch(o){if(console.error("âŒ ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:",o),this.config.fallbackToLocal)await w.saveSystemConfig(e,t),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw o}}async getSystemConfig(e){try{if(this.config.useApiServer){const t=await m.getSystemConfig(e);if(t.success&&t.data!==void 0)return console.log("âœ… API ì„œë²„ì—ì„œ ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ ì™„ë£Œ"),t.data}if(this.config.fallbackToLocal){const t=await w.getSystemConfig(e);return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ"),t}return null}catch(t){return console.error("âŒ ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨:",t),this.config.fallbackToLocal?await w.getSystemConfig(e):null}}async saveCategories(e){try{this.config.useApiServer&&console.log("âš ï¸ API ì„œë²„ ì¹´í…Œê³ ë¦¬ ì €ì¥ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."),await w.saveCategories(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await w.saveCategories(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async loadCategories(){try{if(this.config.useApiServer&&console.log("âš ï¸ API ì„œë²„ ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."),this.config.fallbackToLocal){const e=await w.loadCategories();return console.log("âœ… ë¡œì»¬ IndexedDBì—ì„œ ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì¡°íšŒ"),e}return null}catch(e){return console.error("âŒ ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal?await w.loadCategories():null}}async testApiConnection(){try{return(await m.testConnection()).success}catch(e){return console.error("âŒ API ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:",e),!1}}async syncToApi(){try{console.log("ğŸ”„ ë°ì´í„° ë™ê¸°í™” ì‹œì‘...");const e=await w.getChannels();Object.keys(e).length>0&&await this.saveChannels(e);const t=await w.getVideos();Object.keys(t).length>0&&await this.saveVideos(t);const o=await w.getClassifiedData();o.length>0&&await this.saveClassifiedData(o);const i=await w.loadUnclassifiedData();i.length>0&&await this.saveUnclassifiedData(i),console.log("âœ… ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ")}catch(e){throw console.error("âŒ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:",e),e}}async safeUpdateVideo(e,t){try{if(this.config.useApiServer){const o=await m.updateVideo(e,t);if(o.success)return console.log(`âœ… ë¹„ë””ì˜¤ ì—…ë°ì´íŠ¸ ì„±ê³µ: ${e}`),{success:!0};throw new Error(o.error||"Update failed")}}catch(o){console.warn("âš ï¸ ì„œë²„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨, ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€:",o);try{const i=await P.addToOutbox("update",`/api/videos/${e}`,t);return console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€ë¨: ${i}`),{success:!1,outboxId:i}}catch(i){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",i),i}}return{success:!1}}async safeDeleteVideo(e){try{if(this.config.useApiServer){const t=await m.deleteVideo(e);if(t.success)return console.log(`âœ… ë¹„ë””ì˜¤ ì‚­ì œ ì„±ê³µ: ${e}`),{success:!0};throw new Error(t.error||"Delete failed")}}catch(t){console.warn("âš ï¸ ì„œë²„ ì‚­ì œ ì‹¤íŒ¨, ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€:",t);try{const o=await P.addToOutbox("delete",`/api/videos/${e}`,{});return console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€ë¨: ${o}`),{success:!1,outboxId:o}}catch(o){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",o),o}}return{success:!1}}async safeDeleteVideosBatch(e){try{if(this.config.useApiServer){const t=await m.deleteVideosBatch(e);if(t.success)return console.log(`âœ… ë°°ì¹˜ ì‚­ì œ ì„±ê³µ: ${e.length}ê°œ`),{success:!0};throw new Error(t.error||"Batch delete failed")}}catch(t){console.warn("âš ï¸ ì„œë²„ ë°°ì¹˜ ì‚­ì œ ì‹¤íŒ¨, ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€:",t);try{const o=await P.addToOutbox("delete","/api/videos/batch",{ids:e});return console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€ë¨: ${o}`),{success:!1,outboxId:o}}catch(o){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",o),o}}return{success:!1}}initializeOutbox(){console.log("ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì„œë¹„ìŠ¤ ì´ˆê¸°í™”"),P.startAutoProcess()}async getOutboxStats(){return await P.getStats()}async processOutbox(){return await P.processOutbox()}}const L=new O,M=Object.freeze(Object.defineProperty({__proto__:null,hybridService:L},Symbol.toStringTag,{value:"Module"}));export{m as a,U as b,M as c,L as h,w as i};
