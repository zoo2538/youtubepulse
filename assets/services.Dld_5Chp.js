const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.BVcciKWp.js","assets/vendor.D1asM074.js","assets/utils.Bm5ISXTH.js","assets/ui.DbvV6e46.js","assets/scheduler.Dw8BlIlg.js","assets/index.Dnp3_wCa.css"])))=>i.map(i=>d[i]);
var _=Object.defineProperty;var M=(p,e,t)=>e in p?_(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var I=(p,e,t)=>M(p,typeof e!="symbol"?e+"":e,t);import{_ as L}from"./utils.Bm5ISXTH.js";const T={ì§œì§‘ê¸°:["ë“œë¼ë§ˆ/ì˜í™”","ë“œë¼ë§ˆ/ì˜í™” (ë¡±í¼)","ì‡¼ì¸  ë“œë¼ë§ˆ","ì´ì•¼ê¸°/ì° (ì„¤ì •)","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],í•´ì™¸ì§œì§‘ê¸°:["ì´ìŠˆ/ì •ë³´","ì´ì•¼ê¸°/ì° (ì„¤ì •)","ìœ ë¨¸/ì›ƒìŒ/ê°ë™","ìˆì¸  ë“œë¼ë§ˆ","ì¢…í•©/ì˜ˆëŠ¥","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ì—°ì˜ˆ:["ì•„ì´ëŒ/ì´ìŠˆ/ì •ë³´","íŠ¸ë¡¯/ì´ìŠˆ/ì •ë³´","ì—°ì˜ˆì¸/ì´ìŠˆ/ì •ë³´","íŒ¬íŠœë¸Œ (ì•„ì´ëŒ)","íŒ¬íŠœë¸Œ (ì•„ì´ëŒì™¸)","ì¢…í•©/ì˜ˆëŠ¥","ì „ë¬¸/ë¸Œëœë“œ","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ì‹œë‹ˆì–´:["ì´ì•¼ê¸°/ì°/ì‚¬ì—°","ê±´ê°•/ìš´ë™/íŒ¨ì…˜","ì •ë³´/êµìœ¡/ëª…ì–¸","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ì •ì¹˜:["ì´ìŠˆ/ì •ë³´/ìš”ì•½","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ì‚¬íšŒ/ê²½ì œ/ì‹œì‚¬":["ë‰´ìŠ¤/ìš”ì•½/í•˜ì´ë¼ì´íŠ¸","ì´ìŠˆ/ì •ë³´/ì°","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ì»¤ë®¤ë‹ˆí‹°/ì°":["ì´ìŠˆ/ì •ë³´","ì´ì•¼ê¸°/ì° (ì„¤ì •)","ìœ ë¨¸/ì›ƒìŒ/ê°ë™","êµ­ë½•/íë§","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ë¼ì´í”„ìŠ¤íƒ€ì¼:["ê±´ê°•/ìš´ë™","ì—¬í–‰/ê´€ê´‘","ì·¨ë¯¸/ì—¬ê°€","ì¸í…Œë¦¬ì–´/í™ˆë°ì½”","íŒ¨ì…˜/ë·°í‹°","ë°˜ë ¤ë™ë¬¼","ì¼ìƒ/ë¸Œì´ë¡œê·¸","ìš”ë¦¬/í•œì‹","ìŒì‹/ë¨¹ë°©","ê²°í˜¼/ìœ¡ì•„ (ì •ë³´,ì¼ìƒ)","ê°œì¸ ë°©ì†¡","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],í¬ë¦¬ì—ì´í„°:["ê°œì¸/ë¸Œì´ë¡œê·¸","êµìœ¡/ê°•ì˜","ë¦¬ë·°/ë¶„ì„","ì–´ë¦°ì´ì „ë¬¸","ìŒì•…/ë¦¬ì•¡ì…˜","í”Œë ˆì´ë¦¬ìŠ¤íŠ¸/ASMR","ìˆì¸  ë“œë¼ë§ˆ","ê°œì¸ ë°©ì†¡","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"AI/ì»´í“¨í„°/ê¸°ìˆ ":["ì´ìŠˆ/ì •ë³´/ì°","AI ì˜ìƒ/ì´ì•¼ê¸°","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ìŠ¤í¬ì¸ :["ì´ìŠˆ/ì •ë³´/ì°","ìš”ì•½/í•˜ì´ë¼ì´íŠ¸/ë¦¬ë·°","íŒ¬íŠœë¸Œ","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ê²Œì„:["ì‹¤ì‹œê°„/í”Œë ˆì´","ì •ë³´/ì´ìŠˆ/ê³µëµ/ìš”ì•½","íŒ¬íŠœë¸Œ","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ì˜¤í”¼ì…œ:["ê³µì‹/ë¸Œëœë“œ","ê°œì¸/ë¸Œëœë“œ","ì „ë¬¸/ë¸Œëœë“œ","ê°œì¸ ë°©ì†¡ (ë¼ë°©ì™¸)","ì¢…í•©/ê¸°íƒ€ (ë¸Œëœë“œ)","ì¢…í•©/ê¸°íƒ€","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ì‡¼í•‘/ë¦¬ë·°":["ìƒí™œ ì œí’ˆ","íŒ¨ì…˜/ë·°í‹°","ì „ë¬¸ ì œí’ˆ","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ì• ë‹ˆ/ì›¹íˆ°":["ìš”ì•½/í•˜ì´ë¼ì´íŠ¸/ë¦¬ë·°","ì´ìŠˆ/ì •ë³´/ì°","ë•í›„ì¡´","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ê¸°íƒ€(êµ­ë‚´)":["ê¸°íƒ€ (ë¸Œëœë“œ)","ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì°¸ê³ )","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€ (ê²Œì„)","ê¸°íƒ€ (ì–´ë¦°ì´)","ê¸°íƒ€ (ê¸°íƒ€)","ë§Œí™” (ì˜ì–´ì±„ë„)","K-POP (ì˜ì–´ì±„ë„)","ë“œë¼ë§ˆ, ì˜í™” (ì˜ì–´ì±„ë„)"],"ê¸°íƒ€(í•´ì™¸)":["ê¸°íƒ€","ê¸°íƒ€ (ë¸Œëœë“œ)","ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€ (ê²Œì„)","ê¸°íƒ€ (ì‡¼í•‘)","ì™¸êµ­ ë“œë¼ë§ˆ, ì˜í™”","ì™¸êµ­ ë…¸ë˜","ì™¸êµ­ ë§Œí™”","ì™¸êµ­ ì˜ˆëŠ¥","ê¸°íƒ€ (ì°¸ê³ )"],ê¸°íƒ€:["ê¸°íƒ€","ê¸°íƒ€ (ë¸Œëœë“œ)","ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì°¸ê³ )","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€ (ê²Œì„)","ê¸°íƒ€ (ìŒì•…)","ê¸°íƒ€ (ì‚­ì œ)"]},Q=Object.keys(T),ee={ì§œì§‘ê¸°:"#00FFFF",í•´ì™¸ì§œì§‘ê¸°:"#84CC16",ì •ì¹˜:"#EF4444","AI/ì»´í“¨í„°/ê¸°ìˆ ":"#10B981",ì—°ì˜ˆ:"#EC4899",ìŠ¤í¬ì¸ :"#06B6D4",ì‹œë‹ˆì–´:"#C0C0C0","ì»¤ë®¤ë‹ˆí‹°/ì°":"#F97316",ê²Œì„:"#8B4513",ë¼ì´í”„ìŠ¤íƒ€ì¼:"#20B2AA",ì˜¤í”¼ì…œ:"#6366F1",í¬ë¦¬ì—ì´í„°:"#FFEB3B","ì‡¼í•‘/ë¦¬ë·°":"#8B5CF6","ì• ë‹ˆ/ì›¹íˆ°":"#FFB6C1","ê¸°íƒ€(êµ­ë‚´)":"#FF6B6B","ê¸°íƒ€(í•´ì™¸)":"#4ECDC4",ê¸°íƒ€:"#6B7280","ì‚¬íšŒ/ê²½ì œ/ì‹œì‚¬":"#15803D"},q={í¬ë¦¬ì—ì´í„°:["ì „ë¬¸ë¸Œëœë“œ"]};function R(p){if(!p)return null;const e={};return Object.keys(p).forEach(t=>{const s=Array.isArray(p[t])?p[t]:[],a=q[t]||[],o=s.filter(r=>!a.includes(r));e[t]=o}),e}function K(p){const e={},t=p||{};return Object.keys(T).forEach(s=>{const a=T[s]||[],o=Array.isArray(t[s])?t[s]:[],r=[...new Set([...o,...a])],n=q[s]||[];e[s]=r.filter(l=>!n.includes(l))}),Object.keys(t).forEach(s=>{if(!e[s]){const a=q[s]||[],o=Array.isArray(t[s])?t[s]:[];e[s]=o.filter(r=>!a.includes(r))}}),e}const E=14;class V{constructor(){I(this,"dbName","YouTubePulseDB");I(this,"version",11);I(this,"db",null)}async restartConnection(){console.log("ğŸ”„ IndexedDB ì—°ê²° ì¬ì‹œì‘ ì¤‘..."),this.db&&(this.db.close(),this.db=null),await new Promise(e=>setTimeout(e,500)),await this.init(),console.log("âœ… IndexedDB ì—°ê²° ì¬ì‹œì‘ ì™„ë£Œ")}async init(){if(this.db&&this.db.readyState==="open"){console.log("âœ… IndexedDBService ì´ë¯¸ ì´ˆê¸°í™”ë¨");return}return this.db&&(this.db.close(),this.db=null),await new Promise(e=>setTimeout(e,200)),new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>{console.error("IndexedDB ì´ˆê¸°í™” ì‹¤íŒ¨:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,console.log("âœ… IndexedDB ì´ˆê¸°í™” ì„±ê³µ:",this.dbName),e()},s.onupgradeneeded=a=>{const o=a.target.result;if(o.objectStoreNames.contains("unclassifiedData")){const n=o.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData");if(n.indexNames.contains("videoDay"))try{n.deleteIndex("videoDay"),console.log("ğŸ”„ ê¸°ì¡´ unique videoDay ì¸ë±ìŠ¤ ì œê±°ë¨")}catch(l){console.log("âš ï¸ ê¸°ì¡´ videoDay ì¸ë±ìŠ¤ ì œê±° ì‹¤íŒ¨ (ë¬´ì‹œë¨):",l)}n.createIndex("videoDay",["videoId","dayKeyLocal"],{unique:!1}),console.log("âœ… ìƒˆë¡œìš´ non-unique videoDay ì¸ë±ìŠ¤ ìƒì„±ë¨"),n.indexNames.contains("dayKeyLocal")||n.createIndex("dayKeyLocal","dayKeyLocal",{unique:!1})}else{const r=o.createObjectStore("unclassifiedData",{keyPath:"id"});r.createIndex("channelName","channelName",{unique:!1}),r.createIndex("status","status",{unique:!1}),r.createIndex("category","category",{unique:!1}),r.createIndex("videoDay",["videoId","dayKeyLocal"],{unique:!1}),r.createIndex("dayKeyLocal","dayKeyLocal",{unique:!1})}if(!o.objectStoreNames.contains("classifiedData")){const r=o.createObjectStore("classifiedData",{keyPath:"id"});r.createIndex("channelName","channelName",{unique:!1}),r.createIndex("category","category",{unique:!1})}if(o.objectStoreNames.contains("channels")||o.createObjectStore("channels",{keyPath:"id"}).createIndex("name","name",{unique:!1}),!o.objectStoreNames.contains("videos")){const r=o.createObjectStore("videos",{keyPath:"id"});r.createIndex("channelId","channelId",{unique:!1}),r.createIndex("uploadDate","uploadDate",{unique:!1})}o.objectStoreNames.contains("categories")?(o.deleteObjectStore("categories"),o.createObjectStore("categories",{autoIncrement:!0})):o.createObjectStore("categories",{autoIncrement:!0}),o.objectStoreNames.contains("subCategories")||o.createObjectStore("subCategories",{keyPath:"id",autoIncrement:!0}).createIndex("category","category",{unique:!1}),o.objectStoreNames.contains("systemConfig")||o.createObjectStore("systemConfig",{keyPath:"key"}),o.objectStoreNames.contains("dailySummary")||o.createObjectStore("dailySummary",{keyPath:"date"}).createIndex("date","date",{unique:!0}),o.objectStoreNames.contains("dailyProgress")||o.createObjectStore("dailyProgress",{autoIncrement:!0}),o.objectStoreNames.contains("classifiedByDate")||o.createObjectStore("classifiedByDate",{keyPath:"date"}).createIndex("date","date",{unique:!0}),o.objectStoreNames.contains("backupSettings")||o.createObjectStore("backupSettings",{keyPath:"key"})}})}async replaceAllUnclassifiedData(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=o.clear();r.onsuccess=()=>{let n=0;const l=e.length;if(l===0){t();return}e.forEach(c=>{const i=o.put(c);i.onsuccess=()=>{n++,n===l&&t()},i.onerror=()=>s(i.error)})},r.onerror=()=>s(r.error)})}async saveUnclassifiedData(e){if(this.db||await this.init(),e.length===0)return Promise.resolve();console.log(`ğŸ”„ ë°±ì—… ë³µì› ì‹œì‘: ${e.length}ê°œ í•­ëª©`);const t=e.filter(o=>o.videoId?!0:(console.warn("âŒ videoIdê°€ ì—†ëŠ” í•­ëª© ì œì™¸:",o),!1)).map(o=>{const r=this.normalizeDayKey(o.dayKeyLocal||o.collectionDate||o.uploadDate);return{...o,dayKeyLocal:r,id:o.id||`${Date.now()}_${Math.random().toString(36).substr(2,9)}_${Math.random().toString(36).substr(2,9)}`}});console.log(`âœ… ë‚ ì§œ í‚¤ ë‹¨ì¼í™” ì™„ë£Œ: ${t.length}ê°œ í•­ëª©`);const s=new Map;t.forEach(o=>{if(!o.videoId||!o.dayKeyLocal){console.warn("âŒ í•„ìˆ˜ í•„ë“œê°€ ì—†ëŠ” í•­ëª© ì œì™¸:",{videoId:o.videoId,dayKeyLocal:o.dayKeyLocal});return}const r=`${o.videoId}|${o.dayKeyLocal}`;if(s.has(r)){const n=s.get(r),l={...n,...o,viewCount:Math.max(n.viewCount||0,o.viewCount||0),likeCount:Math.max(n.likeCount||0,o.likeCount||0),status:o.status==="classified"?"classified":n.status,category:o.category||n.category,subCategory:o.subCategory||n.subCategory};s.set(r,l),console.log(`ğŸ”„ ì¤‘ë³µ í•­ëª© ë³‘í•©: ${r} (ì¡°íšŒìˆ˜: ${n.viewCount} â†’ ${l.viewCount})`)}else s.set(r,o)});const a=Array.from(s.values());return console.log(`ğŸ”„ ì¤‘ë³µ ì œê±° ì™„ë£Œ: ${t.length}ê°œ â†’ ${a.length}ê°œ`),new Promise((o,r)=>{const n=this.db.transaction(["unclassifiedData"],"readwrite"),l=n.objectStore("unclassifiedData"),c=l.clear();c.onsuccess=()=>{console.log("ğŸ—‘ï¸ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì™„ë£Œ");let i=0,d=0;const u=a.length;console.log(`ğŸ”„ ìƒˆ ë°ì´í„° ì €ì¥ ì‹œì‘: ${u}ê°œ í•­ëª©`),a.forEach((h,f)=>{const y=l.put(h);y.onsuccess=()=>{i++,i+d===u&&(console.log(`âœ… ë°±ì—… ë³µì› ì™„ë£Œ: ${i}ê°œ ì„±ê³µ, ${d}ê°œ ì‹¤íŒ¨`),o())},y.onerror=()=>{console.warn(`í•­ëª© ${f} ì €ì¥ ì‹¤íŒ¨:`,y.error),d++,i+d===u&&(console.log(`âœ… ë°±ì—… ë³µì› ì™„ë£Œ: ${i}ê°œ ì„±ê³µ, ${d}ê°œ ì‹¤íŒ¨`),o())}})},c.onerror=()=>{console.error("âŒ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",c.error),r(c.error)},n.oncomplete=()=>{console.log("ğŸ‰ ë°±ì—… ë³µì› íŠ¸ëœì­ì…˜ ì™„ë£Œ")},n.onerror=()=>{console.error("âŒ ë°±ì—… ë³µì› íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",n.error),r(n.error)}})}normalizeDayKey(e){if(!e)return new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"});try{const t=new Date(e);return isNaN(t.getTime())?new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"}):t.toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"})}catch(t){return console.warn("ë‚ ì§œ í‚¤ ë³€í™˜ ì‹¤íŒ¨:",e,t),new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"})}}async loadUnclassifiedData(){return this.db||await this.init(),new Promise((e,t)=>{try{const o=this.db.transaction(["unclassifiedData"],"readonly").objectStore("unclassifiedData").getAll();o.onsuccess=()=>{console.log("âœ… IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ:",o.result.length,"ê°œ"),e(o.result)},o.onerror=()=>{console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",o.error),t(o.error)}}catch(s){console.error("âŒ IndexedDB íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",s),t(s)}})}async loadUnclassifiedDataByDate(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction(["unclassifiedData"],"readonly").objectStore("unclassifiedData").getAll();r.onsuccess=()=>{const n=r.result.filter(l=>(l.collectionDate||l.uploadDate)===e);t(n)},r.onerror=()=>s(r.error)})}async getAvailableDates(){return this.db||await this.init(),new Promise((e,t)=>{try{const s=new Set;let a=0;const o=3,r=()=>{if(a++,a===o){const g=new Date,b=new Date(g.getTime()+9*60*60*1e3),$=b.toISOString().split("T")[0];for(let m=0;m<E;m++){const B=new Date(b.getTime()-m*24*60*60*1e3).toISOString().split("T")[0];s.add(B)}const w=Array.from(s).sort((m,A)=>A.localeCompare(m));console.log(`ğŸ“… ì‚¬ìš© ê°€ëŠ¥í•œ ë‚ ì§œë“¤ (${E}ì¼ ë²”ìœ„ ìë™ ìƒì„±): ${w.length}ê°œ`,w),e(w)}},c=this.db.transaction(["unclassifiedData"],"readonly").objectStore("unclassifiedData").getAll();c.onsuccess=()=>{c.result.forEach(g=>{const b=g.collectionDate||g.uploadDate;b&&s.add(b)}),console.log(`ğŸ“Š unclassifiedDataì—ì„œ ${c.result.length}ê°œ í•­ëª© ì¡°íšŒ`),r()},c.onerror=()=>{console.error("âŒ unclassifiedData ì¡°íšŒ ì‹¤íŒ¨:",c.error),r()};const u=this.db.transaction(["classifiedData"],"readonly").objectStore("classifiedData").getAll();u.onsuccess=()=>{u.result.forEach(g=>{const b=g.collectionDate||g.uploadDate;b&&s.add(b)}),console.log(`ğŸ“Š classifiedDataì—ì„œ ${u.result.length}ê°œ í•­ëª© ì¡°íšŒ`),r()},u.onerror=()=>{console.error("classifiedData ì¡°íšŒ ì‹¤íŒ¨:",u.error),r()};const y=this.db.transaction(["dailyProgress"],"readonly").objectStore("dailyProgress").getAll();y.onsuccess=()=>{y.result.forEach(g=>{g.date&&s.add(g.date)}),console.log(`ğŸ“Š dailyProgressì—ì„œ ${y.result.length}ê°œ í•­ëª© ì¡°íšŒ`),r()},y.onerror=()=>{console.error("âŒ dailyProgress ì¡°íšŒ ì‹¤íŒ¨:",y.error),r()}}catch(s){console.error("âŒ getAvailableDates íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",s),this.restartConnection().then(()=>{console.log("ğŸ”„ ì—°ê²° ì¬ì‹œì‘ í›„ ë‹¤ì‹œ ì‹œë„"),e([])}).catch(()=>{t(s)})}})}async clearUnclassifiedData(){return this.db||await this.init(),new Promise((e,t)=>{try{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData").clear();o.onsuccess=()=>{console.log("âœ… unclassifiedData ì „ì²´ ì‚­ì œ ì™„ë£Œ"),e()},o.onerror=()=>{console.error("âŒ unclassifiedData ì‚­ì œ ì‹¤íŒ¨:",o.error),t(o.error)}}catch(s){console.error("âŒ clearUnclassifiedData íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",s),t(s)}})}async saveClassifiedData(e){if(this.db||await this.init(),!Array.isArray(e))return console.error("âŒ saveClassifiedData: dataê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:",typeof e,e),Promise.reject(new Error("Data must be an array"));const t=e.filter(s=>s.id?!0:(console.warn("âŒ IDê°€ ì—†ëŠ” ë¶„ë¥˜ ë°ì´í„° ì œì™¸:",s),!1));return console.log(`ğŸ“Š ë¶„ë¥˜ ë°ì´í„° ì €ì¥: ${e.length}ê°œ â†’ ${t.length}ê°œ (ìœ íš¨í•œ ë°ì´í„°)`),new Promise((s,a)=>{const r=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData"),n=r.clear();n.onsuccess=()=>{let l=0;const c=t.length;if(c===0){s();return}t.forEach(i=>{const d=r.put(i);d.onsuccess=()=>{l++,l===c&&s()},d.onerror=()=>a(d.error)})},n.onerror=()=>a(n.error)})}async loadClassifiedData(){return this.db||await this.init(),new Promise((e,t)=>{const o=this.db.transaction(["classifiedData"],"readonly").objectStore("classifiedData").getAll();o.onsuccess=()=>e(o.result),o.onerror=()=>t(o.error)})}async updateClassifiedDataByDate(e,t){return this.db||await this.init(),console.log(`ğŸ’¾ IndexedDB ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ - ${t}:`,e.length,"ê°œ"),new Promise((s,a)=>{const r=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData"),n=r.getAll();n.onsuccess=()=>{const l=n.result;console.log(`ğŸ“Š IndexedDB ì „ì²´ ë¶„ë¥˜ ë°ì´í„°: ${l.length}ê°œ`);const c=l.filter(u=>(u.dayKeyLocal||u.collectionDate||u.uploadDate||"").split("T")[0]!==t);console.log(`ğŸ“Š ë‹¤ë¥¸ ë‚ ì§œ ë¶„ë¥˜ ë°ì´í„°: ${c.length}ê°œ`);const i=[...c,...e];console.log(`ğŸ“Š ë³‘í•© ë¶„ë¥˜ ë°ì´í„°: ${i.length}ê°œ (ë‹¤ë¥¸ ë‚ ì§œ: ${c.length} + ìƒˆ ë‚ ì§œ: ${e.length})`);const d=r.clear();d.onsuccess=()=>{console.log("ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ ì™„ë£Œ, ë³‘í•© ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹œì‘");let u=0;const h=i.length;if(h===0){console.log(`âœ… ${t} ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ë°ì´í„° ì—†ìŒ`),s();return}i.forEach((f,y)=>{f.id||(f.id=Date.now()+y);const g=r.put(f);g.onsuccess=()=>{u++,u===h&&(console.log(`âœ… ${t} ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${e.length}ê°œ ì¶”ê°€/ìˆ˜ì •, ì „ì²´ ${i.length}ê°œ ìœ ì§€`),s())},g.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",g.error),a(g.error)}})},d.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",d.error),a(d.error)}},n.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",n.error),a(n.error)}})}async updateUnclassifiedData(e){return this.db||await this.init(),console.log("ğŸ’¾ IndexedDB ì—…ë°ì´íŠ¸ - unclassifiedData:",e.length,"ê°œ"),console.log("ğŸ’¾ ë°ì´í„° ìƒ˜í”Œ (ì¹´í…Œê³ ë¦¬/ì„¸ë¶€ì¹´í…Œê³ ë¦¬):",e.slice(0,3).map(t=>({category:t.category,subCategory:t.subCategory,channelName:t.channelName}))),new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData");let r=0;const n=e.length;if(n===0){t();return}e.forEach((l,c)=>{l.id||(l.id=Date.now()+c);const i=o.put(l);i.onsuccess=()=>{r++,r===n&&t()},i.onerror=()=>s(i.error)})})}async updateUnclassifiedDataByDate(e,t){return this.db||await this.init(),console.log(`ğŸ’¾ IndexedDB ë‚ ì§œë³„ ì—…ë°ì´íŠ¸ - ${t}:`,e.length,"ê°œ"),console.log("ğŸ’¾ ë°ì´í„° ìƒ˜í”Œ (ì¹´í…Œê³ ë¦¬/ì„¸ë¶€ì¹´í…Œê³ ë¦¬):",e.slice(0,3).map(s=>({category:s.category,subCategory:s.subCategory,channelName:s.channelName}))),new Promise((s,a)=>{const r=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),n=r.getAll();n.onsuccess=()=>{const l=n.result;console.log(`ğŸ“Š IndexedDB ì „ì²´ ë°ì´í„°: ${l.length}ê°œ`);const c=l.filter(u=>(u.dayKeyLocal||u.collectionDate||u.uploadDate||"").split("T")[0]!==t);console.log(`ğŸ“Š ë‹¤ë¥¸ ë‚ ì§œ ë°ì´í„°: ${c.length}ê°œ`);const i=[...c,...e];console.log(`ğŸ“Š ë³‘í•© ë°ì´í„°: ${i.length}ê°œ (ë‹¤ë¥¸ ë‚ ì§œ: ${c.length} + ìƒˆ ë‚ ì§œ: ${e.length})`);const d=r.clear();d.onsuccess=()=>{console.log("ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ ì™„ë£Œ, ë³‘í•© ë°ì´í„° ì €ì¥ ì‹œì‘");let u=0;const h=i.length;if(h===0){console.log(`âœ… ${t} ë‚ ì§œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ë°ì´í„° ì—†ìŒ`),s();return}i.forEach((f,y)=>{f.id||(f.id=Date.now()+y);const g=r.put(f);g.onsuccess=()=>{u++,u===h&&(console.log(`âœ… ${t} ë‚ ì§œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${e.length}ê°œ ì¶”ê°€/ìˆ˜ì •, ì „ì²´ ${i.length}ê°œ ìœ ì§€`),s())},g.onerror=()=>{console.error("âŒ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",g.error),a(g.error)}})},d.onerror=()=>{console.error("âŒ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",d.error),a(d.error)}},n.onerror=()=>{console.error("âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",n.error),a(n.error)}})}async updateClassifiedData(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData");let r=0;const n=e.length;if(n===0){t();return}e.forEach((l,c)=>{l.id||(l.id=Date.now()+c);const i=o.put(l);i.onsuccess=()=>{r++,r===n&&t()},i.onerror=()=>s(i.error)})})}async saveChannels(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["channels"],"readwrite").objectStore("channels"),r=o.clear();r.onsuccess=()=>{const n=Object.entries(e);let l=0;const c=n.length;if(c===0){t();return}n.forEach(([i,d])=>{const u=o.put({id:i,...d});u.onsuccess=()=>{l++,l===c&&t()},u.onerror=()=>s(u.error)})},r.onerror=()=>s(r.error)})}async saveVideos(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["videos"],"readwrite").objectStore("videos"),r=o.clear();r.onsuccess=()=>{const n=Object.entries(e);let l=0;const c=n.length;if(c===0){t();return}n.forEach(([i,d])=>{Array.isArray(d)&&d.forEach(u=>{const h=o.put({...u,channelId:i});h.onsuccess=()=>{l++,l===c&&t()},h.onerror=()=>s(h.error)})})},r.onerror=()=>s(r.error)})}async saveCategories(e){this.db||await this.init();const t=R(e)||{};return new Promise((s,a)=>{const r=this.db.transaction(["subCategories"],"readwrite").objectStore("subCategories"),n=r.clear();n.onsuccess=()=>{const l=r.put({id:1,type:"categories",data:t,timestamp:new Date().toISOString()});l.onsuccess=()=>{console.log("âœ… ì¹´í…Œê³ ë¦¬ ì €ì¥ ì™„ë£Œ:",t),s()},l.onerror=c=>{console.error("âŒ ì¹´í…Œê³ ë¦¬ ì €ì¥ ì‹¤íŒ¨:",c),a(l.error)}},n.onerror=l=>{console.error("âŒ ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨:",l),a(n.error)}})}async loadCategories(){return this.db||await this.init(),new Promise((e,t)=>{const o=this.db.transaction(["subCategories"],"readonly").objectStore("subCategories").getAll();o.onsuccess=()=>{const n=o.result.filter(h=>h.type==="categories").sort((h,f)=>new Date(f.timestamp).getTime()-new Date(h.timestamp).getTime())[0],l=(n==null?void 0:n.data)||null,c=R(l),i=K(c);if(!l){e(i);return}const d=JSON.stringify(l),u=JSON.stringify(i);d!==u&&(console.log("ğŸ”„ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ê°±ì‹  ê°ì§€ - ìµœì‹  ê¸°ë³¸ê°’ìœ¼ë¡œ ë™ê¸°í™”í•©ë‹ˆë‹¤."),this.saveCategories(i).catch(h=>{console.warn("âš ï¸ ì¹´í…Œê³ ë¦¬ ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜:",h)})),e(i)},o.onerror=()=>t(o.error)})}async saveDailyProgress(e){this.db||await this.init(),console.log("ğŸ” saveDailyProgress í˜¸ì¶œë¨ - ë§¤ê°œë³€ìˆ˜:",typeof e,e);let t=[];if(Array.isArray(e))t=e.filter(s=>s&&typeof s=="object"),console.log("ğŸ” ë°°ì—´ë¡œ ì²˜ë¦¬ë¨:",t.length,"ê°œ í•­ëª©");else if(e&&typeof e=="object")t=[e],console.log("ğŸ” ê°ì²´ë¡œ ì²˜ë¦¬ë¨:",t[0]);else return console.error("âŒ saveDailyProgress: ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„° íƒ€ì…:",typeof e,e),Promise.resolve();return new Promise((s,a)=>{const r=this.db.transaction(["dailyProgress"],"readwrite").objectStore("dailyProgress"),n=r.clear();n.onsuccess=()=>{let l=0;const c=t.length;if(c===0){s();return}t.forEach((i,d)=>{const u={...i};u.id||(u.id=Date.now()+d);const h=r.put(u);h.onsuccess=()=>{l++,l===c&&s()},h.onerror=()=>a(h.error)})},n.onerror=()=>a(n.error)})}async saveSubCategories(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["subCategories"],"readwrite").objectStore("subCategories"),r=o.clear();r.onsuccess=()=>{const n=Object.entries(e);let l=0;const c=n.length;if(c===0){t();return}n.forEach(([i,d])=>{Array.isArray(d)&&d.forEach(u=>{const h=o.put({category:i,subCategory:u});h.onsuccess=()=>{l++,l===c&&t()},h.onerror=()=>s(h.error)})})},r.onerror=()=>s(r.error)})}async loadSubCategories(){return this.db||await this.init(),new Promise((e,t)=>{const s={},r=this.db.transaction(["subCategories"],"readonly").objectStore("subCategories").getAll();r.onsuccess=()=>{(r.result||[]).forEach(l=>{const c=l.category,i=l.subCategory;!c||!i||(s[c]||(s[c]=[]),s[c].includes(i)||s[c].push(i))}),e(s)},r.onerror=()=>t(r.error)})}async saveSystemConfig(e,t){return this.db||await this.init(),new Promise((s,a)=>{const n=this.db.transaction(["systemConfig"],"readwrite").objectStore("systemConfig").put({key:e,value:t});n.onsuccess=()=>s(),n.onerror=()=>a(n.error)})}async loadSystemConfig(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction(["systemConfig"],"readonly").objectStore("systemConfig").get(e);r.onsuccess=()=>{var n;return t((n=r.result)==null?void 0:n.value)},r.onerror=()=>s(r.error)})}async clearDatabase(){return new Promise((e,t)=>{try{const s=indexedDB.deleteDatabase(this.dbName);s.onsuccess=()=>{this.db=null,console.log("âœ… IndexedDB ì‚­ì œ ì™„ë£Œ"),this.clearAssociatedCache().then(()=>{console.log("âœ… ì—°ê´€ ìºì‹œ ì‚­ì œ ì™„ë£Œ"),e()}).catch(a=>{console.warn("âš ï¸ ìºì‹œ ì‚­ì œ ì‹¤íŒ¨ (IndexedDBëŠ” ì‚­ì œë¨):",a),e()})},s.onerror=()=>t(s.error)}catch(s){t(s)}})}async clearAssociatedCache(){const{CacheCleanup:e}=await L(async()=>{const{CacheCleanup:t}=await import("./index.BVcciKWp.js").then(s=>s.c);return{CacheCleanup:t}},__vite__mapDeps([0,1,2,3,4,5]));await e.clearAssociatedCache()}async saveDailySummary(e,t){return this.db||await this.init(),new Promise((s,a)=>{const r=this.db.transaction(["dailySummary"],"readwrite").objectStore("dailySummary"),n={date:e};t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).forEach(c=>{c!=="date"&&(n[c]=t[c])}),console.log("ğŸ’¾ saveDailySummary í˜¸ì¶œ:",{date:e,summaryKeys:t?Object.keys(t):[],dataToSaveKeys:Object.keys(n)});const l=r.put(n);l.onsuccess=()=>{console.log("âœ… dailySummary ì €ì¥ ì„±ê³µ:",e),s()},l.onerror=()=>{console.error("âŒ dailySummary ì €ì¥ ì‹¤íŒ¨:",l.error,{date:e,dataToSave:n}),a(l.error)}})}async loadDailySummary(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction(["dailySummary"],"readonly").objectStore("dailySummary").get(e);r.onsuccess=()=>t(r.result||null),r.onerror=()=>s(r.error)})}async saveClassifiedByDate(e,t){return this.db||await this.init(),new Promise((s,a)=>{const n=this.db.transaction(["classifiedByDate"],"readwrite").objectStore("classifiedByDate").put({date:e,items:t});n.onsuccess=()=>s(),n.onerror=()=>a(n.error)})}async loadClassifiedByDate(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction(["classifiedByDate"],"readonly").objectStore("classifiedByDate").get(e);r.onsuccess=()=>{const n=r.result;t((n==null?void 0:n.items)||null)},r.onerror=()=>s(r.error)})}async updateAllCollectionDates(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=o.getAll();r.onsuccess=()=>{const n=r.result;console.log(`ğŸ“Š ì „ì²´ ë°ì´í„°: ${n.length}ê°œ`);const l=n.map(d=>({...d,collectionDate:e}));let c=0,i=0;l.forEach((d,u)=>{const h=o.put(d);h.onsuccess=()=>{c++,c%100===0&&console.log(`âœ… ${c}/${n.length} ì—…ë°ì´íŠ¸ ì™„ë£Œ`),c+i===n.length&&(console.log(`ğŸ‰ ì—…ë°ì´íŠ¸ ì™„ë£Œ! ì´ ${c}ê°œ ë°ì´í„°ë¥¼ ${e}ë¡œ ë³€ê²½`),t(c))},h.onerror=()=>{i++,console.error(`âŒ ${u+1}ë²ˆì§¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`,h.error),c+i===n.length&&(console.log(`âš ï¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${c}ê°œ ì„±ê³µ, ${i}ê°œ ì‹¤íŒ¨`),t(c))}})},r.onerror=()=>{s(r.error)}})}async listClassifiedDates(){return this.db||await this.init(),new Promise((e,t)=>{const o=this.db.transaction(["classifiedByDate"],"readonly").objectStore("classifiedByDate").getAllKeys();o.onsuccess=()=>{const r=o.result||[];e(r)},o.onerror=()=>t(o.error)})}async cleanupOldData(e=E){this.db||await this.init();const t=new Date;t.setDate(t.getDate()-e);const s=t.toISOString().split("T")[0];let a=0;const r=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),n=r.getAll();await new Promise(b=>{n.onsuccess=()=>{n.result.filter(w=>new Date(w.uploadDate)<t).forEach(w=>{r.delete(w.id),a++}),b()}});const c=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData"),i=c.getAll();await new Promise(b=>{i.onsuccess=()=>{i.result.filter(w=>new Date(w.uploadDate)<t).forEach(w=>{c.delete(w.id),a++}),b()}});const u=this.db.transaction(["videos"],"readwrite").objectStore("videos"),h=u.getAll();await new Promise(b=>{h.onsuccess=()=>{h.result.filter(w=>new Date(w.uploadDate)<t).forEach(w=>{u.delete(w.id),a++}),b()}});const y=this.db.transaction(["dailySummary"],"readwrite").objectStore("dailySummary"),g=y.getAll();return await new Promise(b=>{g.onsuccess=()=>{(g.result||[]).forEach(w=>{const m=((w==null?void 0:w.date)||"").toString();m&&m<s&&(y.delete(w.date),a++)}),b()}}),console.log(`ğŸ§¹ ${e}ì¼ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ: ${a}ê°œ ë°ì´í„° ì‚­ì œ`),a}async getDatabaseInfo(){this.db||await this.init();const e={name:this.dbName,version:this.version,objectStores:Array.from(this.db.objectStoreNames),size:0,retentionDays:E,lastCleanup:null};for(const t of e.objectStores){const o=this.db.transaction([t],"readonly").objectStore(t).count();await new Promise(r=>{o.onsuccess=()=>{e.size+=o.result,r()}})}try{const t=await this.loadSystemConfig("retentionDays");typeof t=="number"&&t>0&&(e.retentionDays=t)}catch{}return e}async deleteUnclassifiedDataByIds(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData");let r=0;const n=e.length;if(n===0){t();return}e.forEach(l=>{const c=o.delete(l);c.onsuccess=()=>{r++,r===n&&(console.log(`âœ… IndexedDBì—ì„œ ${n}ê°œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ`),t())},c.onerror=()=>{console.error(`âŒ ID ${l} ì‚­ì œ ì‹¤íŒ¨:`,c.error),s(c.error)}})})}async deleteDataByDate(e){return this.db||await this.init(),console.log(`ğŸ—‘ï¸ ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì‹œì‘...`),new Promise((t,s)=>{const a=this.db.transaction(["unclassifiedData","classifiedData"],"readwrite"),o=a.objectStore("unclassifiedData"),r=a.objectStore("classifiedData");let n=!1,l=!1,c=0;const i=()=>{n&&l&&(console.log(`âœ… ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ: ${c}ê°œ ì‚­ì œ`),t())},d=o.getAll();d.onsuccess=()=>{const f=d.result.filter(y=>{const g=y.collectionDate||y.uploadDate;return g&&g.split("T")[0]===e});if(console.log(`ğŸ“Š unclassifiedDataì—ì„œ ì‚­ì œí•  ë°ì´í„°: ${f.length}ê°œ`),f.length===0)n=!0,i();else{let y=0;f.forEach(g=>{const b=o.delete(g.id);b.onsuccess=()=>{y++,c++,y===f.length&&(n=!0,i())},b.onerror=()=>s(b.error)})}};const u=r.getAll();u.onsuccess=()=>{const f=u.result.filter(y=>{const g=y.collectionDate||y.uploadDate;return g&&g.split("T")[0]===e});if(console.log(`ğŸ“Š classifiedDataì—ì„œ ì‚­ì œí•  ë°ì´í„°: ${f.length}ê°œ`),f.length===0)l=!0,i();else{let y=0;f.forEach(g=>{const b=r.delete(g.id);b.onsuccess=()=>{y++,c++,y===f.length&&(l=!0,i())},b.onerror=()=>s(b.error)})}},d.onerror=()=>s(d.error),u.onerror=()=>s(u.error)})}async idempotentUpsertUnclassifiedData(e){if(!this.db)throw new Error("Database not initialized");return new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=o.index("videoDay");let n=0,l=0,c=0;const i=e.length;if(i===0){t();return}console.log(`ğŸ”„ IndexedDB ë©±ë“± ë³µì› ì‹œì‘: ${i}ê°œ ë ˆì½”ë“œ`),e.forEach(d=>{if(!d.dayKeyLocal&&d.collectionDate){const f=new Date(d.collectionDate);d.dayKeyLocal=f.toISOString().split("T")[0]}const u=[d.videoId,d.dayKeyLocal],h=r.get(u);h.onsuccess=()=>{if(h.result){const f=h.result,y={...f,viewCount:Math.max(f.viewCount||0,d.viewCount||0),likeCount:Math.max(f.likeCount||0,d.likeCount||0),channelName:d.channelName||f.channelName,videoTitle:d.videoTitle||f.videoTitle,videoDescription:d.videoDescription||f.videoDescription,thumbnailUrl:d.thumbnailUrl||f.thumbnailUrl,category:d.category||f.category,subCategory:d.subCategory||f.subCategory,status:d.status||f.status,updatedAt:new Date().toISOString()},g=o.put(y);g.onsuccess=()=>{l++,n++,n===i&&(console.log(`âœ… IndexedDB ë©±ë“± ë³µì› ì™„ë£Œ: ë³‘í•© ${l}ê°œ, ì‹ ê·œ ${c}ê°œ`),t())},g.onerror=()=>{console.error("IndexedDB ë³‘í•© ì‹¤íŒ¨:",g.error),n++,n===i&&t()}}else{const f={...d,id:d.id||Date.now().toString()+Math.random().toString(36).substr(2,9),createdAt:d.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()},y=o.put(f);y.onsuccess=()=>{c++,n++,n===i&&(console.log(`âœ… IndexedDB ë©±ë“± ë³µì› ì™„ë£Œ: ë³‘í•© ${l}ê°œ, ì‹ ê·œ ${c}ê°œ`),t())},y.onerror=()=>{console.error("IndexedDB ì¶”ê°€ ì‹¤íŒ¨:",y.error),n++,n===i&&t()}}},h.onerror=()=>{console.error("IndexedDB ì¡°íšŒ ì‹¤íŒ¨:",h.error),n++,n===i&&t()}})})}async upsertUnclassifiedDataWithMaxValues(e){if(!this.db)throw new Error("Database not initialized");return new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=o.index("videoDay");let n=0;const l=e.length;if(l===0){t();return}e.forEach(c=>{if(!c.dayKeyLocal&&c.collectionDate){const u=new Date(c.collectionDate);c.dayKeyLocal=u.toISOString().split("T")[0]}const i=[c.videoId,c.dayKeyLocal],d=r.get(i);d.onsuccess=()=>{if(d.result){const u=d.result,h={...u,viewCount:Math.max(u.viewCount||0,c.viewCount||0),likeCount:Math.max(u.likeCount||0,c.likeCount||0),channelName:c.channelName||u.channelName,videoTitle:c.videoTitle||u.videoTitle,videoDescription:c.videoDescription||u.videoDescription,thumbnailUrl:c.thumbnailUrl||u.thumbnailUrl,category:c.category||u.category,subCategory:c.subCategory||u.subCategory,status:c.status||u.status,updatedAt:new Date().toISOString()},f=o.put(h);f.onsuccess=()=>{n++,n===l&&t()},f.onerror=()=>s(f.error)}else{c.id||(c.id=`${Date.now()}_${Math.random().toString(36).substr(2,9)}`);const u=o.put(c);u.onsuccess=()=>{n++,n===l&&t()},u.onerror=()=>s(u.error)}},d.onerror=()=>s(d.error)})})}async saveBackupDirectoryHandle(e){return this.db||await this.init(),!this.db||!this.db.objectStoreNames.contains("backupSettings")?(console.warn("ğŸ“ backupSettings ì €ì¥ì†Œê°€ ì—†ì–´ ë°±ì—… í´ë”ë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."),Promise.resolve()):new Promise((t,s)=>{try{const r=this.db.transaction(["backupSettings"],"readwrite").objectStore("backupSettings").put({key:"backupDirectory",handle:e});r.onsuccess=()=>t(),r.onerror=()=>s(r.error)}catch(a){s(a)}})}async getBackupDirectoryHandle(){return this.db||await this.init(),!this.db||!this.db.objectStoreNames.contains("backupSettings")?(console.warn("ğŸ“ backupSettings ì €ì¥ì†Œê°€ ì—†ì–´ ê¸°ì¡´ ë°±ì—… í´ë”ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),null):new Promise((e,t)=>{try{const o=this.db.transaction(["backupSettings"],"readonly").objectStore("backupSettings").get("backupDirectory");o.onsuccess=()=>{var r;e(((r=o.result)==null?void 0:r.handle)??null)},o.onerror=()=>t(o.error)}catch(s){t(s)}})}async clearBackupDirectoryHandle(){return this.db||await this.init(),!this.db||!this.db.objectStoreNames.contains("backupSettings")?(console.warn("ğŸ“ backupSettings ì €ì¥ì†Œê°€ ì—†ì–´ ì´ˆê¸°í™”í•  ë°±ì—… í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤."),Promise.resolve()):new Promise((e,t)=>{try{const o=this.db.transaction(["backupSettings"],"readwrite").objectStore("backupSettings").delete("backupDirectory");o.onsuccess=()=>e(),o.onerror=()=>t(o.error)}catch(s){t(s)}})}getDBInstance(){return this.db}}const D=new V,te=Object.freeze(Object.defineProperty({__proto__:null,indexedDBService:D},Symbol.toStringTag,{value:"Module"}));class z{constructor(e="YouTubePulseDB",t="unclassifiedData"){I(this,"dbName");I(this,"storeName");I(this,"version",11);I(this,"db",null);this.dbName=e,this.storeName=t}async initDB(){if(this.db&&this.db.readyState==="open"){console.log("âœ… IndexedDB ì´ë¯¸ ì—°ê²°ë¨");return}console.log("ğŸ”„ HybridDBService IndexedDB ì—°ê²° í™•ì¸...");try{await D.init();const e=D.getDBInstance();if(e&&e.readyState==="open"){this.db=e,console.log("âœ… HybridDBService IndexedDB ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©");return}}catch(e){console.warn("âš ï¸ HybridDBServiceì—ì„œ indexedDBService.init() ì‹¤í–‰ ì¤‘ ê²½ê³ :",e)}return new Promise((e,t)=>{const s=setTimeout(()=>{console.error("âŒ IndexedDB ì—°ê²° íƒ€ì„ì•„ì›ƒ"),t(new Error("IndexedDB ì—°ê²° íƒ€ì„ì•„ì›ƒ"))},1e4),a=indexedDB.open(this.dbName,this.version);a.onupgradeneeded=o=>{console.log("ğŸ”„ HybridDBService: unexpected onupgradeneeded (version mismatch)")},a.onsuccess=()=>{clearTimeout(s),this.db=a.result,console.log("âœ… HybridDBService IndexedDB ì—°ê²° ì™„ë£Œ"),e()},a.onerror=()=>{clearTimeout(s),console.error("âŒ HybridDBService IndexedDB ì—°ê²° ì‹¤íŒ¨:",a.error),t(a.error)}})}async saveDataInBatches(e,t=500){if(!e||e.length===0){console.log("ğŸ“­ ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");return}console.log(`ğŸ’¾ ë°°ì¹˜ ì €ì¥ ì‹œì‘: ${e.length}ê°œ ë°ì´í„°ë¥¼ ${t}ê°œì”© ì²˜ë¦¬`),await this.initDB();for(let s=0;s<e.length;s+=t){const a=e.slice(s,s+t),o=Math.floor(s/t)+1,r=Math.ceil(e.length/t);console.log(`ğŸ“¦ ë°°ì¹˜ ${o}/${r} ì²˜ë¦¬ ì¤‘... (${a.length}ê°œ)`);let n=!1,l=0;const c=3;for(;!n&&l<c;)try{await this.saveBatch(a),n=!0,console.log(`âœ… ë°°ì¹˜ ${o} ì €ì¥ ì™„ë£Œ`)}catch(i){l++,console.warn(`âš ï¸ ë°°ì¹˜ ${o} ì €ì¥ ì‹¤íŒ¨ (ì‹œë„ ${l}/${c}):`,(i==null?void 0:i.message)||i);const d=(i==null?void 0:i.name)==="AbortError";if((i==null?void 0:i.name)==="InvalidStateError"||(i==null?void 0:i.name)==="TransactionInactiveError")console.warn("ğŸ”„ IndexedDB ì—°ê²° ë¬¸ì œ ë°œìƒ, ì¬ì´ˆê¸°í™” í›„ ì¬ì‹œë„ ì¤‘..."),await this.initDB();else if(d){const h=Math.pow(2,l)*2e3;console.warn(`â³ AbortError ê°ì§€, ${h}ms í›„ ì¬ì‹œë„...`),await new Promise(f=>setTimeout(f,h))}else{const h=Math.pow(2,l)*1e3;console.warn(`â³ ${h}ms í›„ ì¬ì‹œë„...`),await new Promise(f=>setTimeout(f,h))}}n||console.warn(`âš ï¸ ë°°ì¹˜ ${o} ì €ì¥ ì‹¤íŒ¨í–ˆì§€ë§Œ ê³„ì† ì§„í–‰...`)}console.log("âœ… ëª¨ë“  ë°°ì¹˜ ì €ì¥ ì™„ë£Œ")}async saveBatch(e){if(!this.db)throw new Error("IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");const t=new Map;e.forEach(a=>{const o=`${a.videoId}|${a.dayKeyLocal}`;if(t.has(o)){const r=t.get(o);t.set(o,{...r,...a,viewCount:Math.max(r.viewCount||0,a.viewCount||0),likeCount:Math.max(r.likeCount||0,a.likeCount||0)})}else t.set(o,a)});const s=Array.from(t.values());if(console.log(`ğŸ”„ ë°°ì¹˜ ë‚´ ì¤‘ë³µ ì œê±°: ${e.length}ê°œ â†’ ${s.length}ê°œ`),s.length!==0)return new Promise((a,o)=>{const r=this.db.transaction([this.storeName],"readwrite"),n=r.objectStore(this.storeName);let l=0;const c=s.length;let i=!1;s.forEach(d=>{const u=n.put(d);u.onsuccess=()=>{l++,l===c&&!i&&a()},u.onerror=()=>{i=!0,console.warn(`âš ï¸ ì €ì¥ ì‹¤íŒ¨, ê±´ë„ˆëœ€: ${d.videoId}|${d.dayKeyLocal}`,u.error),l++,l===c&&a()}}),r.oncomplete=()=>{i||a()},r.onerror=()=>{console.error("âŒ íŠ¸ëœì­ì…˜ ì˜¤ë¥˜:",r.error),o(r.error)},r.onabort=()=>{console.error("âŒ íŠ¸ëœì­ì…˜ ì¤‘ë‹¨:",r.error),o(r.error)}})}async loadAllData(){return await this.initDB(),new Promise((e,t)=>{if(!this.db){t(new Error("IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"));return}const o=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();o.onsuccess=()=>{console.log(`ğŸ“¥ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${o.result.length}ê°œ`),e(o.result)},o.onerror=()=>{console.error("âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",o.error),t(o.error)}})}async clearData(){return await this.initDB(),new Promise((e,t)=>{if(!this.db){t(new Error("IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"));return}try{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();o.onsuccess=()=>{console.log("ğŸ—‘ï¸ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì™„ë£Œ"),this.clearAssociatedCache().then(()=>{console.log("âœ… ì—°ê´€ ìºì‹œ ì‚­ì œ ì™„ë£Œ"),e()}).catch(r=>{console.warn("âš ï¸ ìºì‹œ ì‚­ì œ ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì‚­ì œë¨):",r),e()})},o.onerror=()=>{console.error("âŒ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",o.error),t(o.error)}}catch(s){t(s)}})}async clearAssociatedCache(){const{CacheCleanup:e}=await L(async()=>{const{CacheCleanup:t}=await import("./index.BVcciKWp.js").then(s=>s.c);return{CacheCleanup:t}},__vite__mapDeps([0,1,2,3,4,5]));await e.clearAssociatedCache()}async clearDataByDate(e){return await this.initDB(),new Promise((t,s)=>{if(!this.db){s(new Error("IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"));return}const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName),r=o.index("dayKeyLocal"),n=IDBKeyRange.only(e),l=r.getAll(n);l.onsuccess=()=>{const c=l.result;if(console.log(`ğŸ—‘ï¸ ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ëŒ€ìƒ: ${c.length}ê°œ`),c.length===0){console.log(`ğŸ“­ ${e} ë‚ ì§œì— ì‚­ì œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤`),t(0);return}let i=0,d=0;c.forEach((u,h)=>{const f=o.delete(u.id);f.onsuccess=()=>{i++,i+d===c.length&&(console.log(`âœ… ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ: ${i}ê°œ`),t(i))},f.onerror=()=>{d++,console.error(`âŒ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨ (ID: ${u.id}):`,f.error),i+d===c.length&&(console.log(`âš ï¸ ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ: ${i}ê°œ ì„±ê³µ, ${d}ê°œ ì‹¤íŒ¨`),t(i))}})},l.onerror=()=>{console.error("âŒ ë‚ ì§œë³„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",l.error),s(l.error)}})}async replaceDataByDate(e,t){console.log(`ğŸ”„ ${e} ë‚ ì§œ ë°ì´í„° êµì²´ ì‹œì‘: ${t.length}ê°œ`);const s=await this.clearDataByDate(e);return console.log(`ğŸ—‘ï¸ ${e} ë‚ ì§œ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ: ${s}ê°œ`),t.length>0&&(await this.saveDataInBatches(t,500),console.log(`ğŸ’¾ ${e} ë‚ ì§œ ìƒˆ ë°ì´í„° ì €ì¥: ${t.length}ê°œ`)),t.length}isConnected(){return this.db!==null&&this.db.readyState==="open"}close(){this.db&&(this.db.close(),this.db=null,console.log("ğŸ”Œ IndexedDB ì—°ê²° ì¢…ë£Œ"))}}const v=new z;var N,j;const H=((j=(N=import.meta)==null?void 0:N.env)==null?void 0:j.VITE_API_BASE_URL)||"";let O="";if(typeof window<"u")try{O=localStorage.getItem("customApiUrl")||""}catch(p){console.warn("âš ï¸ customApiUrl ë¡œë“œ ì‹¤íŒ¨:",p)}const F="https://api.youthbepulse.com",k=(O||H||F).replace(/\/$/,"");class J{constructor(){I(this,"baseURL");this.baseURL=k}async request(e,t={}){var n,l;if(!this.baseURL)return console.warn("âš ï¸ API_BASE_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ ì„œë²„ ìš”ì²­ì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),{success:!1,error:"API base URL is not configured."};const s=`${this.baseURL}${e}`;if(typeof navigator<"u"&&"onLine"in navigator&&!navigator.onLine)return console.warn("âš ï¸ ì˜¤í”„ë¼ì¸ ìƒíƒœ - ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”"),{success:!1,error:"Network is offline. Please check your internet connection."};let a=null,o=null,r=t.signal;r||(a=new AbortController,r=a.signal,o=setTimeout(()=>{a&&(console.warn("â±ï¸ ìš”ì²­ íƒ€ì„ì•„ì›ƒ (120ì´ˆ) - ì„œë²„ ì‘ë‹µì´ ì§€ì—°ë˜ê³  ìˆìŠµë‹ˆë‹¤"),a.abort())},12e4));try{const{signal:c,...i}=t,d=await fetch(s,{headers:{"Content-Type":"application/json",...i.headers},signal:r,...i});if(o&&clearTimeout(o),!d.ok){let h="";try{const f=await d.json();h=JSON.stringify(f,null,2)}catch{h=`Status: ${d.status}, StatusText: ${d.statusText}`}throw console.error("ğŸš¨ ì„œë²„ ì—ëŸ¬ ìƒì„¸:",{status:d.status,statusText:d.statusText,url:s,details:h,headers:Object.fromEntries(d.headers.entries())}),new Error(`HTTP error! status: ${d.status} - ${h}`)}const u=await d.json();return u&&typeof u=="object"&&"success"in u&&"data"in u?(console.log("ğŸ“¦ ì„œë²„ ì‘ë‹µì´ ì´ë¯¸ í‘œì¤€ í˜•ì‹:",{success:u.success,dataLength:(n=u.data)==null?void 0:n.length}),u):{success:!0,data:u}}catch(c){if(o&&clearTimeout(o),c instanceof Error&&c.name==="AbortError"){const i=(a==null?void 0:a.signal.aborted)&&!((l=t.signal)!=null&&l.aborted),d=i?"Request timeout (120s)":"Request aborted";return console.error("ğŸš¨ API ìš”ì²­ ì¤‘ë‹¨:",{url:s,error:d,reason:c.message||"No reason provided",wasTimeout:i,hasCustomSignal:!!t.signal}),{success:!1,error:d}}return console.error("ğŸš¨ API ìš”ì²­ ì‹¤íŒ¨:",{url:s,error:c instanceof Error?c.message:"Unknown error",errorName:c instanceof Error?c.name:"Unknown",errorStack:c instanceof Error?c.stack:void 0}),{success:!1,error:c instanceof Error?c.message:"Unknown error"}}}async saveChannels(e){return this.request("/api/channels",{method:"POST",body:JSON.stringify({channels:e})})}async getChannels(){return this.request("/api/channels")}async saveVideos(e){return this.request("/api/videos",{method:"POST",body:JSON.stringify({videos:e})})}async getVideos(){return this.request("/api/videos")}async saveClassifiedData(e){return this.request("/api/classified",{method:"POST",body:JSON.stringify(e)})}async getClassifiedData(){return this.request("/api/classified")}async saveUnclassifiedData(e){return this.request("/api/unclassified",{method:"POST",body:JSON.stringify(e)})}async getUnclassifiedData(){return this.request("/api/unclassified")}async getDataIds(){return this.request("/api/data/ids")}async saveSystemConfig(e,t){return this.request("/api/system/config",{method:"POST",body:JSON.stringify({key:e,value:t})})}async getSystemConfig(e){return this.request(`/api/system/config/${e}`)}async saveDailyStats(e,t){return this.request("/api/daily-stats",{method:"POST",body:JSON.stringify({date:e,stats:t})})}async getDailyStats(e){const t=e?`/api/daily-stats/${e}`:"/api/daily-stats";return this.request(t)}async testConnection(){return this.request("/api/health")}async updateVideo(e,t){return this.request(`/api/videos/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async deleteVideo(e){return this.request(`/api/videos/${e}`,{method:"DELETE"})}async deleteVideosBatch(e){return this.request("/api/videos/batch",{method:"DELETE",body:JSON.stringify({ids:e})})}}const S=new J;class Z{constructor(e={}){I(this,"dbName","YouTubePulseOutbox");I(this,"dbVersion",1);I(this,"storeName","outbox");I(this,"config");this.config={maxRetries:3,retryDelay:5e3,batchSize:10,...e}}async initDB(){return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=()=>t(s.error),s.onsuccess=()=>e(s.result),s.onupgradeneeded=a=>{const o=a.target.result;if(!o.objectStoreNames.contains(this.storeName)){const r=o.createObjectStore(this.storeName,{keyPath:"id"});r.createIndex("timestamp","timestamp"),r.createIndex("status","status"),r.createIndex("type","type")}}})}async addToOutbox(e,t,s){const a=`outbox_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:a,type:e,endpoint:t,payload:s,timestamp:Date.now(),retries:0,maxRetries:this.config.maxRetries,status:"pending"};try{const l=(await this.initDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName);return await new Promise((c,i)=>{const d=l.add(o);d.onsuccess=()=>c(),d.onerror=()=>i(d.error)}),console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€: ${e} ${t}`,o),a}catch(r){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",r),r}}async getPendingItems(){try{const a=(await this.initDB()).transaction([this.storeName],"readonly").objectStore(this.storeName).index("status");return new Promise((o,r)=>{const n=a.getAll("pending");n.onsuccess=()=>o(n.result),n.onerror=()=>r(n.error)})}catch(e){return console.error("âŒ ëŒ€ê¸° ì‘ì—… ì¡°íšŒ ì‹¤íŒ¨:",e),[]}}async updateItemStatus(e,t,s){try{const r=(await this.initDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName),n=r.get(e);await new Promise((l,c)=>{n.onsuccess=()=>{const i=n.result;if(i){i.status=t,i.error=s,t==="failed"&&(i.retries+=1);const d=r.put(i);d.onsuccess=()=>l(),d.onerror=()=>c(d.error)}else c(new Error("Item not found"))},n.onerror=()=>c(n.error)}),console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸: ${e} â†’ ${t}`)}catch(a){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",a),a}}async removeCompletedItems(){try{const s=(await this.initDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName),a=s.index("status");await new Promise((o,r)=>{const n=a.getAllKeys("completed");n.onsuccess=()=>{const l=n.result;if(l.length===0){o();return}let c=0;l.forEach(i=>{const d=s.delete(i);d.onsuccess=()=>{c++,c===l.length&&o()},d.onerror=()=>r(d.error)})},n.onerror=()=>r(n.error)}),console.log("ğŸ—‘ï¸ ì™„ë£Œëœ ì•„ì›ƒë°•ìŠ¤ ì‘ì—… ì œê±° ì™„ë£Œ")}catch(e){console.error("âŒ ì™„ë£Œëœ ì‘ì—… ì œê±° ì‹¤íŒ¨:",e)}}async processOutbox(){const e=await this.getPendingItems();if(e.length===0)return{success:0,failed:0};console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì²˜ë¦¬ ì‹œì‘: ${e.length}ê°œ ì‘ì—…`);let t=0,s=0;for(let a=0;a<e.length;a+=this.config.batchSize){const o=e.slice(a,a+this.config.batchSize);await Promise.allSettled(o.map(async r=>{try{if(r.retries>=r.maxRetries){await this.updateItemStatus(r.id,"failed","Max retries exceeded"),s++;return}const n=await fetch(r.endpoint,{method:r.type==="update"?"PATCH":r.type==="delete"?"DELETE":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.payload)});if(n.ok)await this.updateItemStatus(r.id,"completed"),t++,console.log(`âœ… ì•„ì›ƒë°•ìŠ¤ ì‘ì—… ì„±ê³µ: ${r.type} ${r.endpoint}`);else throw new Error(`HTTP ${n.status}: ${n.statusText}`)}catch(n){console.error(`âŒ ì•„ì›ƒë°•ìŠ¤ ì‘ì—… ì‹¤íŒ¨: ${r.type} ${r.endpoint}`,n),await this.updateItemStatus(r.id,"failed",n instanceof Error?n.message:"Unknown error"),s++}})),a+this.config.batchSize<e.length&&await new Promise(r=>setTimeout(r,1e3))}return await this.removeCompletedItems(),console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì²˜ë¦¬ ì™„ë£Œ: ì„±ê³µ ${t}ê°œ, ì‹¤íŒ¨ ${s}ê°œ`),{success:t,failed:s}}startAutoProcess(){navigator.onLine&&setTimeout(()=>this.processOutbox(),2e3),window.addEventListener("online",()=>{console.log("ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœ ê°ì§€ - ì•„ì›ƒë°•ìŠ¤ ì²˜ë¦¬ ì‹œì‘"),setTimeout(()=>this.processOutbox(),1e3)}),setInterval(()=>{navigator.onLine&&this.processOutbox()},5*60*1e3)}async getStats(){try{const s=(await this.initDB()).transaction([this.storeName],"readonly").objectStore(this.storeName),a=await new Promise((o,r)=>{const n=s.getAll();n.onsuccess=()=>o(n.result),n.onerror=()=>r(n.error)});return{pending:a.filter(o=>o.status==="pending").length,failed:a.filter(o=>o.status==="failed").length,completed:a.filter(o=>o.status==="completed").length}}catch(e){return console.error("âŒ ì•„ì›ƒë°•ìŠ¤ í†µê³„ ì¡°íšŒ ì‹¤íŒ¨:",e),{pending:0,failed:0,completed:0}}}}const P=new Z;class X{constructor(){I(this,"config");const e=typeof window<"u"&&window.electronAPI!==void 0,t=!!k,s=t&&!e;this.config={useApiServer:s,fallbackToLocal:!0},s?(console.log("ğŸŒ í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ í™œì„±í™”: ì„œë²„ API + IndexedDB"),console.log(`ğŸ“¡ API_BASE_URL: ${k}`)):t?e&&console.log("ğŸ–¥ï¸ Electron í™˜ê²½: ì„œë²„ API ë¹„í™œì„±í™”, IndexedDB ì „ìš© ëª¨ë“œ"):console.log("âš ï¸ API_BASE_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ IndexedDB í´ë°± ëª¨ë“œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.")}updateConfig(e){this.config={...this.config,...e}}async bootstrapSync(){try{console.log("ğŸ”„ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë™ê¸°í™” ì‹œì‘ - ì°¨ë¶„ ì—…ë¡œë“œ ë°©ì‹...");const[e,t]=await Promise.all([D.loadUnclassifiedData(),D.loadClassifiedData()]),s=((e==null?void 0:e.length)||0)+((t==null?void 0:t.length)||0);if(console.log(`ğŸ“Š ë¡œì»¬ ë°ì´í„°: ë¯¸ë¶„ë¥˜ ${(e==null?void 0:e.length)||0}ê°œ, ë¶„ë¥˜ ${(t==null?void 0:t.length)||0}ê°œ, ì´ ${s}ê°œ`),s===0)return{success:!0,uploaded:0,message:"ì—…ë¡œë“œí•  ë¡œì»¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."};console.log("ğŸ” ì„œë²„ ë°ì´í„° ID ëª©ë¡ ì¡°íšŒ ì¤‘...");const a=await S.getDataIds();let o=new Set,r=new Set;a.success&&a.data?(o=new Set(a.data.unclassifiedIds),r=new Set(a.data.classifiedIds),console.log(`ğŸ“Š ì„œë²„ ê¸°ì¡´ ë°ì´í„°: ë¯¸ë¶„ë¥˜ ${o.size}ê°œ, ë¶„ë¥˜ ${r.size}ê°œ`)):console.log("âš ï¸ ì„œë²„ ë°ì´í„° ID ì¡°íšŒ ì‹¤íŒ¨, ì „ì²´ ì—…ë¡œë“œ ì§„í–‰");const n=(e==null?void 0:e.filter(u=>!o.has(String(u.id))))||[],l=(t==null?void 0:t.filter(u=>!r.has(String(u.id))))||[],c=n.length+l.length;if(console.log(`ğŸ“Š ì°¨ë¶„ ê³„ì‚° ê²°ê³¼: ìƒˆë¡œìš´ ë°ì´í„° ${c}ê°œ (ë¯¸ë¶„ë¥˜: ${n.length}ê°œ, ë¶„ë¥˜: ${l.length}ê°œ)`),console.log(`ğŸ“Š ì¤‘ë³µ ì œì™¸: ë¯¸ë¶„ë¥˜ ${((e==null?void 0:e.length)||0)-n.length}ê°œ, ë¶„ë¥˜ ${((t==null?void 0:t.length)||0)-l.length}ê°œ`),c===0)return{success:!0,uploaded:0,message:"ì„œë²„ì— ì´ë¯¸ ëª¨ë“  ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ì—…ë¡œë“œí•  ìƒˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."};let i=0;const d=500;if(n&&n.length>0){console.log(`ğŸ“¤ ìƒˆë¡œìš´ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—…ë¡œë“œ ì‹œì‘: ${n.length}ê°œ`);for(let u=0;u<n.length;u+=d){const h=n.slice(u,u+d),f=Math.floor(u/d)+1,y=Math.ceil(n.length/d);console.log(`ğŸ“¦ ë¯¸ë¶„ë¥˜ ì²­í¬ ${f}/${y} ì—…ë¡œë“œ ì¤‘... (${h.length}ê°œ)`);try{const g=await S.saveUnclassifiedData(h);g.success?(i+=h.length,console.log(`âœ… ë¯¸ë¶„ë¥˜ ì²­í¬ ${f}/${y} ì—…ë¡œë“œ ì™„ë£Œ`)):console.error(`âŒ ë¯¸ë¶„ë¥˜ ì²­í¬ ${f} ì—…ë¡œë“œ ì‹¤íŒ¨:`,g.error),u+d<e.length&&await new Promise(b=>setTimeout(b,300))}catch(g){console.error(`âŒ ë¯¸ë¶„ë¥˜ ì²­í¬ ${f} ì—…ë¡œë“œ ì˜¤ë¥˜:`,g),console.log(`ğŸ”„ ì²­í¬ ${f} ì¬ì‹œë„ ì¤‘...`);try{(await S.saveUnclassifiedData(h)).success&&(i+=h.length,console.log(`âœ… ë¯¸ë¶„ë¥˜ ì²­í¬ ${f} ì¬ì‹œë„ ì„±ê³µ`))}catch{console.error(`âŒ ì²­í¬ ${f} ì¬ì‹œë„ ì‹¤íŒ¨, ê±´ë„ˆëœ€`)}}}console.log(`âœ… ë¯¸ë¶„ë¥˜ ë°ì´í„° ì „ì²´ ì—…ë¡œë“œ ì™„ë£Œ: ${i}ê°œ`)}if(l&&l.length>0){console.log(`ğŸ“¤ ìƒˆë¡œìš´ ë¶„ë¥˜ ë°ì´í„° ì—…ë¡œë“œ ì‹œì‘: ${l.length}ê°œ`);for(let u=0;u<l.length;u+=d){const h=l.slice(u,u+d),f=Math.floor(u/d)+1,y=Math.ceil(l.length/d);console.log(`ğŸ“¦ ë¶„ë¥˜ ì²­í¬ ${f}/${y} ì—…ë¡œë“œ ì¤‘... (${h.length}ê°œ)`);try{const g=await S.saveClassifiedData(h);g.success?(i+=h.length,console.log(`âœ… ë¶„ë¥˜ ì²­í¬ ${f}/${y} ì—…ë¡œë“œ ì™„ë£Œ`)):console.error(`âŒ ë¶„ë¥˜ ì²­í¬ ${f} ì—…ë¡œë“œ ì‹¤íŒ¨:`,g.error),u+d<t.length&&await new Promise(b=>setTimeout(b,300))}catch(g){console.error(`âŒ ë¶„ë¥˜ ì²­í¬ ${f} ì—…ë¡œë“œ ì˜¤ë¥˜:`,g),console.log(`ğŸ”„ ì²­í¬ ${f} ì¬ì‹œë„ ì¤‘...`);try{(await S.saveClassifiedData(h)).success&&(i+=h.length,console.log(`âœ… ë¶„ë¥˜ ì²­í¬ ${f} ì¬ì‹œë„ ì„±ê³µ`))}catch{console.error(`âŒ ì²­í¬ ${f} ì¬ì‹œë„ ì‹¤íŒ¨, ê±´ë„ˆëœ€`)}}}console.log("âœ… ë¶„ë¥˜ ë°ì´í„° ì „ì²´ ì—…ë¡œë“œ ì™„ë£Œ")}console.log("ğŸ”„ ì„œë²„ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ë¡œì»¬ ìºì‹œ ê°±ì‹  ì¤‘...");try{const[u,h]=await Promise.all([this.loadUnclassifiedData(),this.getClassifiedData()]);console.log(`âœ… ì„œë²„ ìŠ¤ëƒ…ìƒ· ì¬ì ì¬ ì™„ë£Œ: ë¯¸ë¶„ë¥˜ ${(u==null?void 0:u.length)||0}ê°œ, ë¶„ë¥˜ ${(h==null?void 0:h.length)||0}ê°œ`)}catch(u){console.warn("âš ï¸ ìºì‹œ ê°±ì‹  ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì—…ë¡œë“œë¨):",u)}return console.log("âœ… ë¶€íŠ¸ìŠ¤íŠ¸ë© ë™ê¸°í™” ì™„ë£Œ!"),{success:!0,uploaded:i,message:`${i.toLocaleString()}ê°œì˜ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì—…ë¡œë“œí–ˆìŠµë‹ˆë‹¤.

ì¤‘ë³µ ì œì™¸: ${s-c}ê°œ`}}catch(e){return console.error("âŒ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë™ê¸°í™” ì‹¤íŒ¨:",e),{success:!1,uploaded:0,message:`ë™ê¸°í™” ì‹¤íŒ¨: ${e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`}}}async saveChannels(e){try{if(this.config.useApiServer){const t=await S.saveChannels(e);if(t.success)console.log("âœ… API ì„œë²„ì— ì±„ë„ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await v.saveDataInBatches(Object.values(e),500),console.log("âœ… ë¡œì»¬ IndexedDBì— ì±„ë„ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ì±„ë„ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await v.saveDataInBatches(Object.values(e),500),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getChannels(){try{if(this.config.useApiServer){const e=await S.getChannels();if(e.success&&e.data)return console.log("âœ… API ì„œë²„ì—ì„œ ì±„ë„ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ"),e.data}if(this.config.fallbackToLocal){const e=await D.getChannels();return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ì±„ë„ ë°ì´í„° ì¡°íšŒ"),e}return{}}catch(e){return console.error("âŒ ì±„ë„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal?await D.getChannels():{}}}async saveVideos(e){try{if(this.config.useApiServer){const t=await S.saveVideos(e);if(t.success)console.log("âœ… API ì„œë²„ì— ë¹„ë””ì˜¤ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await D.saveVideos(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ë¹„ë””ì˜¤ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ë¹„ë””ì˜¤ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await D.saveVideos(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getVideos(){try{if(this.config.useApiServer){const e=await S.getVideos();if(e.success&&e.data)return console.log("âœ… API ì„œë²„ì—ì„œ ë¹„ë””ì˜¤ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ"),e.data}if(this.config.fallbackToLocal){const e=await D.getVideos();return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ë¹„ë””ì˜¤ ë°ì´í„° ì¡°íšŒ"),e}return{}}catch(e){return console.error("âŒ ë¹„ë””ì˜¤ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal?await D.getVideos():{}}}async adaptiveBatchUpload(e,t,s){var d,u,h,f;let n=500,l=0,c=0;const i=[];console.log(`ğŸ“¦ ì–´ëŒ‘í‹°ë¸Œ ë°°ì¹˜ ì—…ë¡œë“œ ì‹œì‘: ${e.length}ê°œ (${s})`);for(let y=0;y<e.length;y+=n){const g=e.slice(y,y+n),b=Math.floor(y/n)+1,$=Math.ceil(e.length/n);console.log(`ğŸ“¦ ë°°ì¹˜ ${b}/${$} ì „ì†¡ ì¤‘... (${g.length}ê°œ, í¬ê¸°: ${n})`);let w=!1,m=0;for(;m<3&&!w;)try{const A=JSON.stringify(g).length,B=((d=g[0])==null?void 0:d.id)||"unknown",x=((u=g[g.length-1])==null?void 0:u.id)||"unknown";console.log("ğŸ“Š ë°°ì¹˜ ìš”ì²­ ì •ë³´:",{batchNum:b,size:g.length,payloadBytes:A,firstId:B,lastId:x,retryAttempt:m+1});const C=await t(g);if(C.success)console.log(`âœ… ë°°ì¹˜ ${b} ì „ì†¡ ì™„ë£Œ (ì‹œë„ ${m+1})`),w=!0,l+=g.length,n<1e3&&m===0&&(n=Math.min(n+50,1e3));else throw new Error(C.error||"API ì‘ë‹µ ì‹¤íŒ¨")}catch(A){m++;const B=((h=A.message)==null?void 0:h.includes("status: 500"))||((f=A.message)==null?void 0:f.includes("status: 413"));if(console.error(`âŒ ë°°ì¹˜ ${b} ì „ì†¡ ì‹¤íŒ¨ (ì‹œë„ ${m}/3):`,{error:A.message,isServerError:B,currentBatchSize:n}),B&&m<3){n=Math.max(Math.floor(n/2),50),console.log(`ğŸ”„ ë°°ì¹˜ í¬ê¸° ì¶•ì†Œ: ${n}`);const x=Math.pow(2,m-1)*1e3;console.log(`â³ ë°±ì˜¤í”„ ëŒ€ê¸°: ${x}ms`),await new Promise(U=>setTimeout(U,x));const C=g.slice(0,n);C.length<g.length&&e.splice(y+C.length,0,...g.slice(C.length)),g.length=C.length,Object.assign(g,C)}else m>=3&&(console.error(`ğŸ’€ ë°°ì¹˜ ${b} ë°ë“œë ˆí„° íë¡œ ì´ë™:`,g.map(x=>x.id)),i.push(...g),c+=g.length,w=!0)}y+n<e.length&&await new Promise(A=>setTimeout(A,1e3))}return console.log("ğŸ“Š ì–´ëŒ‘í‹°ë¸Œ ë°°ì¹˜ ì—…ë¡œë“œ ì™„ë£Œ:",{success:l,failed:c,deadLetter:i.length,finalBatchSize:n}),{success:l,failed:c,deadLetterItems:i}}async saveClassifiedData(e){try{if(this.config.useApiServer)if(Array.isArray(e)&&e.length>500){const t=await this.adaptiveBatchUpload(e,s=>S.saveClassifiedData(s),"ë¶„ë¥˜ ë°ì´í„°");t.deadLetterItems.length>0&&console.warn(`âš ï¸ ${t.deadLetterItems.length}ê°œ í•­ëª©ì´ ë°ë“œë ˆí„° íë¡œ ì´ë™ë¨`)}else{const t=await S.saveClassifiedData(e);if(t.success)console.log("âœ… API ì„œë²„ì— ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await D.saveClassifiedData(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await D.saveClassifiedData(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getClassifiedData(){try{if(this.config.useApiServer){console.log("ğŸ”„ ì„œë²„ì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹œë„...");const e=await S.getClassifiedData();console.log("ğŸ“¦ ì„œë²„ ì‘ë‹µ:",{isArray:Array.isArray(e),hasSuccess:e&&typeof e=="object"&&"success"in e,success:e&&typeof e=="object"&&"success"in e?e.success:void 0,dataLength:e&&typeof e=="object"&&"data"in e&&Array.isArray(e.data)?e.data.length:void 0,error:e&&typeof e=="object"&&"error"in e?e.error:void 0});const t=Array.isArray(e)?e:e.success&&e.data&&Array.isArray(e.data)?e.data:[];if(t.length>0)return console.log("âœ… API ì„œë²„ì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ:",t.length,"ê°œ"),v.saveDataInBatches(t,500).then(()=>{console.log("âœ… ì•ˆì „í•œ IndexedDB ìºì‹œ ê°±ì‹  ì™„ë£Œ")}).catch(s=>{console.warn("âš ï¸ ì•ˆì „í•œ IndexedDB ìºì‹œ ê°±ì‹  ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì •ìƒ ë°˜í™˜):",s),this.scheduleBackgroundSync()}),t;console.warn("âš ï¸ ì„œë²„ì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì—†ìŒ (ë¹ˆ ë°°ì—´ ë˜ëŠ” ì‹¤íŒ¨)")}if(this.config.fallbackToLocal){console.log("ğŸ”„ IndexedDBì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹œë„...");const e=await v.loadAllData();if(e.length>0)return console.log("âš ï¸ ì•ˆì „í•œ IndexedDBì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ (ì„œë²„ ì—°ê²° ì‹¤íŒ¨):",e.length,"ê°œ"),e;console.warn("âš ï¸ IndexedDBë„ ë¹„ì–´ìˆìŒ - ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‹œë„"),this.scheduleBackgroundSync()}return[]}catch(e){if(console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal){try{const t=await v.loadAllData();if(t.length>0)return console.log("âš ï¸ ì˜¤ë¥˜ ë°œìƒ, ì•ˆì „í•œ IndexedDB í´ë°±:",t.length,"ê°œ"),t}catch(t){console.error("âŒ IndexedDB í´ë°±ë„ ì‹¤íŒ¨:",t)}this.scheduleBackgroundSync()}return[]}}scheduleBackgroundSync(){this.backgroundSyncScheduled||(this.backgroundSyncScheduled=!0,setTimeout(async()=>{try{console.log("ğŸ”„ ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‹œì‘...");const[e,t]=await Promise.allSettled([S.getClassifiedData(),S.getUnclassifiedData()]);let s=0;if(e.status==="fulfilled"){const a=Array.isArray(e.value)?e.value:e.value.success&&e.value.data&&Array.isArray(e.value.data)?e.value.data:[];a.length>0&&(await v.saveDataInBatches(a,500),s+=a.length,console.log("âœ… ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì™„ë£Œ (ë¶„ë¥˜):",a.length,"ê°œ"))}else console.warn("âš ï¸ ë°±ê·¸ë¼ìš´ë“œ ë¶„ë¥˜ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:",e.reason);if(t.status==="fulfilled"){const a=Array.isArray(t.value)?t.value:t.value.success&&t.value.data&&Array.isArray(t.value.data)?t.value.data:[];a.length>0&&(await v.saveDataInBatches(a,500),s+=a.length,console.log("âœ… ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì™„ë£Œ (ë¯¸ë¶„ë¥˜):",a.length,"ê°œ"))}else console.warn("âš ï¸ ë°±ê·¸ë¼ìš´ë“œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:",t.reason);s>0&&console.log("âœ… ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì™„ë£Œ (ì „ì²´):",s,"ê°œ")}catch(e){console.warn("âš ï¸ ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‹¤íŒ¨:",e)}finally{this.backgroundSyncScheduled=!1}},5e3))}async saveUnclassifiedData(e){try{if(this.config.useApiServer)if(Array.isArray(e)&&e.length>500){const t=await this.adaptiveBatchUpload(e,s=>S.saveUnclassifiedData(s),"ë¯¸ë¶„ë¥˜ ë°ì´í„°");t.deadLetterItems.length>0&&console.warn(`âš ï¸ ${t.deadLetterItems.length}ê°œ í•­ëª©ì´ ë°ë“œë ˆí„° íë¡œ ì´ë™ë¨`)}else{const t=await S.saveUnclassifiedData(e);if(t.success)console.log("âœ… API ì„œë²„ì— ë¯¸ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await D.saveUnclassifiedData(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ë¯¸ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await D.saveUnclassifiedData(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getUnclassifiedData(){try{if(this.config.useApiServer){console.log("ğŸ”„ ì„œë²„ì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹œë„...");const e=await S.getUnclassifiedData();console.log("ğŸ“¦ ì„œë²„ ì‘ë‹µ (ë¯¸ë¶„ë¥˜):",{isArray:Array.isArray(e),hasSuccess:e&&typeof e=="object"&&"success"in e,success:e&&typeof e=="object"&&"success"in e?e.success:void 0,dataLength:e&&typeof e=="object"&&"data"in e&&Array.isArray(e.data)?e.data.length:void 0,error:e&&typeof e=="object"&&"error"in e?e.error:void 0});const t=Array.isArray(e)?e:e.success&&e.data&&Array.isArray(e.data)?e.data:[];if(t.length>0)return console.log("âœ… API ì„œë²„ì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ:",t.length,"ê°œ"),v.saveDataInBatches(t,500).then(()=>{console.log("âœ… ì•ˆì „í•œ IndexedDB ìºì‹œ ê°±ì‹  ì™„ë£Œ (ë¯¸ë¶„ë¥˜)")}).catch(s=>{console.warn("âš ï¸ ì•ˆì „í•œ IndexedDB ìºì‹œ ê°±ì‹  ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì •ìƒ ë°˜í™˜):",s),this.scheduleBackgroundSync()}),t;console.warn("âš ï¸ ì„œë²„ì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—†ìŒ (ë¹ˆ ë°°ì—´ ë˜ëŠ” ì‹¤íŒ¨)")}if(this.config.fallbackToLocal){console.log("ğŸ”„ IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹œë„...");const e=await v.loadAllData();if(e.length>0)return console.log("âš ï¸ ì•ˆì „í•œ IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ (ì„œë²„ ì—°ê²° ì‹¤íŒ¨):",e.length,"ê°œ"),e;console.warn("âš ï¸ IndexedDBë„ ë¹„ì–´ìˆìŒ - ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‹œë„ (ë¯¸ë¶„ë¥˜)"),this.scheduleBackgroundSync()}return[]}catch(e){if(console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),console.error("âŒ ì—ëŸ¬ ìƒì„¸:",{message:e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜",stack:e instanceof Error?e.stack:void 0,error:e}),this.config.fallbackToLocal){try{const t=await v.loadAllData();if(t.length>0)return console.log("âš ï¸ ì˜¤ë¥˜ ë°œìƒ, ì•ˆì „í•œ IndexedDB í´ë°± (ë¯¸ë¶„ë¥˜):",t.length,"ê°œ"),t}catch(t){console.error("âŒ IndexedDB í´ë°±ë„ ì‹¤íŒ¨:",t)}this.scheduleBackgroundSync()}return[]}}async loadUnclassifiedData(){try{const e=await v.loadAllData();return console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ì•ˆì „í•œ IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ"),e}catch(e){return console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",e),[]}}async loadUnclassifiedDataByDate(e){try{const t=await D.loadUnclassifiedDataByDate(e);return console.log(`âœ… í•˜ì´ë¸Œë¦¬ë“œ: ${e} ë‚ ì§œ ë°ì´í„° ë¡œë“œ`),t}catch(t){return console.error("âŒ ë‚ ì§œë³„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",t),[]}}async updateUnclassifiedData(e){try{await this.saveUnclassifiedData(e),console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ")}catch(t){throw console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",t),t}}async loadClassifiedData(){try{const e=await D.loadClassifiedData();return console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: IndexedDBì—ì„œ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ"),e}catch(e){return console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",e),[]}}async loadClassifiedByDate(e){try{const t=await D.loadClassifiedByDate(e);return console.log(`âœ… í•˜ì´ë¸Œë¦¬ë“œ: ${e} ë‚ ì§œ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ`),t||[]}catch(t){return console.error("âŒ ë‚ ì§œë³„ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",t),[]}}async saveDailyProgress(e){try{await D.saveDailyProgress(e),console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ì¼ë³„ ì§„í–‰ë¥  ì €ì¥ ì™„ë£Œ")}catch(t){throw console.error("âŒ ì¼ë³„ ì§„í–‰ë¥  ì €ì¥ ì‹¤íŒ¨:",t),t}}async getAvailableDates(){try{const e=await D.getAvailableDates();return console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ì‚¬ìš© ê°€ëŠ¥í•œ ë‚ ì§œ ì¡°íšŒ"),e}catch(e){return console.error("âŒ ë‚ ì§œ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:",e),[]}}async saveSystemConfig(e,t){try{if(this.config.useApiServer){const s=await S.saveSystemConfig(e,t);if(s.success)console.log("âœ… API ì„œë²„ì— ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì™„ë£Œ");else throw new Error(s.error||"API ì €ì¥ ì‹¤íŒ¨")}await D.saveSystemConfig(e,t),console.log("âœ… ë¡œì»¬ IndexedDBì— ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì™„ë£Œ")}catch(s){if(console.error("âŒ ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:",s),this.config.fallbackToLocal)await D.saveSystemConfig(e,t),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw s}}async getSystemConfig(e){try{if(this.config.useApiServer){const t=await S.getSystemConfig(e);if(t.success&&t.data!==void 0)return console.log("âœ… API ì„œë²„ì—ì„œ ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ ì™„ë£Œ"),t.data}if(this.config.fallbackToLocal){const t=await D.getSystemConfig(e);return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ"),t}return null}catch(t){return console.error("âŒ ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨:",t),this.config.fallbackToLocal?await D.getSystemConfig(e):null}}async saveCategories(e){try{this.config.useApiServer&&console.log("âš ï¸ API ì„œë²„ ì¹´í…Œê³ ë¦¬ ì €ì¥ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."),await D.saveCategories(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await D.saveCategories(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async loadCategories(){try{if(this.config.useApiServer&&console.log("âš ï¸ API ì„œë²„ ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."),this.config.fallbackToLocal){const e=await D.loadCategories();return console.log("âœ… ë¡œì»¬ IndexedDBì—ì„œ ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì¡°íšŒ"),e}return null}catch(e){return console.error("âŒ ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal?await D.loadCategories():null}}async testApiConnection(){try{return(await S.testConnection()).success}catch(e){return console.error("âŒ API ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:",e),!1}}async syncToApi(){try{console.log("ğŸ”„ ë°ì´í„° ë™ê¸°í™” ì‹œì‘...");const e=await D.getChannels();Object.keys(e).length>0&&await this.saveChannels(e);const t=await D.getVideos();Object.keys(t).length>0&&await this.saveVideos(t);const s=await D.getClassifiedData();s.length>0&&await this.saveClassifiedData(s);const a=await D.loadUnclassifiedData();a.length>0&&await this.saveUnclassifiedData(a),console.log("âœ… ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ")}catch(e){throw console.error("âŒ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:",e),e}}async safeUpdateVideo(e,t){try{if(this.config.useApiServer){const s=await S.updateVideo(e,t);if(s.success)return console.log(`âœ… ë¹„ë””ì˜¤ ì—…ë°ì´íŠ¸ ì„±ê³µ: ${e}`),{success:!0};throw new Error(s.error||"Update failed")}}catch(s){console.warn("âš ï¸ ì„œë²„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨, ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€:",s);try{const a=await P.addToOutbox("update",`/api/videos/${e}`,t);return console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€ë¨: ${a}`),{success:!1,outboxId:a}}catch(a){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",a),a}}return{success:!1}}async safeDeleteVideo(e){try{if(this.config.useApiServer){const t=await S.deleteVideo(e);if(t.success)return console.log(`âœ… ë¹„ë””ì˜¤ ì‚­ì œ ì„±ê³µ: ${e}`),{success:!0};throw new Error(t.error||"Delete failed")}}catch(t){console.warn("âš ï¸ ì„œë²„ ì‚­ì œ ì‹¤íŒ¨, ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€:",t);try{const s=await P.addToOutbox("delete",`/api/videos/${e}`,{});return console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€ë¨: ${s}`),{success:!1,outboxId:s}}catch(s){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",s),s}}return{success:!1}}async safeDeleteVideosBatch(e){try{if(this.config.useApiServer){const t=await S.deleteVideosBatch(e);if(t.success)return console.log(`âœ… ë°°ì¹˜ ì‚­ì œ ì„±ê³µ: ${e.length}ê°œ`),{success:!0};throw new Error(t.error||"Batch delete failed")}}catch(t){console.warn("âš ï¸ ì„œë²„ ë°°ì¹˜ ì‚­ì œ ì‹¤íŒ¨, ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€:",t);try{const s=await P.addToOutbox("delete","/api/videos/batch",{ids:e});return console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€ë¨: ${s}`),{success:!1,outboxId:s}}catch(s){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",s),s}}return{success:!1}}initializeOutbox(){console.log("ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì„œë¹„ìŠ¤ ì´ˆê¸°í™”"),P.startAutoProcess()}async getOutboxStats(){return await P.getStats()}async processOutbox(){return await P.processOutbox()}}const Y=new X,se=Object.freeze(Object.defineProperty({__proto__:null,hybridService:Y},Symbol.toStringTag,{value:"Module"}));export{k as A,Y as a,S as b,ee as c,Q as d,te as e,se as f,v as h,D as i,T as s};
