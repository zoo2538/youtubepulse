const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.ClCJK6km.js","assets/vendor.DsNdnymT.js","assets/utils.Cc143Zw7.js","assets/ui.CxZ6r7GM.js","assets/scheduler.BInQdtCZ.js","assets/index.C7VeV093.css"])))=>i.map(i=>d[i]);
var _=Object.defineProperty;var M=(p,e,t)=>e in p?_(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var v=(p,e,t)=>M(p,typeof e!="symbol"?e+"":e,t);import{_ as N}from"./utils.Cc143Zw7.js";const T={ì§œì§‘ê¸°:["ë“œë¼ë§ˆ/ì˜í™”","ë“œë¼ë§ˆ/ì˜í™” (ë¡±í¼)","ì‡¼ì¸  ë“œë¼ë§ˆ","ì´ì•¼ê¸°/ì° (ì„¤ì •)","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],í•´ì™¸ì§œì§‘ê¸°:["ì´ìŠˆ/ì •ë³´","ì´ì•¼ê¸°/ì° (ì„¤ì •)","ìœ ë¨¸/ì›ƒìŒ/ê°ë™","ìˆì¸  ë“œë¼ë§ˆ","ì¢…í•©/ì˜ˆëŠ¥","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ì—°ì˜ˆ:["ì•„ì´ëŒ/ì´ìŠˆ/ì •ë³´","íŠ¸ë¡¯/ì´ìŠˆ/ì •ë³´","ì—°ì˜ˆì¸/ì´ìŠˆ/ì •ë³´","íŒ¬íŠœë¸Œ (ì•„ì´ëŒ)","íŒ¬íŠœë¸Œ (ì•„ì´ëŒì™¸)","ì¢…í•©/ì˜ˆëŠ¥","ì „ë¬¸/ë¸Œëœë“œ","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ì‹œë‹ˆì–´:["ì´ì•¼ê¸°/ì°/ì‚¬ì—°","ê±´ê°•/ìš´ë™/íŒ¨ì…˜","ì •ë³´/êµìœ¡/ëª…ì–¸","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ì •ì¹˜:["ì´ìŠˆ/ì •ë³´/ìš”ì•½","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ì‚¬íšŒ/ê²½ì œ/ì‹œì‚¬":["ë‰´ìŠ¤/ìš”ì•½/í•˜ì´ë¼ì´íŠ¸","ì´ìŠˆ/ì •ë³´/ì°","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ì»¤ë®¤ë‹ˆí‹°/ì°":["ì´ìŠˆ/ì •ë³´","ì´ì•¼ê¸°/ì° (ì„¤ì •)","ìœ ë¨¸/ì›ƒìŒ/ê°ë™","êµ­ë½•/íë§","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ë¼ì´í”„ìŠ¤íƒ€ì¼:["ê±´ê°•/ìš´ë™","ì—¬í–‰/ê´€ê´‘","ì·¨ë¯¸/ì—¬ê°€","ì¸í…Œë¦¬ì–´/í™ˆë°ì½”","íŒ¨ì…˜/ë·°í‹°","ë°˜ë ¤ë™ë¬¼","ì¼ìƒ/ë¸Œì´ë¡œê·¸","ìš”ë¦¬/í•œì‹","ìŒì‹/ë¨¹ë°©","ê²°í˜¼/ìœ¡ì•„ (ì •ë³´,ì¼ìƒ)","ê°œì¸ ë°©ì†¡","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],í¬ë¦¬ì—ì´í„°:["ê°œì¸/ë¸Œì´ë¡œê·¸","êµìœ¡/ê°•ì˜","ë¦¬ë·°/ë¶„ì„","ì–´ë¦°ì´ì „ë¬¸","ìŒì•…/ë¦¬ì•¡ì…˜","í”Œë ˆì´ë¦¬ìŠ¤íŠ¸/ASMR","ìˆì¸  ë“œë¼ë§ˆ","ê°œì¸ ë°©ì†¡","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"AI/ì»´í“¨í„°/ê¸°ìˆ ":["ì´ìŠˆ/ì •ë³´/ì°","AI ì˜ìƒ/ì´ì•¼ê¸°","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ìŠ¤í¬ì¸ :["ì´ìŠˆ/ì •ë³´/ì°","ìš”ì•½/í•˜ì´ë¼ì´íŠ¸/ë¦¬ë·°","íŒ¬íŠœë¸Œ","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ê²Œì„:["ì‹¤ì‹œê°„/í”Œë ˆì´","ì •ë³´/ì´ìŠˆ/ê³µëµ/ìš”ì•½","íŒ¬íŠœë¸Œ","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],ì˜¤í”¼ì…œ:["ê³µì‹/ë¸Œëœë“œ","ê°œì¸/ë¸Œëœë“œ","ì „ë¬¸/ë¸Œëœë“œ","ê°œì¸ ë°©ì†¡ (ë¼ë°©ì™¸)","ì¢…í•©/ê¸°íƒ€ (ë¸Œëœë“œ)","ì¢…í•©/ê¸°íƒ€","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ì‡¼í•‘/ë¦¬ë·°":["ìƒí™œ ì œí’ˆ","íŒ¨ì…˜/ë·°í‹°","ì „ë¬¸ ì œí’ˆ","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ì• ë‹ˆ/ì›¹íˆ°":["ìš”ì•½/í•˜ì´ë¼ì´íŠ¸/ë¦¬ë·°","ì´ìŠˆ/ì •ë³´/ì°","ë•í›„ì¡´","ì „ë¬¸/ë¸Œëœë“œ","ì¢…í•©/ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€","ê¸°íƒ€ (ì°¸ê³ )"],"ê¸°íƒ€(êµ­ë‚´)":["ê¸°íƒ€ (ë¸Œëœë“œ)","ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì°¸ê³ )","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€ (ê²Œì„)","ê¸°íƒ€ (ì–´ë¦°ì´)","ê¸°íƒ€ (ê¸°íƒ€)","ë§Œí™” (ì˜ì–´ì±„ë„)","K-POP (ì˜ì–´ì±„ë„)","ë“œë¼ë§ˆ, ì˜í™” (ì˜ì–´ì±„ë„)"],"ê¸°íƒ€(í•´ì™¸)":["ê¸°íƒ€","ê¸°íƒ€ (ë¸Œëœë“œ)","ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€ (ê²Œì„)","ê¸°íƒ€ (ì‡¼í•‘)","ì™¸êµ­ ë“œë¼ë§ˆ, ì˜í™”","ì™¸êµ­ ë…¸ë˜","ì™¸êµ­ ë§Œí™”","ì™¸êµ­ ì˜ˆëŠ¥","ê¸°íƒ€ (ì°¸ê³ )"],ê¸°íƒ€:["ê¸°íƒ€","ê¸°íƒ€ (ë¸Œëœë“œ)","ê¸°íƒ€ (ì „ë¬¸)","ê¸°íƒ€ (ì°¸ê³ )","ê¸°íƒ€ (ì¢…í•©)","ê¸°íƒ€ (ê²Œì„)","ê¸°íƒ€ (ìŒì•…)","ê¸°íƒ€ (ì‚­ì œ)"]},Q=Object.keys(T),ee={ì§œì§‘ê¸°:"#00FFFF",í•´ì™¸ì§œì§‘ê¸°:"#84CC16",ì •ì¹˜:"#EF4444","AI/ì»´í“¨í„°/ê¸°ìˆ ":"#10B981",ì—°ì˜ˆ:"#EC4899",ìŠ¤í¬ì¸ :"#06B6D4",ì‹œë‹ˆì–´:"#C0C0C0","ì»¤ë®¤ë‹ˆí‹°/ì°":"#F97316",ê²Œì„:"#8B4513",ë¼ì´í”„ìŠ¤íƒ€ì¼:"#20B2AA",ì˜¤í”¼ì…œ:"#6366F1",í¬ë¦¬ì—ì´í„°:"#FFEB3B","ì‡¼í•‘/ë¦¬ë·°":"#8B5CF6","ì• ë‹ˆ/ì›¹íˆ°":"#FFB6C1","ê¸°íƒ€(êµ­ë‚´)":"#FF6B6B","ê¸°íƒ€(í•´ì™¸)":"#4ECDC4",ê¸°íƒ€:"#6B7280","ì‚¬íšŒ/ê²½ì œ/ì‹œì‚¬":"#15803D"},q={í¬ë¦¬ì—ì´í„°:["ì „ë¬¸ë¸Œëœë“œ"]};function L(p){if(!p)return null;const e={};return Object.keys(p).forEach(t=>{const s=Array.isArray(p[t])?p[t]:[],a=q[t]||[],o=s.filter(r=>!a.includes(r));e[t]=o}),e}function K(p){const e={},t=p||{};return Object.keys(T).forEach(s=>{const a=T[s]||[],o=Array.isArray(t[s])?t[s]:[],r=[...new Set([...o,...a])],n=q[s]||[];e[s]=r.filter(i=>!n.includes(i))}),Object.keys(t).forEach(s=>{if(!e[s]){const a=q[s]||[],o=Array.isArray(t[s])?t[s]:[];e[s]=o.filter(r=>!a.includes(r))}}),e}const E=14;class V{constructor(){v(this,"dbName","YouTubePulseDB");v(this,"version",12);v(this,"db",null)}async restartConnection(){console.log("ğŸ”„ IndexedDB ì—°ê²° ì¬ì‹œì‘ ì¤‘..."),this.db&&(this.db.close(),this.db=null),await new Promise(e=>setTimeout(e,500)),await this.init(),console.log("âœ… IndexedDB ì—°ê²° ì¬ì‹œì‘ ì™„ë£Œ")}async init(){if(this.db&&this.db.readyState==="open"){console.log("âœ… IndexedDBService ì´ë¯¸ ì´ˆê¸°í™”ë¨");return}return this.db&&(this.db.close(),this.db=null),await new Promise(e=>setTimeout(e,200)),new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>{console.error("IndexedDB ì´ˆê¸°í™” ì‹¤íŒ¨:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,console.log("âœ… IndexedDB ì´ˆê¸°í™” ì„±ê³µ:",this.dbName),e()},s.onupgradeneeded=a=>{const o=a.target.result;if(o.objectStoreNames.contains("unclassifiedData")){const n=o.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData");if(n.indexNames.contains("videoDay"))try{n.deleteIndex("videoDay"),console.log("ğŸ”„ ê¸°ì¡´ unique videoDay ì¸ë±ìŠ¤ ì œê±°ë¨")}catch(i){console.log("âš ï¸ ê¸°ì¡´ videoDay ì¸ë±ìŠ¤ ì œê±° ì‹¤íŒ¨ (ë¬´ì‹œë¨):",i)}n.createIndex("videoDay",["videoId","dayKeyLocal"],{unique:!1}),console.log("âœ… ìƒˆë¡œìš´ non-unique videoDay ì¸ë±ìŠ¤ ìƒì„±ë¨"),n.indexNames.contains("dayKeyLocal")||n.createIndex("dayKeyLocal","dayKeyLocal",{unique:!1})}else{const r=o.createObjectStore("unclassifiedData",{keyPath:"id"});r.createIndex("channelName","channelName",{unique:!1}),r.createIndex("status","status",{unique:!1}),r.createIndex("category","category",{unique:!1}),r.createIndex("videoDay",["videoId","dayKeyLocal"],{unique:!1}),r.createIndex("dayKeyLocal","dayKeyLocal",{unique:!1})}if(!o.objectStoreNames.contains("classifiedData")){const r=o.createObjectStore("classifiedData",{keyPath:"id"});r.createIndex("channelName","channelName",{unique:!1}),r.createIndex("category","category",{unique:!1})}if(o.objectStoreNames.contains("channels")||o.createObjectStore("channels",{keyPath:"id"}).createIndex("name","name",{unique:!1}),!o.objectStoreNames.contains("videos")){const r=o.createObjectStore("videos",{keyPath:"id"});r.createIndex("channelId","channelId",{unique:!1}),r.createIndex("uploadDate","uploadDate",{unique:!1})}if(o.objectStoreNames.contains("categories")?(o.deleteObjectStore("categories"),o.createObjectStore("categories",{autoIncrement:!0})):o.createObjectStore("categories",{autoIncrement:!0}),o.objectStoreNames.contains("subCategories")||o.createObjectStore("subCategories",{keyPath:"id",autoIncrement:!0}).createIndex("category","category",{unique:!1}),o.objectStoreNames.contains("systemConfig")||o.createObjectStore("systemConfig",{keyPath:"key"}),o.objectStoreNames.contains("dailySummary")||o.createObjectStore("dailySummary",{keyPath:"date"}).createIndex("date","date",{unique:!0}),o.objectStoreNames.contains("dailyProgress")||o.createObjectStore("dailyProgress",{autoIncrement:!0}),o.objectStoreNames.contains("classifiedByDate")||o.createObjectStore("classifiedByDate",{keyPath:"date"}).createIndex("date","date",{unique:!0}),!o.objectStoreNames.contains("classificationLogs")){const r=o.createObjectStore("classificationLogs",{keyPath:"id"});r.createIndex("channelId","channelId",{unique:!1}),r.createIndex("effectiveDate","effectiveDate",{unique:!1}),r.createIndex("channelEffective",["channelId","effectiveDate"],{unique:!1})}o.objectStoreNames.contains("backupSettings")||o.createObjectStore("backupSettings",{keyPath:"key"})}})}async replaceAllUnclassifiedData(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=o.clear();r.onsuccess=()=>{let n=0;const i=e.length;if(i===0){t();return}e.forEach(c=>{const l=o.put(c);l.onsuccess=()=>{n++,n===i&&t()},l.onerror=()=>s(l.error)})},r.onerror=()=>s(r.error)})}async saveUnclassifiedData(e){if(this.db||await this.init(),e.length===0)return Promise.resolve();console.log(`ğŸ”„ ë°±ì—… ë³µì› ì‹œì‘: ${e.length}ê°œ í•­ëª©`);const t=e.filter(o=>o.videoId?!0:(console.warn("âŒ videoIdê°€ ì—†ëŠ” í•­ëª© ì œì™¸:",o),!1)).map(o=>{const r=this.normalizeDayKey(o.dayKeyLocal||o.collectionDate||o.uploadDate);return{...o,dayKeyLocal:r,id:o.id||`${Date.now()}_${Math.random().toString(36).substr(2,9)}_${Math.random().toString(36).substr(2,9)}`}});console.log(`âœ… ë‚ ì§œ í‚¤ ë‹¨ì¼í™” ì™„ë£Œ: ${t.length}ê°œ í•­ëª©`);const s=new Map;t.forEach(o=>{if(!o.videoId||!o.dayKeyLocal){console.warn("âŒ í•„ìˆ˜ í•„ë“œê°€ ì—†ëŠ” í•­ëª© ì œì™¸:",{videoId:o.videoId,dayKeyLocal:o.dayKeyLocal});return}const r=`${o.videoId}|${o.dayKeyLocal}`;if(s.has(r)){const n=s.get(r),i={...n,...o,viewCount:Math.max(n.viewCount||0,o.viewCount||0),likeCount:Math.max(n.likeCount||0,o.likeCount||0),status:o.status==="classified"?"classified":n.status,category:o.category||n.category,subCategory:o.subCategory||n.subCategory};s.set(r,i),console.log(`ğŸ”„ ì¤‘ë³µ í•­ëª© ë³‘í•©: ${r} (ì¡°íšŒìˆ˜: ${n.viewCount} â†’ ${i.viewCount})`)}else s.set(r,o)});const a=Array.from(s.values());return console.log(`ğŸ”„ ì¤‘ë³µ ì œê±° ì™„ë£Œ: ${t.length}ê°œ â†’ ${a.length}ê°œ`),new Promise((o,r)=>{const n=this.db.transaction(["unclassifiedData"],"readwrite"),i=n.objectStore("unclassifiedData"),c=i.clear();c.onsuccess=()=>{console.log("ğŸ—‘ï¸ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì™„ë£Œ");let l=0,d=0;const u=a.length;console.log(`ğŸ”„ ìƒˆ ë°ì´í„° ì €ì¥ ì‹œì‘: ${u}ê°œ í•­ëª©`),a.forEach((f,h)=>{const g=i.put(f);g.onsuccess=()=>{l++,l+d===u&&(console.log(`âœ… ë°±ì—… ë³µì› ì™„ë£Œ: ${l}ê°œ ì„±ê³µ, ${d}ê°œ ì‹¤íŒ¨`),o())},g.onerror=()=>{console.warn(`í•­ëª© ${h} ì €ì¥ ì‹¤íŒ¨:`,g.error),d++,l+d===u&&(console.log(`âœ… ë°±ì—… ë³µì› ì™„ë£Œ: ${l}ê°œ ì„±ê³µ, ${d}ê°œ ì‹¤íŒ¨`),o())}})},c.onerror=()=>{console.error("âŒ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",c.error),r(c.error)},n.oncomplete=()=>{console.log("ğŸ‰ ë°±ì—… ë³µì› íŠ¸ëœì­ì…˜ ì™„ë£Œ")},n.onerror=()=>{console.error("âŒ ë°±ì—… ë³µì› íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",n.error),r(n.error)}})}normalizeDayKey(e){if(!e)return new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"});try{const t=new Date(e);return isNaN(t.getTime())?new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"}):t.toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"})}catch(t){return console.warn("ë‚ ì§œ í‚¤ ë³€í™˜ ì‹¤íŒ¨:",e,t),new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Seoul"})}}async loadUnclassifiedData(){return this.db||await this.init(),new Promise((e,t)=>{try{const o=this.db.transaction(["unclassifiedData"],"readonly").objectStore("unclassifiedData").getAll();o.onsuccess=()=>{console.log("âœ… IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ:",o.result.length,"ê°œ"),e(o.result)},o.onerror=()=>{console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",o.error),t(o.error)}}catch(s){console.error("âŒ IndexedDB íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",s),t(s)}})}async loadUnclassifiedDataByDate(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction(["unclassifiedData"],"readonly").objectStore("unclassifiedData").getAll();r.onsuccess=()=>{const n=r.result.filter(i=>(i.collectionDate||i.uploadDate)===e);t(n)},r.onerror=()=>s(r.error)})}async getAvailableDates(){return this.db||await this.init(),new Promise((e,t)=>{try{const s=new Set;let a=0;const o=3,r=()=>{if(a++,a===o){const y=new Date,b=new Date(y.getTime()+9*60*60*1e3),I=b.toISOString().split("T")[0];for(let w=0;w<E;w++){const $=new Date(b.getTime()-w*24*60*60*1e3).toISOString().split("T")[0];s.add($)}const S=Array.from(s).sort((w,C)=>C.localeCompare(w));console.log(`ğŸ“… ì‚¬ìš© ê°€ëŠ¥í•œ ë‚ ì§œë“¤ (${E}ì¼ ë²”ìœ„ ìë™ ìƒì„±): ${S.length}ê°œ`,S),e(S)}},c=this.db.transaction(["unclassifiedData"],"readonly").objectStore("unclassifiedData").getAll();c.onsuccess=()=>{c.result.forEach(y=>{const b=y.collectionDate||y.uploadDate;b&&s.add(b)}),console.log(`ğŸ“Š unclassifiedDataì—ì„œ ${c.result.length}ê°œ í•­ëª© ì¡°íšŒ`),r()},c.onerror=()=>{console.error("âŒ unclassifiedData ì¡°íšŒ ì‹¤íŒ¨:",c.error),r()};const u=this.db.transaction(["classifiedData"],"readonly").objectStore("classifiedData").getAll();u.onsuccess=()=>{u.result.forEach(y=>{const b=y.collectionDate||y.uploadDate;b&&s.add(b)}),console.log(`ğŸ“Š classifiedDataì—ì„œ ${u.result.length}ê°œ í•­ëª© ì¡°íšŒ`),r()},u.onerror=()=>{console.error("classifiedData ì¡°íšŒ ì‹¤íŒ¨:",u.error),r()};const g=this.db.transaction(["dailyProgress"],"readonly").objectStore("dailyProgress").getAll();g.onsuccess=()=>{g.result.forEach(y=>{y.date&&s.add(y.date)}),console.log(`ğŸ“Š dailyProgressì—ì„œ ${g.result.length}ê°œ í•­ëª© ì¡°íšŒ`),r()},g.onerror=()=>{console.error("âŒ dailyProgress ì¡°íšŒ ì‹¤íŒ¨:",g.error),r()}}catch(s){console.error("âŒ getAvailableDates íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",s),this.restartConnection().then(()=>{console.log("ğŸ”„ ì—°ê²° ì¬ì‹œì‘ í›„ ë‹¤ì‹œ ì‹œë„"),e([])}).catch(()=>{t(s)})}})}async clearUnclassifiedData(){return this.db||await this.init(),new Promise((e,t)=>{try{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData").clear();o.onsuccess=()=>{console.log("âœ… unclassifiedData ì „ì²´ ì‚­ì œ ì™„ë£Œ"),e()},o.onerror=()=>{console.error("âŒ unclassifiedData ì‚­ì œ ì‹¤íŒ¨:",o.error),t(o.error)}}catch(s){console.error("âŒ clearUnclassifiedData íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:",s),t(s)}})}async saveClassifiedData(e){if(this.db||await this.init(),!Array.isArray(e))return console.error("âŒ saveClassifiedData: dataê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:",typeof e,e),Promise.reject(new Error("Data must be an array"));const t=e.filter(s=>s.id?!0:(console.warn("âŒ IDê°€ ì—†ëŠ” ë¶„ë¥˜ ë°ì´í„° ì œì™¸:",s),!1));return console.log(`ğŸ“Š ë¶„ë¥˜ ë°ì´í„° ì €ì¥: ${e.length}ê°œ â†’ ${t.length}ê°œ (ìœ íš¨í•œ ë°ì´í„°)`),new Promise((s,a)=>{const r=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData"),n=r.clear();n.onsuccess=()=>{let i=0;const c=t.length;if(c===0){s();return}t.forEach(l=>{const d=r.put(l);d.onsuccess=()=>{i++,i===c&&s()},d.onerror=()=>a(d.error)})},n.onerror=()=>a(n.error)})}async saveClassificationLog(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction(["classificationLogs"],"readwrite").objectStore("classificationLogs").put(e);r.onsuccess=()=>{console.log(`âœ… ë¶„ë¥˜ ë¡œê·¸ ì €ì¥ ì™„ë£Œ: ${e.channelId} (${e.category}/${e.subCategory})`),t()},r.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:",r.error),s(r.error)}})}async getClassificationLogs(e){return this.db||await this.init(),new Promise((t,s)=>{const n=this.db.transaction(["classificationLogs"],"readonly").objectStore("classificationLogs").index("channelId").getAll(e);n.onsuccess=()=>{const i=n.result;i.sort((c,l)=>new Date(l.effectiveDate).getTime()-new Date(c.effectiveDate).getTime()),t(i)},n.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë¡œê·¸ ì¡°íšŒ ì‹¤íŒ¨:",n.error),s(n.error)}})}async getClassificationAtDate(e,t){return this.db||await this.init(),new Promise((s,a)=>{const i=this.db.transaction(["classificationLogs"],"readonly").objectStore("classificationLogs").index("channelId").getAll(e);i.onsuccess=()=>{const c=i.result,l=new Date(t),d=c.filter(u=>new Date(u.effectiveDate)<=l);d.sort((u,f)=>new Date(f.effectiveDate).getTime()-new Date(u.effectiveDate).getTime()),s(d.length>0?d[0]:null)},i.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë¡œê·¸ ì¡°íšŒ ì‹¤íŒ¨:",i.error),a(i.error)}})}async getChannelCategory(e,t){return this.db||await this.init(),new Promise((s,a)=>{const i=this.db.transaction(["classificationLogs"],"readonly").objectStore("classificationLogs").index("channelId").getAll(e);i.onsuccess=()=>{const l=i.result,d=new Date(t),u=l.filter(h=>new Date(h.effectiveDate)<=d);u.sort((h,g)=>new Date(g.effectiveDate).getTime()-new Date(h.effectiveDate).getTime());const f=u.length>0?u[0]:null;s(f?{category:f.category,subCategory:f.subCategory}:null)},i.onerror=()=>{console.error("âŒ ì±„ë„ ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ì‹¤íŒ¨:",i.error),a(i.error)}})}async loadClassifiedData(){return this.db||await this.init(),new Promise((e,t)=>{const o=this.db.transaction(["classifiedData"],"readonly").objectStore("classifiedData").getAll();o.onsuccess=()=>e(o.result),o.onerror=()=>t(o.error)})}async updateClassifiedDataByDate(e,t){return this.db||await this.init(),console.log(`ğŸ’¾ IndexedDB ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ - ${t}:`,e.length,"ê°œ"),new Promise((s,a)=>{const r=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData"),n=r.getAll();n.onsuccess=()=>{const i=n.result;console.log(`ğŸ“Š IndexedDB ì „ì²´ ë¶„ë¥˜ ë°ì´í„°: ${i.length}ê°œ`);const c=i.filter(u=>(u.dayKeyLocal||u.collectionDate||u.uploadDate||"").split("T")[0]!==t);console.log(`ğŸ“Š ë‹¤ë¥¸ ë‚ ì§œ ë¶„ë¥˜ ë°ì´í„°: ${c.length}ê°œ`);const l=[...c,...e];console.log(`ğŸ“Š ë³‘í•© ë¶„ë¥˜ ë°ì´í„°: ${l.length}ê°œ (ë‹¤ë¥¸ ë‚ ì§œ: ${c.length} + ìƒˆ ë‚ ì§œ: ${e.length})`);const d=r.clear();d.onsuccess=()=>{console.log("ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ ì™„ë£Œ, ë³‘í•© ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹œì‘");let u=0;const f=l.length;if(f===0){console.log(`âœ… ${t} ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ë°ì´í„° ì—†ìŒ`),s();return}l.forEach((h,g)=>{h.id||(h.id=Date.now()+g);const y=r.put(h);y.onsuccess=()=>{u++,u===f&&(console.log(`âœ… ${t} ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${e.length}ê°œ ì¶”ê°€/ìˆ˜ì •, ì „ì²´ ${l.length}ê°œ ìœ ì§€`),s())},y.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",y.error),a(y.error)}})},d.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",d.error),a(d.error)}},n.onerror=()=>{console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",n.error),a(n.error)}})}async updateUnclassifiedData(e){return this.db||await this.init(),console.log("ğŸ’¾ IndexedDB ì—…ë°ì´íŠ¸ - unclassifiedData:",e.length,"ê°œ"),console.log("ğŸ’¾ ë°ì´í„° ìƒ˜í”Œ (ì¹´í…Œê³ ë¦¬/ì„¸ë¶€ì¹´í…Œê³ ë¦¬):",e.slice(0,3).map(t=>({category:t.category,subCategory:t.subCategory,channelName:t.channelName}))),new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData");let r=0;const n=e.length;if(n===0){t();return}e.forEach((i,c)=>{i.id||(i.id=Date.now()+c);const l=o.put(i);l.onsuccess=()=>{r++,r===n&&t()},l.onerror=()=>s(l.error)})})}async updateUnclassifiedDataByDate(e,t){return this.db||await this.init(),console.log(`ğŸ’¾ IndexedDB ë‚ ì§œë³„ ì—…ë°ì´íŠ¸ - ${t}:`,e.length,"ê°œ"),console.log("ğŸ’¾ ë°ì´í„° ìƒ˜í”Œ (ì¹´í…Œê³ ë¦¬/ì„¸ë¶€ì¹´í…Œê³ ë¦¬):",e.slice(0,3).map(s=>({category:s.category,subCategory:s.subCategory,channelName:s.channelName}))),new Promise((s,a)=>{const r=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),n=r.getAll();n.onsuccess=()=>{const i=n.result;console.log(`ğŸ“Š IndexedDB ì „ì²´ ë°ì´í„°: ${i.length}ê°œ`);const c=i.filter(u=>(u.dayKeyLocal||u.collectionDate||u.uploadDate||"").split("T")[0]!==t);console.log(`ğŸ“Š ë‹¤ë¥¸ ë‚ ì§œ ë°ì´í„°: ${c.length}ê°œ`);const l=[...c,...e];console.log(`ğŸ“Š ë³‘í•© ë°ì´í„°: ${l.length}ê°œ (ë‹¤ë¥¸ ë‚ ì§œ: ${c.length} + ìƒˆ ë‚ ì§œ: ${e.length})`);const d=r.clear();d.onsuccess=()=>{console.log("ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ ì™„ë£Œ, ë³‘í•© ë°ì´í„° ì €ì¥ ì‹œì‘");let u=0;const f=l.length;if(f===0){console.log(`âœ… ${t} ë‚ ì§œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ë°ì´í„° ì—†ìŒ`),s();return}l.forEach((h,g)=>{h.id||(h.id=Date.now()+g);const y=r.put(h);y.onsuccess=()=>{u++,u===f&&(console.log(`âœ… ${t} ë‚ ì§œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${e.length}ê°œ ì¶”ê°€/ìˆ˜ì •, ì „ì²´ ${l.length}ê°œ ìœ ì§€`),s())},y.onerror=()=>{console.error("âŒ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",y.error),a(y.error)}})},d.onerror=()=>{console.error("âŒ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",d.error),a(d.error)}},n.onerror=()=>{console.error("âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",n.error),a(n.error)}})}async updateClassifiedData(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData");let r=0;const n=e.length;if(n===0){t();return}e.forEach((i,c)=>{i.id||(i.id=Date.now()+c);const l=o.put(i);l.onsuccess=()=>{r++,r===n&&t()},l.onerror=()=>s(l.error)})})}async saveChannels(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["channels"],"readwrite").objectStore("channels"),r=o.clear();r.onsuccess=()=>{const n=Object.entries(e);let i=0;const c=n.length;if(c===0){t();return}n.forEach(([l,d])=>{const u=o.put({id:l,...d});u.onsuccess=()=>{i++,i===c&&t()},u.onerror=()=>s(u.error)})},r.onerror=()=>s(r.error)})}async saveVideos(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["videos"],"readwrite").objectStore("videos"),r=o.clear();r.onsuccess=()=>{const n=Object.entries(e);let i=0;const c=n.length;if(c===0){t();return}n.forEach(([l,d])=>{Array.isArray(d)&&d.forEach(u=>{const f=o.put({...u,channelId:l});f.onsuccess=()=>{i++,i===c&&t()},f.onerror=()=>s(f.error)})})},r.onerror=()=>s(r.error)})}async saveCategories(e){this.db||await this.init();const t=L(e)||{};return new Promise((s,a)=>{const r=this.db.transaction(["subCategories"],"readwrite").objectStore("subCategories"),n=r.clear();n.onsuccess=()=>{const i=r.put({id:1,type:"categories",data:t,timestamp:new Date().toISOString()});i.onsuccess=()=>{console.log("âœ… ì¹´í…Œê³ ë¦¬ ì €ì¥ ì™„ë£Œ:",t),s()},i.onerror=c=>{console.error("âŒ ì¹´í…Œê³ ë¦¬ ì €ì¥ ì‹¤íŒ¨:",c),a(i.error)}},n.onerror=i=>{console.error("âŒ ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨:",i),a(n.error)}})}async loadCategories(){return this.db||await this.init(),new Promise((e,t)=>{const o=this.db.transaction(["subCategories"],"readonly").objectStore("subCategories").getAll();o.onsuccess=()=>{const n=o.result.filter(f=>f.type==="categories").sort((f,h)=>new Date(h.timestamp).getTime()-new Date(f.timestamp).getTime())[0],i=(n==null?void 0:n.data)||null,c=L(i),l=K(c);if(!i){e(l);return}const d=JSON.stringify(i),u=JSON.stringify(l);d!==u&&(console.log("ğŸ”„ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ê°±ì‹  ê°ì§€ - ìµœì‹  ê¸°ë³¸ê°’ìœ¼ë¡œ ë™ê¸°í™”í•©ë‹ˆë‹¤."),this.saveCategories(l).catch(f=>{console.warn("âš ï¸ ì¹´í…Œê³ ë¦¬ ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜:",f)})),e(l)},o.onerror=()=>t(o.error)})}async saveDailyProgress(e){this.db||await this.init(),console.log("ğŸ” saveDailyProgress í˜¸ì¶œë¨ - ë§¤ê°œë³€ìˆ˜:",typeof e,e);let t=[];if(Array.isArray(e))t=e.filter(s=>s&&typeof s=="object"),console.log("ğŸ” ë°°ì—´ë¡œ ì²˜ë¦¬ë¨:",t.length,"ê°œ í•­ëª©");else if(e&&typeof e=="object")t=[e],console.log("ğŸ” ê°ì²´ë¡œ ì²˜ë¦¬ë¨:",t[0]);else return console.error("âŒ saveDailyProgress: ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„° íƒ€ì…:",typeof e,e),Promise.resolve();return new Promise((s,a)=>{const r=this.db.transaction(["dailyProgress"],"readwrite").objectStore("dailyProgress"),n=r.clear();n.onsuccess=()=>{let i=0;const c=t.length;if(c===0){s();return}t.forEach((l,d)=>{const u={...l};u.id||(u.id=Date.now()+d);const f=r.put(u);f.onsuccess=()=>{i++,i===c&&s()},f.onerror=()=>a(f.error)})},n.onerror=()=>a(n.error)})}async saveSubCategories(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["subCategories"],"readwrite").objectStore("subCategories"),r=o.clear();r.onsuccess=()=>{const n=Object.entries(e);let i=0;const c=n.length;if(c===0){t();return}n.forEach(([l,d])=>{Array.isArray(d)&&d.forEach(u=>{const f=o.put({category:l,subCategory:u});f.onsuccess=()=>{i++,i===c&&t()},f.onerror=()=>s(f.error)})})},r.onerror=()=>s(r.error)})}async loadSubCategories(){return this.db||await this.init(),new Promise((e,t)=>{const s={},r=this.db.transaction(["subCategories"],"readonly").objectStore("subCategories").getAll();r.onsuccess=()=>{(r.result||[]).forEach(i=>{const c=i.category,l=i.subCategory;!c||!l||(s[c]||(s[c]=[]),s[c].includes(l)||s[c].push(l))}),e(s)},r.onerror=()=>t(r.error)})}async saveSystemConfig(e,t){return this.db||await this.init(),new Promise((s,a)=>{const n=this.db.transaction(["systemConfig"],"readwrite").objectStore("systemConfig").put({key:e,value:t});n.onsuccess=()=>s(),n.onerror=()=>a(n.error)})}async loadSystemConfig(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction(["systemConfig"],"readonly").objectStore("systemConfig").get(e);r.onsuccess=()=>{var n;return t((n=r.result)==null?void 0:n.value)},r.onerror=()=>s(r.error)})}async clearDatabase(){return new Promise((e,t)=>{try{const s=indexedDB.deleteDatabase(this.dbName);s.onsuccess=()=>{this.db=null,console.log("âœ… IndexedDB ì‚­ì œ ì™„ë£Œ"),this.clearAssociatedCache().then(()=>{console.log("âœ… ì—°ê´€ ìºì‹œ ì‚­ì œ ì™„ë£Œ"),e()}).catch(a=>{console.warn("âš ï¸ ìºì‹œ ì‚­ì œ ì‹¤íŒ¨ (IndexedDBëŠ” ì‚­ì œë¨):",a),e()})},s.onerror=()=>t(s.error)}catch(s){t(s)}})}async clearAssociatedCache(){const{CacheCleanup:e}=await N(async()=>{const{CacheCleanup:t}=await import("./index.ClCJK6km.js").then(s=>s.c);return{CacheCleanup:t}},__vite__mapDeps([0,1,2,3,4,5]));await e.clearAssociatedCache()}async saveDailySummary(e,t){return this.db||await this.init(),new Promise((s,a)=>{const r=this.db.transaction(["dailySummary"],"readwrite").objectStore("dailySummary"),n={date:e};t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).forEach(c=>{c!=="date"&&(n[c]=t[c])}),console.log("ğŸ’¾ saveDailySummary í˜¸ì¶œ:",{date:e,summaryKeys:t?Object.keys(t):[],dataToSaveKeys:Object.keys(n)});const i=r.put(n);i.onsuccess=()=>{console.log("âœ… dailySummary ì €ì¥ ì„±ê³µ:",e),s()},i.onerror=()=>{console.error("âŒ dailySummary ì €ì¥ ì‹¤íŒ¨:",i.error,{date:e,dataToSave:n}),a(i.error)}})}async loadDailySummary(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction(["dailySummary"],"readonly").objectStore("dailySummary").get(e);r.onsuccess=()=>t(r.result||null),r.onerror=()=>s(r.error)})}async saveClassifiedByDate(e,t){return this.db||await this.init(),new Promise((s,a)=>{const n=this.db.transaction(["classifiedByDate"],"readwrite").objectStore("classifiedByDate").put({date:e,items:t});n.onsuccess=()=>s(),n.onerror=()=>a(n.error)})}async loadClassifiedByDate(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction(["classifiedByDate"],"readonly").objectStore("classifiedByDate").get(e);r.onsuccess=()=>{const n=r.result;t((n==null?void 0:n.items)||null)},r.onerror=()=>s(r.error)})}async updateAllCollectionDates(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=o.getAll();r.onsuccess=()=>{const n=r.result;console.log(`ğŸ“Š ì „ì²´ ë°ì´í„°: ${n.length}ê°œ`);const i=n.map(d=>({...d,collectionDate:e}));let c=0,l=0;i.forEach((d,u)=>{const f=o.put(d);f.onsuccess=()=>{c++,c%100===0&&console.log(`âœ… ${c}/${n.length} ì—…ë°ì´íŠ¸ ì™„ë£Œ`),c+l===n.length&&(console.log(`ğŸ‰ ì—…ë°ì´íŠ¸ ì™„ë£Œ! ì´ ${c}ê°œ ë°ì´í„°ë¥¼ ${e}ë¡œ ë³€ê²½`),t(c))},f.onerror=()=>{l++,console.error(`âŒ ${u+1}ë²ˆì§¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`,f.error),c+l===n.length&&(console.log(`âš ï¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${c}ê°œ ì„±ê³µ, ${l}ê°œ ì‹¤íŒ¨`),t(c))}})},r.onerror=()=>{s(r.error)}})}async listClassifiedDates(){return this.db||await this.init(),new Promise((e,t)=>{const o=this.db.transaction(["classifiedByDate"],"readonly").objectStore("classifiedByDate").getAllKeys();o.onsuccess=()=>{const r=o.result||[];e(r)},o.onerror=()=>t(o.error)})}async cleanupOldData(e=E){this.db||await this.init();const t=new Date;t.setDate(t.getDate()-e);const s=t.toISOString().split("T")[0];let a=0;const r=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),n=r.getAll();await new Promise(b=>{n.onsuccess=()=>{n.result.filter(S=>new Date(S.uploadDate)<t).forEach(S=>{r.delete(S.id),a++}),b()}});const c=this.db.transaction(["classifiedData"],"readwrite").objectStore("classifiedData"),l=c.getAll();await new Promise(b=>{l.onsuccess=()=>{l.result.filter(S=>new Date(S.uploadDate)<t).forEach(S=>{c.delete(S.id),a++}),b()}});const u=this.db.transaction(["videos"],"readwrite").objectStore("videos"),f=u.getAll();await new Promise(b=>{f.onsuccess=()=>{f.result.filter(S=>new Date(S.uploadDate)<t).forEach(S=>{u.delete(S.id),a++}),b()}});const g=this.db.transaction(["dailySummary"],"readwrite").objectStore("dailySummary"),y=g.getAll();return await new Promise(b=>{y.onsuccess=()=>{(y.result||[]).forEach(S=>{const w=((S==null?void 0:S.date)||"").toString();w&&w<s&&(g.delete(S.date),a++)}),b()}}),console.log(`ğŸ§¹ ${e}ì¼ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ: ${a}ê°œ ë°ì´í„° ì‚­ì œ`),a}async getDatabaseInfo(){this.db||await this.init();const e={name:this.dbName,version:this.version,objectStores:Array.from(this.db.objectStoreNames),size:0,retentionDays:E,lastCleanup:null};for(const t of e.objectStores){const o=this.db.transaction([t],"readonly").objectStore(t).count();await new Promise(r=>{o.onsuccess=()=>{e.size+=o.result,r()}})}try{const t=await this.loadSystemConfig("retentionDays");typeof t=="number"&&t>0&&(e.retentionDays=t)}catch{}return e}async deleteUnclassifiedDataByIds(e){return this.db||await this.init(),new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData");let r=0;const n=e.length;if(n===0){t();return}e.forEach(i=>{const c=o.delete(i);c.onsuccess=()=>{r++,r===n&&(console.log(`âœ… IndexedDBì—ì„œ ${n}ê°œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ`),t())},c.onerror=()=>{console.error(`âŒ ID ${i} ì‚­ì œ ì‹¤íŒ¨:`,c.error),s(c.error)}})})}async deleteDataByDate(e){return this.db||await this.init(),console.log(`ğŸ—‘ï¸ ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì‹œì‘...`),new Promise((t,s)=>{const a=this.db.transaction(["unclassifiedData","classifiedData"],"readwrite"),o=a.objectStore("unclassifiedData"),r=a.objectStore("classifiedData");let n=!1,i=!1,c=0;const l=()=>{n&&i&&(console.log(`âœ… ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ: ${c}ê°œ ì‚­ì œ`),t())},d=o.getAll();d.onsuccess=()=>{const h=d.result.filter(g=>{const y=g.collectionDate||g.uploadDate;return y&&y.split("T")[0]===e});if(console.log(`ğŸ“Š unclassifiedDataì—ì„œ ì‚­ì œí•  ë°ì´í„°: ${h.length}ê°œ`),h.length===0)n=!0,l();else{let g=0;h.forEach(y=>{const b=o.delete(y.id);b.onsuccess=()=>{g++,c++,g===h.length&&(n=!0,l())},b.onerror=()=>s(b.error)})}};const u=r.getAll();u.onsuccess=()=>{const h=u.result.filter(g=>{const y=g.collectionDate||g.uploadDate;return y&&y.split("T")[0]===e});if(console.log(`ğŸ“Š classifiedDataì—ì„œ ì‚­ì œí•  ë°ì´í„°: ${h.length}ê°œ`),h.length===0)i=!0,l();else{let g=0;h.forEach(y=>{const b=r.delete(y.id);b.onsuccess=()=>{g++,c++,g===h.length&&(i=!0,l())},b.onerror=()=>s(b.error)})}},d.onerror=()=>s(d.error),u.onerror=()=>s(u.error)})}async idempotentUpsertUnclassifiedData(e){if(!this.db)throw new Error("Database not initialized");return new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=o.index("videoDay");let n=0,i=0,c=0;const l=e.length;if(l===0){t();return}console.log(`ğŸ”„ IndexedDB ë©±ë“± ë³µì› ì‹œì‘: ${l}ê°œ ë ˆì½”ë“œ`),e.forEach(d=>{if(!d.dayKeyLocal&&d.collectionDate){const h=new Date(d.collectionDate);d.dayKeyLocal=h.toISOString().split("T")[0]}const u=[d.videoId,d.dayKeyLocal],f=r.get(u);f.onsuccess=()=>{if(f.result){const h=f.result,g={...h,viewCount:Math.max(h.viewCount||0,d.viewCount||0),likeCount:Math.max(h.likeCount||0,d.likeCount||0),channelName:d.channelName||h.channelName,videoTitle:d.videoTitle||h.videoTitle,videoDescription:d.videoDescription||h.videoDescription,thumbnailUrl:d.thumbnailUrl||h.thumbnailUrl,category:d.category||h.category,subCategory:d.subCategory||h.subCategory,status:d.status||h.status,updatedAt:new Date().toISOString()},y=o.put(g);y.onsuccess=()=>{i++,n++,n===l&&(console.log(`âœ… IndexedDB ë©±ë“± ë³µì› ì™„ë£Œ: ë³‘í•© ${i}ê°œ, ì‹ ê·œ ${c}ê°œ`),t())},y.onerror=()=>{console.error("IndexedDB ë³‘í•© ì‹¤íŒ¨:",y.error),n++,n===l&&t()}}else{const h={...d,id:d.id||Date.now().toString()+Math.random().toString(36).substr(2,9),createdAt:d.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()},g=o.put(h);g.onsuccess=()=>{c++,n++,n===l&&(console.log(`âœ… IndexedDB ë©±ë“± ë³µì› ì™„ë£Œ: ë³‘í•© ${i}ê°œ, ì‹ ê·œ ${c}ê°œ`),t())},g.onerror=()=>{console.error("IndexedDB ì¶”ê°€ ì‹¤íŒ¨:",g.error),n++,n===l&&t()}}},f.onerror=()=>{console.error("IndexedDB ì¡°íšŒ ì‹¤íŒ¨:",f.error),n++,n===l&&t()}})})}async upsertUnclassifiedDataWithMaxValues(e){if(!this.db)throw new Error("Database not initialized");return new Promise((t,s)=>{const o=this.db.transaction(["unclassifiedData"],"readwrite").objectStore("unclassifiedData"),r=o.index("videoDay");let n=0;const i=e.length;if(i===0){t();return}e.forEach(c=>{if(!c.dayKeyLocal&&c.collectionDate){const u=new Date(c.collectionDate);c.dayKeyLocal=u.toISOString().split("T")[0]}const l=[c.videoId,c.dayKeyLocal],d=r.get(l);d.onsuccess=()=>{if(d.result){const u=d.result,f={...u,viewCount:Math.max(u.viewCount||0,c.viewCount||0),likeCount:Math.max(u.likeCount||0,c.likeCount||0),channelName:c.channelName||u.channelName,videoTitle:c.videoTitle||u.videoTitle,videoDescription:c.videoDescription||u.videoDescription,thumbnailUrl:c.thumbnailUrl||u.thumbnailUrl,category:c.category||u.category,subCategory:c.subCategory||u.subCategory,status:c.status||u.status,updatedAt:new Date().toISOString()},h=o.put(f);h.onsuccess=()=>{n++,n===i&&t()},h.onerror=()=>s(h.error)}else{c.id||(c.id=`${Date.now()}_${Math.random().toString(36).substr(2,9)}`);const u=o.put(c);u.onsuccess=()=>{n++,n===i&&t()},u.onerror=()=>s(u.error)}},d.onerror=()=>s(d.error)})})}async saveBackupDirectoryHandle(e){return this.db||await this.init(),!this.db||!this.db.objectStoreNames.contains("backupSettings")?(console.warn("ğŸ“ backupSettings ì €ì¥ì†Œê°€ ì—†ì–´ ë°±ì—… í´ë”ë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."),Promise.resolve()):new Promise((t,s)=>{try{const r=this.db.transaction(["backupSettings"],"readwrite").objectStore("backupSettings").put({key:"backupDirectory",handle:e});r.onsuccess=()=>t(),r.onerror=()=>s(r.error)}catch(a){s(a)}})}async getBackupDirectoryHandle(){return this.db||await this.init(),!this.db||!this.db.objectStoreNames.contains("backupSettings")?(console.warn("ğŸ“ backupSettings ì €ì¥ì†Œê°€ ì—†ì–´ ê¸°ì¡´ ë°±ì—… í´ë”ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),null):new Promise((e,t)=>{try{const o=this.db.transaction(["backupSettings"],"readonly").objectStore("backupSettings").get("backupDirectory");o.onsuccess=()=>{var r;e(((r=o.result)==null?void 0:r.handle)??null)},o.onerror=()=>t(o.error)}catch(s){t(s)}})}async clearBackupDirectoryHandle(){return this.db||await this.init(),!this.db||!this.db.objectStoreNames.contains("backupSettings")?(console.warn("ğŸ“ backupSettings ì €ì¥ì†Œê°€ ì—†ì–´ ì´ˆê¸°í™”í•  ë°±ì—… í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤."),Promise.resolve()):new Promise((e,t)=>{try{const o=this.db.transaction(["backupSettings"],"readwrite").objectStore("backupSettings").delete("backupDirectory");o.onsuccess=()=>e(),o.onerror=()=>t(o.error)}catch(s){t(s)}})}getDBInstance(){return this.db}}const D=new V,te=Object.freeze(Object.defineProperty({__proto__:null,indexedDBService:D},Symbol.toStringTag,{value:"Module"}));class z{constructor(e="YouTubePulseDB",t="unclassifiedData"){v(this,"dbName");v(this,"storeName");v(this,"version",12);v(this,"db",null);this.dbName=e,this.storeName=t}async initDB(){if(this.db&&this.db.readyState==="open"){console.log("âœ… IndexedDB ì´ë¯¸ ì—°ê²°ë¨");return}console.log("ğŸ”„ HybridDBService IndexedDB ì—°ê²° í™•ì¸...");try{await D.init();const e=D.getDBInstance();if(e&&e.readyState==="open"){this.db=e,console.log("âœ… HybridDBService IndexedDB ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©");return}}catch(e){console.warn("âš ï¸ HybridDBServiceì—ì„œ indexedDBService.init() ì‹¤í–‰ ì¤‘ ê²½ê³ :",e)}return new Promise((e,t)=>{const s=setTimeout(()=>{console.error("âŒ IndexedDB ì—°ê²° íƒ€ì„ì•„ì›ƒ"),t(new Error("IndexedDB ì—°ê²° íƒ€ì„ì•„ì›ƒ"))},1e4),a=indexedDB.open(this.dbName,this.version);a.onupgradeneeded=o=>{console.log("ğŸ”„ HybridDBService: unexpected onupgradeneeded (version mismatch)")},a.onsuccess=()=>{clearTimeout(s),this.db=a.result,console.log("âœ… HybridDBService IndexedDB ì—°ê²° ì™„ë£Œ"),e()},a.onerror=()=>{clearTimeout(s),console.error("âŒ HybridDBService IndexedDB ì—°ê²° ì‹¤íŒ¨:",a.error),t(a.error)}})}async saveDataInBatches(e,t=500){if(!e||e.length===0){console.log("ğŸ“­ ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");return}console.log(`ğŸ’¾ ë°°ì¹˜ ì €ì¥ ì‹œì‘: ${e.length}ê°œ ë°ì´í„°ë¥¼ ${t}ê°œì”© ì²˜ë¦¬`),await this.initDB();for(let s=0;s<e.length;s+=t){const a=e.slice(s,s+t),o=Math.floor(s/t)+1,r=Math.ceil(e.length/t);console.log(`ğŸ“¦ ë°°ì¹˜ ${o}/${r} ì²˜ë¦¬ ì¤‘... (${a.length}ê°œ)`);let n=!1,i=0;const c=3;for(;!n&&i<c;)try{await this.saveBatch(a),n=!0,console.log(`âœ… ë°°ì¹˜ ${o} ì €ì¥ ì™„ë£Œ`)}catch(l){i++,console.warn(`âš ï¸ ë°°ì¹˜ ${o} ì €ì¥ ì‹¤íŒ¨ (ì‹œë„ ${i}/${c}):`,(l==null?void 0:l.message)||l);const d=(l==null?void 0:l.name)==="AbortError";if((l==null?void 0:l.name)==="InvalidStateError"||(l==null?void 0:l.name)==="TransactionInactiveError")console.warn("ğŸ”„ IndexedDB ì—°ê²° ë¬¸ì œ ë°œìƒ, ì¬ì´ˆê¸°í™” í›„ ì¬ì‹œë„ ì¤‘..."),await this.initDB();else if(d){const f=Math.pow(2,i)*2e3;console.warn(`â³ AbortError ê°ì§€, ${f}ms í›„ ì¬ì‹œë„...`),await new Promise(h=>setTimeout(h,f))}else{const f=Math.pow(2,i)*1e3;console.warn(`â³ ${f}ms í›„ ì¬ì‹œë„...`),await new Promise(h=>setTimeout(h,f))}}n||console.warn(`âš ï¸ ë°°ì¹˜ ${o} ì €ì¥ ì‹¤íŒ¨í–ˆì§€ë§Œ ê³„ì† ì§„í–‰...`)}console.log("âœ… ëª¨ë“  ë°°ì¹˜ ì €ì¥ ì™„ë£Œ")}async saveBatch(e){if(!this.db)throw new Error("IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");const t=new Map;e.forEach(a=>{const o=`${a.videoId}|${a.dayKeyLocal}`;if(t.has(o)){const r=t.get(o);t.set(o,{...r,...a,viewCount:Math.max(r.viewCount||0,a.viewCount||0),likeCount:Math.max(r.likeCount||0,a.likeCount||0)})}else t.set(o,a)});const s=Array.from(t.values());if(console.log(`ğŸ”„ ë°°ì¹˜ ë‚´ ì¤‘ë³µ ì œê±°: ${e.length}ê°œ â†’ ${s.length}ê°œ`),s.length!==0)return new Promise((a,o)=>{const r=this.db.transaction([this.storeName],"readwrite"),n=r.objectStore(this.storeName);let i=0;const c=s.length;let l=!1;s.forEach(d=>{const u=n.put(d);u.onsuccess=()=>{i++,i===c&&!l&&a()},u.onerror=()=>{l=!0,console.warn(`âš ï¸ ì €ì¥ ì‹¤íŒ¨, ê±´ë„ˆëœ€: ${d.videoId}|${d.dayKeyLocal}`,u.error),i++,i===c&&a()}}),r.oncomplete=()=>{l||a()},r.onerror=()=>{console.error("âŒ íŠ¸ëœì­ì…˜ ì˜¤ë¥˜:",r.error),o(r.error)},r.onabort=()=>{console.error("âŒ íŠ¸ëœì­ì…˜ ì¤‘ë‹¨:",r.error),o(r.error)}})}async loadAllData(){return await this.initDB(),new Promise((e,t)=>{if(!this.db){t(new Error("IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"));return}const o=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();o.onsuccess=()=>{console.log(`ğŸ“¥ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${o.result.length}ê°œ`),e(o.result)},o.onerror=()=>{console.error("âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",o.error),t(o.error)}})}async clearData(){return await this.initDB(),new Promise((e,t)=>{if(!this.db){t(new Error("IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"));return}try{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();o.onsuccess=()=>{console.log("ğŸ—‘ï¸ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì™„ë£Œ"),this.clearAssociatedCache().then(()=>{console.log("âœ… ì—°ê´€ ìºì‹œ ì‚­ì œ ì™„ë£Œ"),e()}).catch(r=>{console.warn("âš ï¸ ìºì‹œ ì‚­ì œ ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì‚­ì œë¨):",r),e()})},o.onerror=()=>{console.error("âŒ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:",o.error),t(o.error)}}catch(s){t(s)}})}async clearAssociatedCache(){const{CacheCleanup:e}=await N(async()=>{const{CacheCleanup:t}=await import("./index.ClCJK6km.js").then(s=>s.c);return{CacheCleanup:t}},__vite__mapDeps([0,1,2,3,4,5]));await e.clearAssociatedCache()}async clearDataByDate(e){return await this.initDB(),new Promise((t,s)=>{if(!this.db){s(new Error("IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"));return}const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName),r=o.index("dayKeyLocal"),n=IDBKeyRange.only(e),i=r.getAll(n);i.onsuccess=()=>{const c=i.result;if(console.log(`ğŸ—‘ï¸ ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ëŒ€ìƒ: ${c.length}ê°œ`),c.length===0){console.log(`ğŸ“­ ${e} ë‚ ì§œì— ì‚­ì œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤`),t(0);return}let l=0,d=0;c.forEach((u,f)=>{const h=o.delete(u.id);h.onsuccess=()=>{l++,l+d===c.length&&(console.log(`âœ… ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ: ${l}ê°œ`),t(l))},h.onerror=()=>{d++,console.error(`âŒ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨ (ID: ${u.id}):`,h.error),l+d===c.length&&(console.log(`âš ï¸ ${e} ë‚ ì§œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ: ${l}ê°œ ì„±ê³µ, ${d}ê°œ ì‹¤íŒ¨`),t(l))}})},i.onerror=()=>{console.error("âŒ ë‚ ì§œë³„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",i.error),s(i.error)}})}async replaceDataByDate(e,t){console.log(`ğŸ”„ ${e} ë‚ ì§œ ë°ì´í„° êµì²´ ì‹œì‘: ${t.length}ê°œ`);const s=await this.clearDataByDate(e);return console.log(`ğŸ—‘ï¸ ${e} ë‚ ì§œ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ: ${s}ê°œ`),t.length>0&&(await this.saveDataInBatches(t,500),console.log(`ğŸ’¾ ${e} ë‚ ì§œ ìƒˆ ë°ì´í„° ì €ì¥: ${t.length}ê°œ`)),t.length}isConnected(){return this.db!==null&&this.db.readyState==="open"}close(){this.db&&(this.db.close(),this.db=null,console.log("ğŸ”Œ IndexedDB ì—°ê²° ì¢…ë£Œ"))}}const A=new z;var R,j;const H=((j=(R=import.meta)==null?void 0:R.env)==null?void 0:j.VITE_API_BASE_URL)||"";let O="";if(typeof window<"u")try{O=localStorage.getItem("customApiUrl")||""}catch(p){console.warn("âš ï¸ customApiUrl ë¡œë“œ ì‹¤íŒ¨:",p)}const F="https://api.youthbepulse.com",k=(O||H||F).replace(/\/$/,"");class J{constructor(){v(this,"baseURL");this.baseURL=k}async request(e,t={}){var n,i;if(!this.baseURL)return console.warn("âš ï¸ API_BASE_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ ì„œë²„ ìš”ì²­ì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),{success:!1,error:"API base URL is not configured."};const s=`${this.baseURL}${e}`;if(typeof navigator<"u"&&"onLine"in navigator&&!navigator.onLine)return console.warn("âš ï¸ ì˜¤í”„ë¼ì¸ ìƒíƒœ - ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”"),{success:!1,error:"Network is offline. Please check your internet connection."};let a=null,o=null,r=t.signal;r||(a=new AbortController,r=a.signal,o=setTimeout(()=>{a&&(console.warn("â±ï¸ ìš”ì²­ íƒ€ì„ì•„ì›ƒ (120ì´ˆ) - ì„œë²„ ì‘ë‹µì´ ì§€ì—°ë˜ê³  ìˆìŠµë‹ˆë‹¤"),a.abort())},12e4));try{const{signal:c,...l}=t,d=await fetch(s,{headers:{"Content-Type":"application/json",...l.headers},signal:r,...l});if(o&&clearTimeout(o),!d.ok){let f="";try{const h=await d.json();f=JSON.stringify(h,null,2)}catch{f=`Status: ${d.status}, StatusText: ${d.statusText}`}throw console.error("ğŸš¨ ì„œë²„ ì—ëŸ¬ ìƒì„¸:",{status:d.status,statusText:d.statusText,url:s,details:f,headers:Object.fromEntries(d.headers.entries())}),new Error(`HTTP error! status: ${d.status} - ${f}`)}const u=await d.json();return u&&typeof u=="object"&&"success"in u&&"data"in u?(console.log("ğŸ“¦ ì„œë²„ ì‘ë‹µì´ ì´ë¯¸ í‘œì¤€ í˜•ì‹:",{success:u.success,dataLength:(n=u.data)==null?void 0:n.length}),u):{success:!0,data:u}}catch(c){if(o&&clearTimeout(o),c instanceof Error&&c.name==="AbortError"){const l=(a==null?void 0:a.signal.aborted)&&!((i=t.signal)!=null&&i.aborted),d=l?"Request timeout (120s)":"Request aborted";return console.error("ğŸš¨ API ìš”ì²­ ì¤‘ë‹¨:",{url:s,error:d,reason:c.message||"No reason provided",wasTimeout:l,hasCustomSignal:!!t.signal}),{success:!1,error:d}}return console.error("ğŸš¨ API ìš”ì²­ ì‹¤íŒ¨:",{url:s,error:c instanceof Error?c.message:"Unknown error",errorName:c instanceof Error?c.name:"Unknown",errorStack:c instanceof Error?c.stack:void 0}),{success:!1,error:c instanceof Error?c.message:"Unknown error"}}}async saveChannels(e){return this.request("/api/channels",{method:"POST",body:JSON.stringify({channels:e})})}async getChannels(){return this.request("/api/channels")}async saveVideos(e){return this.request("/api/videos",{method:"POST",body:JSON.stringify({videos:e})})}async getVideos(){return this.request("/api/videos")}async saveClassifiedData(e){return this.request("/api/classified",{method:"POST",body:JSON.stringify(e)})}async getClassifiedData(){return this.request("/api/classified")}async saveUnclassifiedData(e){return this.request("/api/unclassified",{method:"POST",body:JSON.stringify(e)})}async getUnclassifiedData(){return this.request("/api/unclassified")}async getDataIds(){return this.request("/api/data/ids")}async saveSystemConfig(e,t){return this.request("/api/system/config",{method:"POST",body:JSON.stringify({key:e,value:t})})}async getSystemConfig(e){return this.request(`/api/system/config/${e}`)}async saveDailyStats(e,t){return this.request("/api/daily-stats",{method:"POST",body:JSON.stringify({date:e,stats:t})})}async getDailyStats(e){const t=e?`/api/daily-stats/${e}`:"/api/daily-stats";return this.request(t)}async testConnection(){return this.request("/api/health")}async updateVideo(e,t){return this.request(`/api/videos/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async deleteVideo(e){return this.request(`/api/videos/${e}`,{method:"DELETE"})}async deleteVideosBatch(e){return this.request("/api/videos/batch",{method:"DELETE",body:JSON.stringify({ids:e})})}}const m=new J;class Z{constructor(e={}){v(this,"dbName","YouTubePulseOutbox");v(this,"dbVersion",1);v(this,"storeName","outbox");v(this,"config");this.config={maxRetries:3,retryDelay:5e3,batchSize:10,...e}}async initDB(){return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=()=>t(s.error),s.onsuccess=()=>e(s.result),s.onupgradeneeded=a=>{const o=a.target.result;if(!o.objectStoreNames.contains(this.storeName)){const r=o.createObjectStore(this.storeName,{keyPath:"id"});r.createIndex("timestamp","timestamp"),r.createIndex("status","status"),r.createIndex("type","type")}}})}async addToOutbox(e,t,s){const a=`outbox_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:a,type:e,endpoint:t,payload:s,timestamp:Date.now(),retries:0,maxRetries:this.config.maxRetries,status:"pending"};try{const i=(await this.initDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName);return await new Promise((c,l)=>{const d=i.add(o);d.onsuccess=()=>c(),d.onerror=()=>l(d.error)}),console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€: ${e} ${t}`,o),a}catch(r){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",r),r}}async getPendingItems(){try{const a=(await this.initDB()).transaction([this.storeName],"readonly").objectStore(this.storeName).index("status");return new Promise((o,r)=>{const n=a.getAll("pending");n.onsuccess=()=>o(n.result),n.onerror=()=>r(n.error)})}catch(e){return console.error("âŒ ëŒ€ê¸° ì‘ì—… ì¡°íšŒ ì‹¤íŒ¨:",e),[]}}async updateItemStatus(e,t,s){try{const r=(await this.initDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName),n=r.get(e);await new Promise((i,c)=>{n.onsuccess=()=>{const l=n.result;if(l){l.status=t,l.error=s,t==="failed"&&(l.retries+=1);const d=r.put(l);d.onsuccess=()=>i(),d.onerror=()=>c(d.error)}else c(new Error("Item not found"))},n.onerror=()=>c(n.error)}),console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸: ${e} â†’ ${t}`)}catch(a){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",a),a}}async removeCompletedItems(){try{const s=(await this.initDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName),a=s.index("status");await new Promise((o,r)=>{const n=a.getAllKeys("completed");n.onsuccess=()=>{const i=n.result;if(i.length===0){o();return}let c=0;i.forEach(l=>{const d=s.delete(l);d.onsuccess=()=>{c++,c===i.length&&o()},d.onerror=()=>r(d.error)})},n.onerror=()=>r(n.error)}),console.log("ğŸ—‘ï¸ ì™„ë£Œëœ ì•„ì›ƒë°•ìŠ¤ ì‘ì—… ì œê±° ì™„ë£Œ")}catch(e){console.error("âŒ ì™„ë£Œëœ ì‘ì—… ì œê±° ì‹¤íŒ¨:",e)}}async processOutbox(){const e=await this.getPendingItems();if(e.length===0)return{success:0,failed:0};console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì²˜ë¦¬ ì‹œì‘: ${e.length}ê°œ ì‘ì—…`);let t=0,s=0;for(let a=0;a<e.length;a+=this.config.batchSize){const o=e.slice(a,a+this.config.batchSize);await Promise.allSettled(o.map(async r=>{try{if(r.retries>=r.maxRetries){await this.updateItemStatus(r.id,"failed","Max retries exceeded"),s++;return}const n=await fetch(r.endpoint,{method:r.type==="update"?"PATCH":r.type==="delete"?"DELETE":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.payload)});if(n.ok)await this.updateItemStatus(r.id,"completed"),t++,console.log(`âœ… ì•„ì›ƒë°•ìŠ¤ ì‘ì—… ì„±ê³µ: ${r.type} ${r.endpoint}`);else throw new Error(`HTTP ${n.status}: ${n.statusText}`)}catch(n){console.error(`âŒ ì•„ì›ƒë°•ìŠ¤ ì‘ì—… ì‹¤íŒ¨: ${r.type} ${r.endpoint}`,n),await this.updateItemStatus(r.id,"failed",n instanceof Error?n.message:"Unknown error"),s++}})),a+this.config.batchSize<e.length&&await new Promise(r=>setTimeout(r,1e3))}return await this.removeCompletedItems(),console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì²˜ë¦¬ ì™„ë£Œ: ì„±ê³µ ${t}ê°œ, ì‹¤íŒ¨ ${s}ê°œ`),{success:t,failed:s}}startAutoProcess(){navigator.onLine&&setTimeout(()=>this.processOutbox(),2e3),window.addEventListener("online",()=>{console.log("ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœ ê°ì§€ - ì•„ì›ƒë°•ìŠ¤ ì²˜ë¦¬ ì‹œì‘"),setTimeout(()=>this.processOutbox(),1e3)}),setInterval(()=>{navigator.onLine&&this.processOutbox()},5*60*1e3)}async getStats(){try{const s=(await this.initDB()).transaction([this.storeName],"readonly").objectStore(this.storeName),a=await new Promise((o,r)=>{const n=s.getAll();n.onsuccess=()=>o(n.result),n.onerror=()=>r(n.error)});return{pending:a.filter(o=>o.status==="pending").length,failed:a.filter(o=>o.status==="failed").length,completed:a.filter(o=>o.status==="completed").length}}catch(e){return console.error("âŒ ì•„ì›ƒë°•ìŠ¤ í†µê³„ ì¡°íšŒ ì‹¤íŒ¨:",e),{pending:0,failed:0,completed:0}}}}const B=new Z;class X{constructor(){v(this,"config");const e=typeof window<"u"&&window.electronAPI!==void 0,t=!!k,s=t&&!e;this.config={useApiServer:s,fallbackToLocal:!0},s?(console.log("ğŸŒ í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ í™œì„±í™”: ì„œë²„ API + IndexedDB"),console.log(`ğŸ“¡ API_BASE_URL: ${k}`)):t?e&&console.log("ğŸ–¥ï¸ Electron í™˜ê²½: ì„œë²„ API ë¹„í™œì„±í™”, IndexedDB ì „ìš© ëª¨ë“œ"):console.log("âš ï¸ API_BASE_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ IndexedDB í´ë°± ëª¨ë“œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.")}updateConfig(e){this.config={...this.config,...e}}async bootstrapSync(){try{console.log("ğŸ”„ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë™ê¸°í™” ì‹œì‘ - ì°¨ë¶„ ì—…ë¡œë“œ ë°©ì‹...");const[e,t]=await Promise.all([D.loadUnclassifiedData(),D.loadClassifiedData()]),s=((e==null?void 0:e.length)||0)+((t==null?void 0:t.length)||0);if(console.log(`ğŸ“Š ë¡œì»¬ ë°ì´í„°: ë¯¸ë¶„ë¥˜ ${(e==null?void 0:e.length)||0}ê°œ, ë¶„ë¥˜ ${(t==null?void 0:t.length)||0}ê°œ, ì´ ${s}ê°œ`),s===0)return{success:!0,uploaded:0,message:"ì—…ë¡œë“œí•  ë¡œì»¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."};console.log("ğŸ” ì„œë²„ ë°ì´í„° ID ëª©ë¡ ì¡°íšŒ ì¤‘...");const a=await m.getDataIds();let o=new Set,r=new Set;a.success&&a.data?(o=new Set(a.data.unclassifiedIds),r=new Set(a.data.classifiedIds),console.log(`ğŸ“Š ì„œë²„ ê¸°ì¡´ ë°ì´í„°: ë¯¸ë¶„ë¥˜ ${o.size}ê°œ, ë¶„ë¥˜ ${r.size}ê°œ`)):console.log("âš ï¸ ì„œë²„ ë°ì´í„° ID ì¡°íšŒ ì‹¤íŒ¨, ì „ì²´ ì—…ë¡œë“œ ì§„í–‰");const n=(e==null?void 0:e.filter(u=>!o.has(String(u.id))))||[],i=(t==null?void 0:t.filter(u=>!r.has(String(u.id))))||[],c=n.length+i.length;if(console.log(`ğŸ“Š ì°¨ë¶„ ê³„ì‚° ê²°ê³¼: ìƒˆë¡œìš´ ë°ì´í„° ${c}ê°œ (ë¯¸ë¶„ë¥˜: ${n.length}ê°œ, ë¶„ë¥˜: ${i.length}ê°œ)`),console.log(`ğŸ“Š ì¤‘ë³µ ì œì™¸: ë¯¸ë¶„ë¥˜ ${((e==null?void 0:e.length)||0)-n.length}ê°œ, ë¶„ë¥˜ ${((t==null?void 0:t.length)||0)-i.length}ê°œ`),c===0)return{success:!0,uploaded:0,message:"ì„œë²„ì— ì´ë¯¸ ëª¨ë“  ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ì—…ë¡œë“œí•  ìƒˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."};let l=0;const d=500;if(n&&n.length>0){console.log(`ğŸ“¤ ìƒˆë¡œìš´ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—…ë¡œë“œ ì‹œì‘: ${n.length}ê°œ`);for(let u=0;u<n.length;u+=d){const f=n.slice(u,u+d),h=Math.floor(u/d)+1,g=Math.ceil(n.length/d);console.log(`ğŸ“¦ ë¯¸ë¶„ë¥˜ ì²­í¬ ${h}/${g} ì—…ë¡œë“œ ì¤‘... (${f.length}ê°œ)`);try{const y=await m.saveUnclassifiedData(f);y.success?(l+=f.length,console.log(`âœ… ë¯¸ë¶„ë¥˜ ì²­í¬ ${h}/${g} ì—…ë¡œë“œ ì™„ë£Œ`)):console.error(`âŒ ë¯¸ë¶„ë¥˜ ì²­í¬ ${h} ì—…ë¡œë“œ ì‹¤íŒ¨:`,y.error),u+d<e.length&&await new Promise(b=>setTimeout(b,300))}catch(y){console.error(`âŒ ë¯¸ë¶„ë¥˜ ì²­í¬ ${h} ì—…ë¡œë“œ ì˜¤ë¥˜:`,y),console.log(`ğŸ”„ ì²­í¬ ${h} ì¬ì‹œë„ ì¤‘...`);try{(await m.saveUnclassifiedData(f)).success&&(l+=f.length,console.log(`âœ… ë¯¸ë¶„ë¥˜ ì²­í¬ ${h} ì¬ì‹œë„ ì„±ê³µ`))}catch{console.error(`âŒ ì²­í¬ ${h} ì¬ì‹œë„ ì‹¤íŒ¨, ê±´ë„ˆëœ€`)}}}console.log(`âœ… ë¯¸ë¶„ë¥˜ ë°ì´í„° ì „ì²´ ì—…ë¡œë“œ ì™„ë£Œ: ${l}ê°œ`)}if(i&&i.length>0){console.log(`ğŸ“¤ ìƒˆë¡œìš´ ë¶„ë¥˜ ë°ì´í„° ì—…ë¡œë“œ ì‹œì‘: ${i.length}ê°œ`);for(let u=0;u<i.length;u+=d){const f=i.slice(u,u+d),h=Math.floor(u/d)+1,g=Math.ceil(i.length/d);console.log(`ğŸ“¦ ë¶„ë¥˜ ì²­í¬ ${h}/${g} ì—…ë¡œë“œ ì¤‘... (${f.length}ê°œ)`);try{const y=await m.saveClassifiedData(f);y.success?(l+=f.length,console.log(`âœ… ë¶„ë¥˜ ì²­í¬ ${h}/${g} ì—…ë¡œë“œ ì™„ë£Œ`)):console.error(`âŒ ë¶„ë¥˜ ì²­í¬ ${h} ì—…ë¡œë“œ ì‹¤íŒ¨:`,y.error),u+d<t.length&&await new Promise(b=>setTimeout(b,300))}catch(y){console.error(`âŒ ë¶„ë¥˜ ì²­í¬ ${h} ì—…ë¡œë“œ ì˜¤ë¥˜:`,y),console.log(`ğŸ”„ ì²­í¬ ${h} ì¬ì‹œë„ ì¤‘...`);try{(await m.saveClassifiedData(f)).success&&(l+=f.length,console.log(`âœ… ë¶„ë¥˜ ì²­í¬ ${h} ì¬ì‹œë„ ì„±ê³µ`))}catch{console.error(`âŒ ì²­í¬ ${h} ì¬ì‹œë„ ì‹¤íŒ¨, ê±´ë„ˆëœ€`)}}}console.log("âœ… ë¶„ë¥˜ ë°ì´í„° ì „ì²´ ì—…ë¡œë“œ ì™„ë£Œ")}console.log("ğŸ”„ ì„œë²„ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ë¡œì»¬ ìºì‹œ ê°±ì‹  ì¤‘...");try{const[u,f]=await Promise.all([this.loadUnclassifiedData(),this.getClassifiedData()]);console.log(`âœ… ì„œë²„ ìŠ¤ëƒ…ìƒ· ì¬ì ì¬ ì™„ë£Œ: ë¯¸ë¶„ë¥˜ ${(u==null?void 0:u.length)||0}ê°œ, ë¶„ë¥˜ ${(f==null?void 0:f.length)||0}ê°œ`)}catch(u){console.warn("âš ï¸ ìºì‹œ ê°±ì‹  ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì—…ë¡œë“œë¨):",u)}return console.log("âœ… ë¶€íŠ¸ìŠ¤íŠ¸ë© ë™ê¸°í™” ì™„ë£Œ!"),{success:!0,uploaded:l,message:`${l.toLocaleString()}ê°œì˜ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì—…ë¡œë“œí–ˆìŠµë‹ˆë‹¤.

ì¤‘ë³µ ì œì™¸: ${s-c}ê°œ`}}catch(e){return console.error("âŒ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë™ê¸°í™” ì‹¤íŒ¨:",e),{success:!1,uploaded:0,message:`ë™ê¸°í™” ì‹¤íŒ¨: ${e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`}}}async saveChannels(e){try{if(this.config.useApiServer){const t=await m.saveChannels(e);if(t.success)console.log("âœ… API ì„œë²„ì— ì±„ë„ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await A.saveDataInBatches(Object.values(e),500),console.log("âœ… ë¡œì»¬ IndexedDBì— ì±„ë„ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ì±„ë„ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await A.saveDataInBatches(Object.values(e),500),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getChannels(){try{if(this.config.useApiServer){const e=await m.getChannels();if(e.success&&e.data)return console.log("âœ… API ì„œë²„ì—ì„œ ì±„ë„ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ"),e.data}if(this.config.fallbackToLocal){const e=await D.getChannels();return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ì±„ë„ ë°ì´í„° ì¡°íšŒ"),e}return{}}catch(e){return console.error("âŒ ì±„ë„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal?await D.getChannels():{}}}async saveVideos(e){try{if(this.config.useApiServer){const t=await m.saveVideos(e);if(t.success)console.log("âœ… API ì„œë²„ì— ë¹„ë””ì˜¤ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await D.saveVideos(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ë¹„ë””ì˜¤ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ë¹„ë””ì˜¤ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await D.saveVideos(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getVideos(){try{if(this.config.useApiServer){const e=await m.getVideos();if(e.success&&e.data)return console.log("âœ… API ì„œë²„ì—ì„œ ë¹„ë””ì˜¤ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ"),e.data}if(this.config.fallbackToLocal){const e=await D.getVideos();return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ë¹„ë””ì˜¤ ë°ì´í„° ì¡°íšŒ"),e}return{}}catch(e){return console.error("âŒ ë¹„ë””ì˜¤ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal?await D.getVideos():{}}}async adaptiveBatchUpload(e,t,s){var d,u;let n=500,i=0,c=0;const l=[];console.log(`ğŸ“¦ ì–´ëŒ‘í‹°ë¸Œ ë°°ì¹˜ ì—…ë¡œë“œ ì‹œì‘: ${e.length}ê°œ (${s})`);for(let f=0;f<e.length;f+=n){const h=e.slice(f,f+n),g=Math.floor(f/n)+1,y=Math.ceil(e.length/n);console.log(`ğŸ“¦ ë°°ì¹˜ ${g}/${y} ì „ì†¡ ì¤‘... (${h.length}ê°œ, í¬ê¸°: ${n})`);let b=!1,I=0;for(;I<3&&!b;)try{const S=JSON.stringify(h).length,w=((d=h[0])==null?void 0:d.id)||"unknown",C=((u=h[h.length-1])==null?void 0:u.id)||"unknown";console.log("ğŸ“Š ë°°ì¹˜ ìš”ì²­ ì •ë³´:",{batchNum:g,size:h.length,payloadBytes:S,firstId:w,lastId:C,retryAttempt:I+1});const $=await t(h);if($.success)console.log(`âœ… ë°°ì¹˜ ${g} ì „ì†¡ ì™„ë£Œ (ì‹œë„ ${I+1})`),b=!0,i+=h.length,n<1e3&&I===0&&(n=Math.min(n+50,1e3));else throw new Error($.error||"API ì‘ë‹µ ì‹¤íŒ¨")}catch(S){I++;const w=S.message||String(S),C=(w==null?void 0:w.includes("status: 500"))||(w==null?void 0:w.includes("status: 413")),$=(w==null?void 0:w.includes("Database not connected"))||(w==null?void 0:w.includes("Database connection not available"))||(w==null?void 0:w.includes("Database not connected"));if(console.error(`âŒ ë°°ì¹˜ ${g} ì „ì†¡ ì‹¤íŒ¨ (ì‹œë„ ${I}/3):`,{error:w,isServerError:C,isDatabaseError:$,currentBatchSize:n}),$){console.error("ğŸš¨ ì„œë²„ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜ ê°ì§€ - ì¬ì‹œë„í•˜ì§€ ì•Šê³  ì¦‰ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬"),console.error(`ğŸ’€ ë°°ì¹˜ ${g} ë°ë“œë ˆí„° íë¡œ ì´ë™ (ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜):`,h.map(x=>x.id)),l.push(...h),c+=h.length,b=!0;break}if(C&&I<3){n=Math.max(Math.floor(n/2),50),console.log(`ğŸ”„ ë°°ì¹˜ í¬ê¸° ì¶•ì†Œ: ${n}`);const x=Math.pow(2,I-1)*1e3;console.log(`â³ ë°±ì˜¤í”„ ëŒ€ê¸°: ${x}ms`),await new Promise(U=>setTimeout(U,x));const P=h.slice(0,n);P.length<h.length&&e.splice(f+P.length,0,...h.slice(P.length)),h.length=P.length,Object.assign(h,P)}else I>=3&&(console.error(`ğŸ’€ ë°°ì¹˜ ${g} ë°ë“œë ˆí„° íë¡œ ì´ë™:`,h.map(x=>x.id)),l.push(...h),c+=h.length,b=!0)}f+n<e.length&&await new Promise(S=>setTimeout(S,1e3))}return console.log("ğŸ“Š ì–´ëŒ‘í‹°ë¸Œ ë°°ì¹˜ ì—…ë¡œë“œ ì™„ë£Œ:",{success:i,failed:c,deadLetter:l.length,finalBatchSize:n}),{success:i,failed:c,deadLetterItems:l}}async saveClassifiedData(e){try{if(this.config.useApiServer)if(Array.isArray(e)&&e.length>500){const t=await this.adaptiveBatchUpload(e,s=>m.saveClassifiedData(s),"ë¶„ë¥˜ ë°ì´í„°");t.deadLetterItems.length>0&&console.warn(`âš ï¸ ${t.deadLetterItems.length}ê°œ í•­ëª©ì´ ë°ë“œë ˆí„° íë¡œ ì´ë™ë¨`)}else{const t=await m.saveClassifiedData(e);if(t.success)console.log("âœ… API ì„œë²„ì— ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await D.saveClassifiedData(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await D.saveClassifiedData(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getClassifiedData(){try{if(this.config.useApiServer){console.log("ğŸ”„ ì„œë²„ì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹œë„...");const e=await m.getClassifiedData();console.log("ğŸ“¦ ì„œë²„ ì‘ë‹µ:",{isArray:Array.isArray(e),hasSuccess:e&&typeof e=="object"&&"success"in e,success:e&&typeof e=="object"&&"success"in e?e.success:void 0,dataLength:e&&typeof e=="object"&&"data"in e&&Array.isArray(e.data)?e.data.length:void 0,error:e&&typeof e=="object"&&"error"in e?e.error:void 0});const t=Array.isArray(e)?e:e.success&&e.data&&Array.isArray(e.data)?e.data:[];if(t.length>0)return console.log("âœ… API ì„œë²„ì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ:",t.length,"ê°œ"),A.saveDataInBatches(t,500).then(()=>{console.log("âœ… ì•ˆì „í•œ IndexedDB ìºì‹œ ê°±ì‹  ì™„ë£Œ")}).catch(s=>{console.warn("âš ï¸ ì•ˆì „í•œ IndexedDB ìºì‹œ ê°±ì‹  ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì •ìƒ ë°˜í™˜):",s),this.scheduleBackgroundSync()}),t;console.warn("âš ï¸ ì„œë²„ì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì—†ìŒ (ë¹ˆ ë°°ì—´ ë˜ëŠ” ì‹¤íŒ¨)")}if(this.config.fallbackToLocal){console.log("ğŸ”„ IndexedDBì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹œë„...");const e=await A.loadAllData();if(e.length>0)return console.log("âš ï¸ ì•ˆì „í•œ IndexedDBì—ì„œ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ (ì„œë²„ ì—°ê²° ì‹¤íŒ¨):",e.length,"ê°œ"),e;console.warn("âš ï¸ IndexedDBë„ ë¹„ì–´ìˆìŒ - ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‹œë„"),this.scheduleBackgroundSync()}return[]}catch(e){if(console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal){try{const t=await A.loadAllData();if(t.length>0)return console.log("âš ï¸ ì˜¤ë¥˜ ë°œìƒ, ì•ˆì „í•œ IndexedDB í´ë°±:",t.length,"ê°œ"),t}catch(t){console.error("âŒ IndexedDB í´ë°±ë„ ì‹¤íŒ¨:",t)}this.scheduleBackgroundSync()}return[]}}scheduleBackgroundSync(){this.backgroundSyncScheduled||(this.backgroundSyncScheduled=!0,setTimeout(async()=>{try{console.log("ğŸ”„ ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‹œì‘...");const[e,t]=await Promise.allSettled([m.getClassifiedData(),m.getUnclassifiedData()]);let s=0;if(e.status==="fulfilled"){const a=Array.isArray(e.value)?e.value:e.value.success&&e.value.data&&Array.isArray(e.value.data)?e.value.data:[];a.length>0&&(await A.saveDataInBatches(a,500),s+=a.length,console.log("âœ… ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì™„ë£Œ (ë¶„ë¥˜):",a.length,"ê°œ"))}else console.warn("âš ï¸ ë°±ê·¸ë¼ìš´ë“œ ë¶„ë¥˜ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:",e.reason);if(t.status==="fulfilled"){const a=Array.isArray(t.value)?t.value:t.value.success&&t.value.data&&Array.isArray(t.value.data)?t.value.data:[];a.length>0&&(await A.saveDataInBatches(a,500),s+=a.length,console.log("âœ… ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì™„ë£Œ (ë¯¸ë¶„ë¥˜):",a.length,"ê°œ"))}else console.warn("âš ï¸ ë°±ê·¸ë¼ìš´ë“œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:",t.reason);s>0&&console.log("âœ… ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì™„ë£Œ (ì „ì²´):",s,"ê°œ")}catch(e){console.warn("âš ï¸ ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‹¤íŒ¨:",e)}finally{this.backgroundSyncScheduled=!1}},5e3))}async saveUnclassifiedData(e){try{if(this.config.useApiServer)if(Array.isArray(e)&&e.length>500){const t=await this.adaptiveBatchUpload(e,s=>m.saveUnclassifiedData(s),"ë¯¸ë¶„ë¥˜ ë°ì´í„°");t.deadLetterItems.length>0&&console.warn(`âš ï¸ ${t.deadLetterItems.length}ê°œ í•­ëª©ì´ ë°ë“œë ˆí„° íë¡œ ì´ë™ë¨`)}else{const t=await m.saveUnclassifiedData(e);if(t.success)console.log("âœ… API ì„œë²„ì— ë¯¸ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ");else throw new Error(t.error||"API ì €ì¥ ì‹¤íŒ¨")}await D.saveUnclassifiedData(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ë¯¸ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await D.saveUnclassifiedData(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async getUnclassifiedData(){try{if(this.config.useApiServer){console.log("ğŸ”„ ì„œë²„ì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹œë„...");const e=await m.getUnclassifiedData();console.log("ğŸ“¦ ì„œë²„ ì‘ë‹µ (ë¯¸ë¶„ë¥˜):",{isArray:Array.isArray(e),hasSuccess:e&&typeof e=="object"&&"success"in e,success:e&&typeof e=="object"&&"success"in e?e.success:void 0,dataLength:e&&typeof e=="object"&&"data"in e&&Array.isArray(e.data)?e.data.length:void 0,error:e&&typeof e=="object"&&"error"in e?e.error:void 0});const t=Array.isArray(e)?e:e.success&&e.data&&Array.isArray(e.data)?e.data:[];if(t.length>0)return console.log("âœ… API ì„œë²„ì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ:",t.length,"ê°œ"),A.saveDataInBatches(t,500).then(()=>{console.log("âœ… ì•ˆì „í•œ IndexedDB ìºì‹œ ê°±ì‹  ì™„ë£Œ (ë¯¸ë¶„ë¥˜)")}).catch(s=>{console.warn("âš ï¸ ì•ˆì „í•œ IndexedDB ìºì‹œ ê°±ì‹  ì‹¤íŒ¨ (ë°ì´í„°ëŠ” ì •ìƒ ë°˜í™˜):",s),this.scheduleBackgroundSync()}),t;console.warn("âš ï¸ ì„œë²„ì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—†ìŒ (ë¹ˆ ë°°ì—´ ë˜ëŠ” ì‹¤íŒ¨)")}if(this.config.fallbackToLocal){console.log("ğŸ”„ IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹œë„...");const e=await A.loadAllData();if(e.length>0)return console.log("âš ï¸ ì•ˆì „í•œ IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ (ì„œë²„ ì—°ê²° ì‹¤íŒ¨):",e.length,"ê°œ"),e;console.warn("âš ï¸ IndexedDBë„ ë¹„ì–´ìˆìŒ - ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì‹œë„ (ë¯¸ë¶„ë¥˜)"),this.scheduleBackgroundSync()}return[]}catch(e){if(console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",e),console.error("âŒ ì—ëŸ¬ ìƒì„¸:",{message:e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜",stack:e instanceof Error?e.stack:void 0,error:e}),this.config.fallbackToLocal){try{const t=await A.loadAllData();if(t.length>0)return console.log("âš ï¸ ì˜¤ë¥˜ ë°œìƒ, ì•ˆì „í•œ IndexedDB í´ë°± (ë¯¸ë¶„ë¥˜):",t.length,"ê°œ"),t}catch(t){console.error("âŒ IndexedDB í´ë°±ë„ ì‹¤íŒ¨:",t)}this.scheduleBackgroundSync()}return[]}}async loadUnclassifiedData(){try{const e=await A.loadAllData();return console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ì•ˆì „í•œ IndexedDBì—ì„œ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ"),e}catch(e){return console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",e),[]}}async loadUnclassifiedDataByDate(e){try{const t=await D.loadUnclassifiedDataByDate(e);return console.log(`âœ… í•˜ì´ë¸Œë¦¬ë“œ: ${e} ë‚ ì§œ ë°ì´í„° ë¡œë“œ`),t}catch(t){return console.error("âŒ ë‚ ì§œë³„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",t),[]}}async updateUnclassifiedData(e){try{await this.saveUnclassifiedData(e),console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ")}catch(t){throw console.error("âŒ ë¯¸ë¶„ë¥˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",t),t}}async loadClassifiedData(){try{const e=await D.loadClassifiedData();return console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: IndexedDBì—ì„œ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ"),e}catch(e){return console.error("âŒ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",e),[]}}async loadClassifiedByDate(e){try{const t=await D.loadClassifiedByDate(e);return console.log(`âœ… í•˜ì´ë¸Œë¦¬ë“œ: ${e} ë‚ ì§œ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ`),t||[]}catch(t){return console.error("âŒ ë‚ ì§œë³„ ë¶„ë¥˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",t),[]}}async saveDailyProgress(e){try{await D.saveDailyProgress(e),console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ì¼ë³„ ì§„í–‰ë¥  ì €ì¥ ì™„ë£Œ")}catch(t){throw console.error("âŒ ì¼ë³„ ì§„í–‰ë¥  ì €ì¥ ì‹¤íŒ¨:",t),t}}async getAvailableDates(){try{const e=await D.getAvailableDates();return console.log("âœ… í•˜ì´ë¸Œë¦¬ë“œ: ì‚¬ìš© ê°€ëŠ¥í•œ ë‚ ì§œ ì¡°íšŒ"),e}catch(e){return console.error("âŒ ë‚ ì§œ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:",e),[]}}async saveSystemConfig(e,t){try{if(this.config.useApiServer){const s=await m.saveSystemConfig(e,t);if(s.success)console.log("âœ… API ì„œë²„ì— ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì™„ë£Œ");else throw new Error(s.error||"API ì €ì¥ ì‹¤íŒ¨")}await D.saveSystemConfig(e,t),console.log("âœ… ë¡œì»¬ IndexedDBì— ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì™„ë£Œ")}catch(s){if(console.error("âŒ ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:",s),this.config.fallbackToLocal)await D.saveSystemConfig(e,t),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw s}}async getSystemConfig(e){try{if(this.config.useApiServer){const t=await m.getSystemConfig(e);if(t.success&&t.data!==void 0)return console.log("âœ… API ì„œë²„ì—ì„œ ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ ì™„ë£Œ"),t.data}if(this.config.fallbackToLocal){const t=await D.getSystemConfig(e);return console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ì„œ ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ"),t}return null}catch(t){return console.error("âŒ ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨:",t),this.config.fallbackToLocal?await D.getSystemConfig(e):null}}async saveCategories(e){try{this.config.useApiServer&&console.log("âš ï¸ API ì„œë²„ ì¹´í…Œê³ ë¦¬ ì €ì¥ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."),await D.saveCategories(e),console.log("âœ… ë¡œì»¬ IndexedDBì— ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì €ì¥ ì™„ë£Œ")}catch(t){if(console.error("âŒ ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì €ì¥ ì‹¤íŒ¨:",t),this.config.fallbackToLocal)await D.saveCategories(e),console.log("âš ï¸ ë¡œì»¬ IndexedDBì—ë§Œ ì €ì¥ë¨");else throw t}}async loadCategories(){try{if(this.config.useApiServer&&console.log("âš ï¸ API ì„œë²„ ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."),this.config.fallbackToLocal){const e=await D.loadCategories();return console.log("âœ… ë¡œì»¬ IndexedDBì—ì„œ ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì¡°íšŒ"),e}return null}catch(e){return console.error("âŒ ì„¸ë¶€ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ì‹¤íŒ¨:",e),this.config.fallbackToLocal?await D.loadCategories():null}}async testApiConnection(){try{return(await m.testConnection()).success}catch(e){return console.error("âŒ API ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:",e),!1}}async syncToApi(){try{console.log("ğŸ”„ ë°ì´í„° ë™ê¸°í™” ì‹œì‘...");const e=await D.getChannels();Object.keys(e).length>0&&await this.saveChannels(e);const t=await D.getVideos();Object.keys(t).length>0&&await this.saveVideos(t);const s=await D.getClassifiedData();s.length>0&&await this.saveClassifiedData(s);const a=await D.loadUnclassifiedData();a.length>0&&await this.saveUnclassifiedData(a),console.log("âœ… ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ")}catch(e){throw console.error("âŒ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:",e),e}}async safeUpdateVideo(e,t){try{if(this.config.useApiServer){const s=await m.updateVideo(e,t);if(s.success)return console.log(`âœ… ë¹„ë””ì˜¤ ì—…ë°ì´íŠ¸ ì„±ê³µ: ${e}`),{success:!0};throw new Error(s.error||"Update failed")}}catch(s){console.warn("âš ï¸ ì„œë²„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨, ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€:",s);try{const a=await B.addToOutbox("update",`/api/videos/${e}`,t);return console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€ë¨: ${a}`),{success:!1,outboxId:a}}catch(a){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",a),a}}return{success:!1}}async safeDeleteVideo(e){try{if(this.config.useApiServer){const t=await m.deleteVideo(e);if(t.success)return console.log(`âœ… ë¹„ë””ì˜¤ ì‚­ì œ ì„±ê³µ: ${e}`),{success:!0};throw new Error(t.error||"Delete failed")}}catch(t){console.warn("âš ï¸ ì„œë²„ ì‚­ì œ ì‹¤íŒ¨, ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€:",t);try{const s=await B.addToOutbox("delete",`/api/videos/${e}`,{});return console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€ë¨: ${s}`),{success:!1,outboxId:s}}catch(s){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",s),s}}return{success:!1}}async safeDeleteVideosBatch(e){try{if(this.config.useApiServer){const t=await m.deleteVideosBatch(e);if(t.success)return console.log(`âœ… ë°°ì¹˜ ì‚­ì œ ì„±ê³µ: ${e.length}ê°œ`),{success:!0};throw new Error(t.error||"Batch delete failed")}}catch(t){console.warn("âš ï¸ ì„œë²„ ë°°ì¹˜ ì‚­ì œ ì‹¤íŒ¨, ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€:",t);try{const s=await B.addToOutbox("delete","/api/videos/batch",{ids:e});return console.log(`ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ì— ì¶”ê°€ë¨: ${s}`),{success:!1,outboxId:s}}catch(s){throw console.error("âŒ ì•„ì›ƒë°•ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨:",s),s}}return{success:!1}}initializeOutbox(){console.log("ğŸ“¦ ì•„ì›ƒë°•ìŠ¤ ì„œë¹„ìŠ¤ ì´ˆê¸°í™”"),B.startAutoProcess()}async getOutboxStats(){return await B.getStats()}async processOutbox(){return await B.processOutbox()}}const Y=new X,se=Object.freeze(Object.defineProperty({__proto__:null,hybridService:Y},Symbol.toStringTag,{value:"Module"}));export{k as A,Y as a,m as b,ee as c,Q as d,te as e,se as f,A as h,D as i,T as s};
